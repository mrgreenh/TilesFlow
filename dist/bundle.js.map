{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap bc2f31981faad922d244","webpack:///./src/TilesFlow.js","webpack:///./~/babel-runtime/core-js/get-iterator.js","webpack:///./~/core-js/library/fn/get-iterator.js","webpack:///./~/core-js/library/modules/web.dom.iterable.js","webpack:///./~/core-js/library/modules/es6.array.iterator.js","webpack:///./~/core-js/library/modules/_add-to-unscopables.js","webpack:///./~/core-js/library/modules/_iter-step.js","webpack:///./~/core-js/library/modules/_iterators.js","webpack:///./~/core-js/library/modules/_to-iobject.js","webpack:///./~/core-js/library/modules/_iobject.js","webpack:///./~/core-js/library/modules/_cof.js","webpack:///./~/core-js/library/modules/_defined.js","webpack:///./~/core-js/library/modules/_iter-define.js","webpack:///./~/core-js/library/modules/_library.js","webpack:///./~/core-js/library/modules/_export.js","webpack:///./~/core-js/library/modules/_global.js","webpack:///./~/core-js/library/modules/_core.js","webpack:///./~/core-js/library/modules/_ctx.js","webpack:///./~/core-js/library/modules/_a-function.js","webpack:///./~/core-js/library/modules/_hide.js","webpack:///./~/core-js/library/modules/_object-dp.js","webpack:///./~/core-js/library/modules/_an-object.js","webpack:///./~/core-js/library/modules/_is-object.js","webpack:///./~/core-js/library/modules/_ie8-dom-define.js","webpack:///./~/core-js/library/modules/_descriptors.js","webpack:///./~/core-js/library/modules/_fails.js","webpack:///./~/core-js/library/modules/_dom-create.js","webpack:///./~/core-js/library/modules/_to-primitive.js","webpack:///./~/core-js/library/modules/_property-desc.js","webpack:///./~/core-js/library/modules/_redefine.js","webpack:///./~/core-js/library/modules/_has.js","webpack:///./~/core-js/library/modules/_iter-create.js","webpack:///./~/core-js/library/modules/_object-create.js","webpack:///./~/core-js/library/modules/_object-dps.js","webpack:///./~/core-js/library/modules/_object-keys.js","webpack:///./~/core-js/library/modules/_object-keys-internal.js","webpack:///./~/core-js/library/modules/_array-includes.js","webpack:///./~/core-js/library/modules/_to-length.js","webpack:///./~/core-js/library/modules/_to-integer.js","webpack:///./~/core-js/library/modules/_to-index.js","webpack:///./~/core-js/library/modules/_shared-key.js","webpack:///./~/core-js/library/modules/_shared.js","webpack:///./~/core-js/library/modules/_uid.js","webpack:///./~/core-js/library/modules/_enum-bug-keys.js","webpack:///./~/core-js/library/modules/_html.js","webpack:///./~/core-js/library/modules/_set-to-string-tag.js","webpack:///./~/core-js/library/modules/_wks.js","webpack:///./~/core-js/library/modules/_object-gpo.js","webpack:///./~/core-js/library/modules/_to-object.js","webpack:///./~/core-js/library/modules/es6.string.iterator.js","webpack:///./~/core-js/library/modules/_string-at.js","webpack:///./~/core-js/library/modules/core.get-iterator.js","webpack:///./~/core-js/library/modules/core.get-iterator-method.js","webpack:///./~/core-js/library/modules/_classof.js","webpack:///./~/babel-runtime/helpers/defineProperty.js","webpack:///./~/babel-runtime/core-js/object/define-property.js","webpack:///./~/core-js/library/fn/object/define-property.js","webpack:///./~/core-js/library/modules/es6.object.define-property.js","webpack:///./~/babel-runtime/core-js/object/assign.js","webpack:///./~/core-js/library/fn/object/assign.js","webpack:///./~/core-js/library/modules/es6.object.assign.js","webpack:///./~/core-js/library/modules/_object-assign.js","webpack:///./~/core-js/library/modules/_object-gops.js","webpack:///./~/core-js/library/modules/_object-pie.js","webpack:///./~/babel-runtime/helpers/classCallCheck.js","webpack:///./~/babel-runtime/helpers/createClass.js","webpack:///./~/ptjs/dist/module/pt.js","webpack:///./src/PointsMatrix.js","webpack:///./src/ColorfulTriangle.js","webpack:///./src/Force.js","webpack:///./src/ColorfulPoint.js","webpack:///./src/patterns.js","webpack:///./src/ForceField.js"],"names":[],"mappings":"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yCAAwC,oCAAoC;AAC5E,6CAA4C,oCAAoC;AAChF,MAAK,2BAA2B,oCAAoC;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,mBAAmB;AACnC;AACA;AACA,kCAAiC,2BAA2B;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,G;;;;;;ACrEA,uB;;;;;;ACAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oEAAmE;AACnE;AACA,sFAAqF;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX,UAAS;AACT;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,gDAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA,eAAc;AACd,eAAc;AACd,eAAc;AACd,eAAc;AACd,gBAAe;AACf,gBAAe;AACf,gBAAe;AACf,iBAAgB;AAChB,0B;;;;;;AC5DA;AACA;AACA;AACA,wCAAuC,gC;;;;;;ACHvC,8BAA6B;AAC7B,sCAAqC,gC;;;;;;ACDrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACnBA;AACA;AACA;AACA,G;;;;;;ACHA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA,G;;;;;;ACPA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG,UAAU;AACb;AACA;AACA;AACA,G;;;;;;ACfA;AACA;AACA;AACA;AACA,G;;;;;;ACJA;AACA;AACA,G;;;;;;ACFA;AACA,sEAAsE,gBAAgB,UAAU,GAAG;AACnG,EAAC,E;;;;;;ACFD;AACA;AACA,kCAAiC,QAAQ,gBAAgB,UAAU,GAAG;AACtE,EAAC,E;;;;;;ACHD;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,G;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACPA,0C;;;;;;ACAA,wBAAuB;AACvB;AACA;AACA,G;;;;;;ACHA;AACA;AACA;AACA;AACA;;AAEA;AACA,4FAAgF,aAAa,EAAE;;AAE/F;AACA,sDAAqD,0BAA0B;AAC/E;AACA,G;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,G;;;;;;ACvCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACZA;AACA;AACA;;AAEA;AACA;AACA,G;;;;;;ACNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK,WAAW,eAAe;AAC/B;AACA,MAAK;AACL;AACA,G;;;;;;ACpBA;AACA;AACA;AACA;AACA,4DAA2D;AAC3D,G;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACNA;AACA;AACA;AACA;AACA,G;;;;;;ACJA;AACA;AACA,oDAAmD;AACnD;AACA,wCAAuC;AACvC,G;;;;;;ACLA;AACA;AACA;AACA;AACA,G;;;;;;ACJA;AACA;AACA;AACA,c;;;;;;ACHA,+E;;;;;;ACAA;AACA;AACA;;AAEA;AACA,mEAAkE,+BAA+B;AACjG,G;;;;;;ACNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,wB;;;;;;ACVA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,G;;;;;;ACZA;AACA;AACA;AACA;AACA,G;;;;;;ACJA;AACA;;AAEA;AACA;AACA,8BAA6B;AAC7B,eAAc;AACd;AACA,EAAC;AACD;AACA;AACA;AACA,gCAA+B;AAC/B;AACA;AACA,WAAU;AACV,EAAC,E;;;;;;AChBD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACPA;AACA;AACA;AACA;AACA,0BAAyB,kBAAkB,EAAE;;AAE7C;AACA;AACA;AACA;AACA,IAAG,UAAU;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACtBA;;AAEA;;AAEA;;AAEA;;AAEA,uCAAsC,uCAAuC,gBAAgB;;AAE7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;;AAEA;AACA,G;;;;;;ACvBA,mBAAkB,wD;;;;;;ACAlB;AACA;AACA;AACA;AACA,G;;;;;;ACJA;AACA;AACA,sEAAuE,0CAA0C,E;;;;;;ACFjH,mBAAkB,wD;;;;;;ACAlB;AACA,wD;;;;;;ACDA;AACA;;AAEA,2CAA0C,gCAAoC,E;;;;;;ACH9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,UAAU,EAAE;AAC9C,oBAAmB,sCAAsC;AACzD,EAAC,oCAAoC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,EAAC,W;;;;;;AChCD,0C;;;;;;ACAA,eAAc,sB;;;;;;ACAd;;AAEA;;AAEA;AACA;AACA;AACA;AACA,G;;;;;;ACRA;;AAEA;;AAEA;;AAEA;;AAEA,uCAAsC,uCAAuC,gBAAgB;;AAE7F;AACA;AACA,oBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAC,G;;;;;;AC1BD,aAAY,cAAc;AAC1B,qCAAoC,0BAA0B,yDAAyD,EAAE,kBAAkB,0BAA0B,EAAE,mCAAmC,8BAA8B,oCAAoC,cAAc,EAAE;AAC5R,eAAc;AACd;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,uCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qBAAoB,WAAW;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,UAAU;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,WAAW;AAC/C;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,WAAW;AAC/C;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,0CAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,QAAO;AACP;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,gCAA+B,kCAAkC;AACjE;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,WAAW;AACjD;AACA,yCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yCAAwC,gCAAgC;AACxE,yCAAwC,mCAAmC;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAqC,gCAAgC;AACrE;AACA,4CAA2C,mCAAmC;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B,gCAAgC;AAC7D,iCAAgC,mCAAmC;AACnE;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oEAAmE,qCAAqC;AACxG,0EAAyE,sCAAsC;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,4CAA2C,gCAAgC;AAC3E;AACA;AACA,kDAAiD,mCAAmC;AACpF;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAoC,WAAW;AAC/C;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAkD,UAAU;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kCAAiC,WAAW;AAC5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,WAAW;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,YAAY;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,WAAW;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,YAAY;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA,UAAS;AACT,yCAAwC,YAAY;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,WAAW;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAuC,WAAW;AAClD;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,UAAU;AAClD;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qCAAoC,WAAW;AAC/C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,yCAAwC,qCAAqC;AAC7E,4CAA2C,sCAAsC;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,yDAAwD,qCAAqC;AAC7F;AACA,4CAA2C,mCAAmC;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+DAA8D,qCAAqC;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAiD,mCAAmC;AACpF;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,oEAAmE,sCAAsC;AACzG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,WAAW;AACpD;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,WAAW;AAC/C;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C,UAAU;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,0CAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,wCAAuC,WAAW;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,WAAW;AACjD;AACA,0CAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,0CAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,gCAAgC;AACnE;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,kCAAkC;AACxE;AACA;AACA;AACA;AACA;AACA,wCAAuC,qCAAqC;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,kCAAkC;AACpE;AACA;AACA;AACA;AACA;AACA,oCAAmC,qCAAqC;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB,UAAU;AAChC;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAoB,WAAW;AAC/B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;AAED;AACA,EAAC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","file":"./dist/bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tilesflow\"] = factory();\n\telse\n\t\troot[\"tilesflow\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap bc2f31981faad922d244\n **/","import {Form, Point, Color} from 'ptjs';\nimport PointsMatrix from './PointsMatrix.js';\nimport patterns from './patterns.js';\nimport ForceField from './ForceField.js';\nimport {CanvasSpace} from 'ptjs';\n\nclass TilesFlow {\n\n    constructor(containerId, forceField, visualSettings){\n        this._space = new CanvasSpace('canvasElem_'+containerId.substr(1), '#fff').display(containerId);\n        this._space.size.x = this._space.space.width;\n        this._space.size.y = this._space.space.height;\n        this._forceField = new ForceField(forceField, this._space.size.x, this._space.size.y);\n        this._visualSettings = visualSettings;\n    }\n\n    getCanvas(){\n        return this._space.space;\n    }\n\n    render(offsetX){\n\n        var visualSettings = Object.assign({}, {\n            step: 100,\n            stroke: undefined,\n            fill: undefined,\n            pattern: undefined,\n            baseColor: [0,0,0,0],\n            colorInterpolationMode: \"addition\",\n            showForces: false,\n            pattern: patterns.cloth,\n            padding: [0,0,0,0],\n            pointsColor: [0,0,0,0]\n        }, this._visualSettings)\n\n        var form = new Form(this._space);\n        var pointsMatrix = new PointsMatrix(\n            this._space.size.x,\n            this._space.size.y,\n            visualSettings.step,\n            visualSettings.baseColor,\n            visualSettings.colorInterpolationMode,\n            this._forceField,\n            offsetX);\n        var points = pointsMatrix.getFlattenedMatrix();\n        var triangles = pointsMatrix.getTiles(visualSettings.pattern, visualSettings.padding);\n\n        var forces = pointsMatrix._forces;\n\n        for(let triangle of triangles){\n            if(triangle.color){\n                var color = triangle.color;\n                var fillColor = this.getFillWithSettings(color, visualSettings);\n                form.fill( new Color(fillColor[0], fillColor[1], fillColor[2], fillColor[3]/255, 'rgba').rgba() );\n                var strokeColor = this.getStrokeWithSettings(color, visualSettings);\n                form.stroke( new Color(strokeColor[0], strokeColor[1], strokeColor[2], strokeColor[3]/255, 'rgba').rgba() );\n            }\n            form.triangle(triangle.concept);\n        }\n\n        var pointsColor = visualSettings.pointsColor;\n        form.fill(new Color(pointsColor[0], pointsColor[1], pointsColor[2], pointsColor[3]/255, 'rgba').rgba());\n        form.stroke(new Color(pointsColor[0], pointsColor[1], pointsColor[2], pointsColor[3]/255, 'rgba').rgba());\n        form.points( points.map(point => point.concept) );\n\n        if(visualSettings.showForces){\n            for(let i in forces){\n              var p = new Point(forces[i]._x, forces[i]._y);\n              form.stroke(\"red\");\n              form.fill(\"red\");\n              form.point(p);\n            }            \n        }\n\n    }\n\n    getFillWithSettings(color, visualSettings){\n        if(!visualSettings.fill) return color;\n        else return visualSettings.fill;\n    }\n\n    getStrokeWithSettings(color, visualSettings){\n        if(!visualSettings.stroke) return color;\n        else return visualSettings.stroke;\n    }\n}\n\nTilesFlow.PATTERNS = patterns;\nexport default TilesFlow;\n\n\n/** WEBPACK FOOTER **\n ** ./src/TilesFlow.js\n **/","module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/babel-runtime/core-js/get-iterator.js\n ** module id = 1\n ** module chunks = 0\n **/","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/fn/get-iterator.js\n ** module id = 2\n ** module chunks = 0\n **/","require('./es6.array.iterator');\nvar global        = require('./_global')\n  , hide          = require('./_hide')\n  , Iterators     = require('./_iterators')\n  , TO_STRING_TAG = require('./_wks')('toStringTag');\n\nfor(var collections = ['NodeList', 'DOMTokenList', 'MediaList', 'StyleSheetList', 'CSSRuleList'], i = 0; i < 5; i++){\n  var NAME       = collections[i]\n    , Collection = global[NAME]\n    , proto      = Collection && Collection.prototype;\n  if(proto && !proto[TO_STRING_TAG])hide(proto, TO_STRING_TAG, NAME);\n  Iterators[NAME] = Iterators.Array;\n}\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/web.dom.iterable.js\n ** module id = 3\n ** module chunks = 0\n **/","'use strict';\nvar addToUnscopables = require('./_add-to-unscopables')\n  , step             = require('./_iter-step')\n  , Iterators        = require('./_iterators')\n  , toIObject        = require('./_to-iobject');\n\n// 22.1.3.4 Array.prototype.entries()\n// 22.1.3.13 Array.prototype.keys()\n// 22.1.3.29 Array.prototype.values()\n// 22.1.3.30 Array.prototype[@@iterator]()\nmodule.exports = require('./_iter-define')(Array, 'Array', function(iterated, kind){\n  this._t = toIObject(iterated); // target\n  this._i = 0;                   // next index\n  this._k = kind;                // kind\n// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n}, function(){\n  var O     = this._t\n    , kind  = this._k\n    , index = this._i++;\n  if(!O || index >= O.length){\n    this._t = undefined;\n    return step(1);\n  }\n  if(kind == 'keys'  )return step(0, index);\n  if(kind == 'values')return step(0, O[index]);\n  return step(0, [index, O[index]]);\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\nIterators.Arguments = Iterators.Array;\n\naddToUnscopables('keys');\naddToUnscopables('values');\naddToUnscopables('entries');\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/es6.array.iterator.js\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = function(){ /* empty */ };\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_add-to-unscopables.js\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = function(done, value){\n  return {value: value, done: !!done};\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_iter-step.js\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = {};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_iterators.js\n ** module id = 7\n ** module chunks = 0\n **/","// to indexed object, toObject with fallback for non-array-like ES3 strings\nvar IObject = require('./_iobject')\n  , defined = require('./_defined');\nmodule.exports = function(it){\n  return IObject(defined(it));\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_to-iobject.js\n ** module id = 8\n ** module chunks = 0\n **/","// fallback for non-array-like ES3 and non-enumerable old V8 strings\nvar cof = require('./_cof');\nmodule.exports = Object('z').propertyIsEnumerable(0) ? Object : function(it){\n  return cof(it) == 'String' ? it.split('') : Object(it);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_iobject.js\n ** module id = 9\n ** module chunks = 0\n **/","var toString = {}.toString;\n\nmodule.exports = function(it){\n  return toString.call(it).slice(8, -1);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_cof.js\n ** module id = 10\n ** module chunks = 0\n **/","// 7.2.1 RequireObjectCoercible(argument)\nmodule.exports = function(it){\n  if(it == undefined)throw TypeError(\"Can't call method on  \" + it);\n  return it;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_defined.js\n ** module id = 11\n ** module chunks = 0\n **/","'use strict';\nvar LIBRARY        = require('./_library')\n  , $export        = require('./_export')\n  , redefine       = require('./_redefine')\n  , hide           = require('./_hide')\n  , has            = require('./_has')\n  , Iterators      = require('./_iterators')\n  , $iterCreate    = require('./_iter-create')\n  , setToStringTag = require('./_set-to-string-tag')\n  , getPrototypeOf = require('./_object-gpo')\n  , ITERATOR       = require('./_wks')('iterator')\n  , BUGGY          = !([].keys && 'next' in [].keys()) // Safari has buggy iterators w/o `next`\n  , FF_ITERATOR    = '@@iterator'\n  , KEYS           = 'keys'\n  , VALUES         = 'values';\n\nvar returnThis = function(){ return this; };\n\nmodule.exports = function(Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED){\n  $iterCreate(Constructor, NAME, next);\n  var getMethod = function(kind){\n    if(!BUGGY && kind in proto)return proto[kind];\n    switch(kind){\n      case KEYS: return function keys(){ return new Constructor(this, kind); };\n      case VALUES: return function values(){ return new Constructor(this, kind); };\n    } return function entries(){ return new Constructor(this, kind); };\n  };\n  var TAG        = NAME + ' Iterator'\n    , DEF_VALUES = DEFAULT == VALUES\n    , VALUES_BUG = false\n    , proto      = Base.prototype\n    , $native    = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT]\n    , $default   = $native || getMethod(DEFAULT)\n    , $entries   = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined\n    , $anyNative = NAME == 'Array' ? proto.entries || $native : $native\n    , methods, key, IteratorPrototype;\n  // Fix native\n  if($anyNative){\n    IteratorPrototype = getPrototypeOf($anyNative.call(new Base));\n    if(IteratorPrototype !== Object.prototype){\n      // Set @@toStringTag to native iterators\n      setToStringTag(IteratorPrototype, TAG, true);\n      // fix for some old engines\n      if(!LIBRARY && !has(IteratorPrototype, ITERATOR))hide(IteratorPrototype, ITERATOR, returnThis);\n    }\n  }\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if(DEF_VALUES && $native && $native.name !== VALUES){\n    VALUES_BUG = true;\n    $default = function values(){ return $native.call(this); };\n  }\n  // Define iterator\n  if((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])){\n    hide(proto, ITERATOR, $default);\n  }\n  // Plug for library\n  Iterators[NAME] = $default;\n  Iterators[TAG]  = returnThis;\n  if(DEFAULT){\n    methods = {\n      values:  DEF_VALUES ? $default : getMethod(VALUES),\n      keys:    IS_SET     ? $default : getMethod(KEYS),\n      entries: $entries\n    };\n    if(FORCED)for(key in methods){\n      if(!(key in proto))redefine(proto, key, methods[key]);\n    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);\n  }\n  return methods;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_iter-define.js\n ** module id = 12\n ** module chunks = 0\n **/","module.exports = true;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_library.js\n ** module id = 13\n ** module chunks = 0\n **/","var global    = require('./_global')\n  , core      = require('./_core')\n  , ctx       = require('./_ctx')\n  , hide      = require('./_hide')\n  , PROTOTYPE = 'prototype';\n\nvar $export = function(type, name, source){\n  var IS_FORCED = type & $export.F\n    , IS_GLOBAL = type & $export.G\n    , IS_STATIC = type & $export.S\n    , IS_PROTO  = type & $export.P\n    , IS_BIND   = type & $export.B\n    , IS_WRAP   = type & $export.W\n    , exports   = IS_GLOBAL ? core : core[name] || (core[name] = {})\n    , expProto  = exports[PROTOTYPE]\n    , target    = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE]\n    , key, own, out;\n  if(IS_GLOBAL)source = name;\n  for(key in source){\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    if(own && key in exports)continue;\n    // export native or passed\n    out = own ? target[key] : source[key];\n    // prevent global pollution for namespaces\n    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]\n    // bind timers to global for call from export context\n    : IS_BIND && own ? ctx(out, global)\n    // wrap global constructors for prevent change them in library\n    : IS_WRAP && target[key] == out ? (function(C){\n      var F = function(a, b, c){\n        if(this instanceof C){\n          switch(arguments.length){\n            case 0: return new C;\n            case 1: return new C(a);\n            case 2: return new C(a, b);\n          } return new C(a, b, c);\n        } return C.apply(this, arguments);\n      };\n      F[PROTOTYPE] = C[PROTOTYPE];\n      return F;\n    // make static versions for prototype methods\n    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%\n    if(IS_PROTO){\n      (exports.virtual || (exports.virtual = {}))[key] = out;\n      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%\n      if(type & $export.R && expProto && !expProto[key])hide(expProto, key, out);\n    }\n  }\n};\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library` \nmodule.exports = $export;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_export.js\n ** module id = 14\n ** module chunks = 0\n **/","// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self : Function('return this')();\nif(typeof __g == 'number')__g = global; // eslint-disable-line no-undef\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_global.js\n ** module id = 15\n ** module chunks = 0\n **/","var core = module.exports = {version: '2.4.0'};\nif(typeof __e == 'number')__e = core; // eslint-disable-line no-undef\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_core.js\n ** module id = 16\n ** module chunks = 0\n **/","// optional / simple context binding\nvar aFunction = require('./_a-function');\nmodule.exports = function(fn, that, length){\n  aFunction(fn);\n  if(that === undefined)return fn;\n  switch(length){\n    case 1: return function(a){\n      return fn.call(that, a);\n    };\n    case 2: return function(a, b){\n      return fn.call(that, a, b);\n    };\n    case 3: return function(a, b, c){\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function(/* ...args */){\n    return fn.apply(that, arguments);\n  };\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_ctx.js\n ** module id = 17\n ** module chunks = 0\n **/","module.exports = function(it){\n  if(typeof it != 'function')throw TypeError(it + ' is not a function!');\n  return it;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_a-function.js\n ** module id = 18\n ** module chunks = 0\n **/","var dP         = require('./_object-dp')\n  , createDesc = require('./_property-desc');\nmodule.exports = require('./_descriptors') ? function(object, key, value){\n  return dP.f(object, key, createDesc(1, value));\n} : function(object, key, value){\n  object[key] = value;\n  return object;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_hide.js\n ** module id = 19\n ** module chunks = 0\n **/","var anObject       = require('./_an-object')\n  , IE8_DOM_DEFINE = require('./_ie8-dom-define')\n  , toPrimitive    = require('./_to-primitive')\n  , dP             = Object.defineProperty;\n\nexports.f = require('./_descriptors') ? Object.defineProperty : function defineProperty(O, P, Attributes){\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if(IE8_DOM_DEFINE)try {\n    return dP(O, P, Attributes);\n  } catch(e){ /* empty */ }\n  if('get' in Attributes || 'set' in Attributes)throw TypeError('Accessors not supported!');\n  if('value' in Attributes)O[P] = Attributes.value;\n  return O;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-dp.js\n ** module id = 20\n ** module chunks = 0\n **/","var isObject = require('./_is-object');\nmodule.exports = function(it){\n  if(!isObject(it))throw TypeError(it + ' is not an object!');\n  return it;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_an-object.js\n ** module id = 21\n ** module chunks = 0\n **/","module.exports = function(it){\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_is-object.js\n ** module id = 22\n ** module chunks = 0\n **/","module.exports = !require('./_descriptors') && !require('./_fails')(function(){\r\n  return Object.defineProperty(require('./_dom-create')('div'), 'a', {get: function(){ return 7; }}).a != 7;\r\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_ie8-dom-define.js\n ** module id = 23\n ** module chunks = 0\n **/","// Thank's IE8 for his funny defineProperty\nmodule.exports = !require('./_fails')(function(){\n  return Object.defineProperty({}, 'a', {get: function(){ return 7; }}).a != 7;\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_descriptors.js\n ** module id = 24\n ** module chunks = 0\n **/","module.exports = function(exec){\n  try {\n    return !!exec();\n  } catch(e){\n    return true;\n  }\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_fails.js\n ** module id = 25\n ** module chunks = 0\n **/","var isObject = require('./_is-object')\n  , document = require('./_global').document\n  // in old IE typeof document.createElement is 'object'\n  , is = isObject(document) && isObject(document.createElement);\nmodule.exports = function(it){\n  return is ? document.createElement(it) : {};\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_dom-create.js\n ** module id = 26\n ** module chunks = 0\n **/","// 7.1.1 ToPrimitive(input [, PreferredType])\nvar isObject = require('./_is-object');\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function(it, S){\n  if(!isObject(it))return it;\n  var fn, val;\n  if(S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;\n  if(typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it)))return val;\n  if(!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_to-primitive.js\n ** module id = 27\n ** module chunks = 0\n **/","module.exports = function(bitmap, value){\n  return {\n    enumerable  : !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable    : !(bitmap & 4),\n    value       : value\n  };\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_property-desc.js\n ** module id = 28\n ** module chunks = 0\n **/","module.exports = require('./_hide');\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_redefine.js\n ** module id = 29\n ** module chunks = 0\n **/","var hasOwnProperty = {}.hasOwnProperty;\nmodule.exports = function(it, key){\n  return hasOwnProperty.call(it, key);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_has.js\n ** module id = 30\n ** module chunks = 0\n **/","'use strict';\nvar create         = require('./_object-create')\n  , descriptor     = require('./_property-desc')\n  , setToStringTag = require('./_set-to-string-tag')\n  , IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\nrequire('./_hide')(IteratorPrototype, require('./_wks')('iterator'), function(){ return this; });\n\nmodule.exports = function(Constructor, NAME, next){\n  Constructor.prototype = create(IteratorPrototype, {next: descriptor(1, next)});\n  setToStringTag(Constructor, NAME + ' Iterator');\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_iter-create.js\n ** module id = 31\n ** module chunks = 0\n **/","// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\r\nvar anObject    = require('./_an-object')\r\n  , dPs         = require('./_object-dps')\r\n  , enumBugKeys = require('./_enum-bug-keys')\r\n  , IE_PROTO    = require('./_shared-key')('IE_PROTO')\r\n  , Empty       = function(){ /* empty */ }\r\n  , PROTOTYPE   = 'prototype';\r\n\r\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\r\nvar createDict = function(){\r\n  // Thrash, waste and sodomy: IE GC bug\r\n  var iframe = require('./_dom-create')('iframe')\r\n    , i      = enumBugKeys.length\r\n    , gt     = '>'\r\n    , iframeDocument;\r\n  iframe.style.display = 'none';\r\n  require('./_html').appendChild(iframe);\r\n  iframe.src = 'javascript:'; // eslint-disable-line no-script-url\r\n  // createDict = iframe.contentWindow.Object;\r\n  // html.removeChild(iframe);\r\n  iframeDocument = iframe.contentWindow.document;\r\n  iframeDocument.open();\r\n  iframeDocument.write('<script>document.F=Object</script' + gt);\r\n  iframeDocument.close();\r\n  createDict = iframeDocument.F;\r\n  while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];\r\n  return createDict();\r\n};\r\n\r\nmodule.exports = Object.create || function create(O, Properties){\r\n  var result;\r\n  if(O !== null){\r\n    Empty[PROTOTYPE] = anObject(O);\r\n    result = new Empty;\r\n    Empty[PROTOTYPE] = null;\r\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\r\n    result[IE_PROTO] = O;\r\n  } else result = createDict();\r\n  return Properties === undefined ? result : dPs(result, Properties);\r\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-create.js\n ** module id = 32\n ** module chunks = 0\n **/","var dP       = require('./_object-dp')\r\n  , anObject = require('./_an-object')\r\n  , getKeys  = require('./_object-keys');\r\n\r\nmodule.exports = require('./_descriptors') ? Object.defineProperties : function defineProperties(O, Properties){\r\n  anObject(O);\r\n  var keys   = getKeys(Properties)\r\n    , length = keys.length\r\n    , i = 0\r\n    , P;\r\n  while(length > i)dP.f(O, P = keys[i++], Properties[P]);\r\n  return O;\r\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-dps.js\n ** module id = 33\n ** module chunks = 0\n **/","// 19.1.2.14 / 15.2.3.14 Object.keys(O)\r\nvar $keys       = require('./_object-keys-internal')\r\n  , enumBugKeys = require('./_enum-bug-keys');\r\n\r\nmodule.exports = Object.keys || function keys(O){\r\n  return $keys(O, enumBugKeys);\r\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-keys.js\n ** module id = 34\n ** module chunks = 0\n **/","var has          = require('./_has')\r\n  , toIObject    = require('./_to-iobject')\r\n  , arrayIndexOf = require('./_array-includes')(false)\r\n  , IE_PROTO     = require('./_shared-key')('IE_PROTO');\r\n\r\nmodule.exports = function(object, names){\r\n  var O      = toIObject(object)\r\n    , i      = 0\r\n    , result = []\r\n    , key;\r\n  for(key in O)if(key != IE_PROTO)has(O, key) && result.push(key);\r\n  // Don't enum bug & hidden keys\r\n  while(names.length > i)if(has(O, key = names[i++])){\r\n    ~arrayIndexOf(result, key) || result.push(key);\r\n  }\r\n  return result;\r\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-keys-internal.js\n ** module id = 35\n ** module chunks = 0\n **/","// false -> Array#indexOf\n// true  -> Array#includes\nvar toIObject = require('./_to-iobject')\n  , toLength  = require('./_to-length')\n  , toIndex   = require('./_to-index');\nmodule.exports = function(IS_INCLUDES){\n  return function($this, el, fromIndex){\n    var O      = toIObject($this)\n      , length = toLength(O.length)\n      , index  = toIndex(fromIndex, length)\n      , value;\n    // Array#includes uses SameValueZero equality algorithm\n    if(IS_INCLUDES && el != el)while(length > index){\n      value = O[index++];\n      if(value != value)return true;\n    // Array#toIndex ignores holes, Array#includes - not\n    } else for(;length > index; index++)if(IS_INCLUDES || index in O){\n      if(O[index] === el)return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_array-includes.js\n ** module id = 36\n ** module chunks = 0\n **/","// 7.1.15 ToLength\nvar toInteger = require('./_to-integer')\n  , min       = Math.min;\nmodule.exports = function(it){\n  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_to-length.js\n ** module id = 37\n ** module chunks = 0\n **/","// 7.1.4 ToInteger\nvar ceil  = Math.ceil\n  , floor = Math.floor;\nmodule.exports = function(it){\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_to-integer.js\n ** module id = 38\n ** module chunks = 0\n **/","var toInteger = require('./_to-integer')\n  , max       = Math.max\n  , min       = Math.min;\nmodule.exports = function(index, length){\n  index = toInteger(index);\n  return index < 0 ? max(index + length, 0) : min(index, length);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_to-index.js\n ** module id = 39\n ** module chunks = 0\n **/","var shared = require('./_shared')('keys')\r\n  , uid    = require('./_uid');\r\nmodule.exports = function(key){\r\n  return shared[key] || (shared[key] = uid(key));\r\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_shared-key.js\n ** module id = 40\n ** module chunks = 0\n **/","var global = require('./_global')\n  , SHARED = '__core-js_shared__'\n  , store  = global[SHARED] || (global[SHARED] = {});\nmodule.exports = function(key){\n  return store[key] || (store[key] = {});\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_shared.js\n ** module id = 41\n ** module chunks = 0\n **/","var id = 0\n  , px = Math.random();\nmodule.exports = function(key){\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_uid.js\n ** module id = 42\n ** module chunks = 0\n **/","// IE 8- don't enum bug keys\r\nmodule.exports = (\r\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\r\n).split(',');\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_enum-bug-keys.js\n ** module id = 43\n ** module chunks = 0\n **/","module.exports = require('./_global').document && document.documentElement;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_html.js\n ** module id = 44\n ** module chunks = 0\n **/","var def = require('./_object-dp').f\n  , has = require('./_has')\n  , TAG = require('./_wks')('toStringTag');\n\nmodule.exports = function(it, tag, stat){\n  if(it && !has(it = stat ? it : it.prototype, TAG))def(it, TAG, {configurable: true, value: tag});\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_set-to-string-tag.js\n ** module id = 45\n ** module chunks = 0\n **/","var store      = require('./_shared')('wks')\n  , uid        = require('./_uid')\n  , Symbol     = require('./_global').Symbol\n  , USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function(name){\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_wks.js\n ** module id = 46\n ** module chunks = 0\n **/","// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)\r\nvar has         = require('./_has')\r\n  , toObject    = require('./_to-object')\r\n  , IE_PROTO    = require('./_shared-key')('IE_PROTO')\r\n  , ObjectProto = Object.prototype;\r\n\r\nmodule.exports = Object.getPrototypeOf || function(O){\r\n  O = toObject(O);\r\n  if(has(O, IE_PROTO))return O[IE_PROTO];\r\n  if(typeof O.constructor == 'function' && O instanceof O.constructor){\r\n    return O.constructor.prototype;\r\n  } return O instanceof Object ? ObjectProto : null;\r\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-gpo.js\n ** module id = 47\n ** module chunks = 0\n **/","// 7.1.13 ToObject(argument)\nvar defined = require('./_defined');\nmodule.exports = function(it){\n  return Object(defined(it));\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_to-object.js\n ** module id = 48\n ** module chunks = 0\n **/","'use strict';\nvar $at  = require('./_string-at')(true);\n\n// 21.1.3.27 String.prototype[@@iterator]()\nrequire('./_iter-define')(String, 'String', function(iterated){\n  this._t = String(iterated); // target\n  this._i = 0;                // next index\n// 21.1.5.2.1 %StringIteratorPrototype%.next()\n}, function(){\n  var O     = this._t\n    , index = this._i\n    , point;\n  if(index >= O.length)return {value: undefined, done: true};\n  point = $at(O, index);\n  this._i += point.length;\n  return {value: point, done: false};\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/es6.string.iterator.js\n ** module id = 49\n ** module chunks = 0\n **/","var toInteger = require('./_to-integer')\n  , defined   = require('./_defined');\n// true  -> String#at\n// false -> String#codePointAt\nmodule.exports = function(TO_STRING){\n  return function(that, pos){\n    var s = String(defined(that))\n      , i = toInteger(pos)\n      , l = s.length\n      , a, b;\n    if(i < 0 || i >= l)return TO_STRING ? '' : undefined;\n    a = s.charCodeAt(i);\n    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n      ? TO_STRING ? s.charAt(i) : a\n      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n  };\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_string-at.js\n ** module id = 50\n ** module chunks = 0\n **/","var anObject = require('./_an-object')\n  , get      = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function(it){\n  var iterFn = get(it);\n  if(typeof iterFn != 'function')throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/core.get-iterator.js\n ** module id = 51\n ** module chunks = 0\n **/","var classof   = require('./_classof')\n  , ITERATOR  = require('./_wks')('iterator')\n  , Iterators = require('./_iterators');\nmodule.exports = require('./_core').getIteratorMethod = function(it){\n  if(it != undefined)return it[ITERATOR]\n    || it['@@iterator']\n    || Iterators[classof(it)];\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/core.get-iterator-method.js\n ** module id = 52\n ** module chunks = 0\n **/","// getting tag from 19.1.3.6 Object.prototype.toString()\nvar cof = require('./_cof')\n  , TAG = require('./_wks')('toStringTag')\n  // ES3 wrong here\n  , ARG = cof(function(){ return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function(it, key){\n  try {\n    return it[key];\n  } catch(e){ /* empty */ }\n};\n\nmodule.exports = function(it){\n  var O, T, B;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T\n    // builtinTag case\n    : ARG ? cof(O)\n    // ES3 arguments fallback\n    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_classof.js\n ** module id = 53\n ** module chunks = 0\n **/","\"use strict\";\n\nexports.__esModule = true;\n\nvar _defineProperty = require(\"../core-js/object/define-property\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (obj, key, value) {\n  if (key in obj) {\n    (0, _defineProperty2.default)(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/babel-runtime/helpers/defineProperty.js\n ** module id = 54\n ** module chunks = 0\n **/","module.exports = { \"default\": require(\"core-js/library/fn/object/define-property\"), __esModule: true };\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/babel-runtime/core-js/object/define-property.js\n ** module id = 55\n ** module chunks = 0\n **/","require('../../modules/es6.object.define-property');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function defineProperty(it, key, desc){\n  return $Object.defineProperty(it, key, desc);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/fn/object/define-property.js\n ** module id = 56\n ** module chunks = 0\n **/","var $export = require('./_export');\r\n// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)\r\n$export($export.S + $export.F * !require('./_descriptors'), 'Object', {defineProperty: require('./_object-dp').f});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/es6.object.define-property.js\n ** module id = 57\n ** module chunks = 0\n **/","module.exports = { \"default\": require(\"core-js/library/fn/object/assign\"), __esModule: true };\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/babel-runtime/core-js/object/assign.js\n ** module id = 58\n ** module chunks = 0\n **/","require('../../modules/es6.object.assign');\nmodule.exports = require('../../modules/_core').Object.assign;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/fn/object/assign.js\n ** module id = 59\n ** module chunks = 0\n **/","// 19.1.3.1 Object.assign(target, source)\nvar $export = require('./_export');\n\n$export($export.S + $export.F, 'Object', {assign: require('./_object-assign')});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/es6.object.assign.js\n ** module id = 60\n ** module chunks = 0\n **/","'use strict';\n// 19.1.2.1 Object.assign(target, source, ...)\nvar getKeys  = require('./_object-keys')\n  , gOPS     = require('./_object-gops')\n  , pIE      = require('./_object-pie')\n  , toObject = require('./_to-object')\n  , IObject  = require('./_iobject')\n  , $assign  = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nmodule.exports = !$assign || require('./_fails')(function(){\n  var A = {}\n    , B = {}\n    , S = Symbol()\n    , K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function(k){ B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source){ // eslint-disable-line no-unused-vars\n  var T     = toObject(target)\n    , aLen  = arguments.length\n    , index = 1\n    , getSymbols = gOPS.f\n    , isEnum     = pIE.f;\n  while(aLen > index){\n    var S      = IObject(arguments[index++])\n      , keys   = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S)\n      , length = keys.length\n      , j      = 0\n      , key;\n    while(length > j)if(isEnum.call(S, key = keys[j++]))T[key] = S[key];\n  } return T;\n} : $assign;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-assign.js\n ** module id = 61\n ** module chunks = 0\n **/","exports.f = Object.getOwnPropertySymbols;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-gops.js\n ** module id = 62\n ** module chunks = 0\n **/","exports.f = {}.propertyIsEnumerable;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/core-js/library/modules/_object-pie.js\n ** module id = 63\n ** module chunks = 0\n **/","\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/babel-runtime/helpers/classCallCheck.js\n ** module id = 64\n ** module chunks = 0\n **/","\"use strict\";\n\nexports.__esModule = true;\n\nvar _defineProperty = require(\"../core-js/object/define-property\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      (0, _defineProperty2.default)(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/babel-runtime/helpers/createClass.js\n ** module id = 65\n ** module chunks = 0\n **/","var Pt = {}; (function() {var CanvasSpace, Circle, Color, Const, Curve, DOMSpace, Easing, Form, Grid, GridCascade, Line, Matrix, Noise, Pair, Particle, ParticleEmitter, ParticleField, ParticleSystem, Point, PointSet, QuadTree, Rectangle, SVGForm, SVGSpace, SamplePoints, Space, StripeBound, Timer, Triangle, UI, Util, Vector,\r\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\r\n  hasProp = {}.hasOwnProperty,\r\n  slice = [].slice;\r\n\r\nConst = (function() {\r\n  function Const() {}\r\n\r\n  Const.xy = 'xy';\r\n\r\n  Const.yz = 'yz';\r\n\r\n  Const.xz = 'xz';\r\n\r\n  Const.xyz = 'xyz';\r\n\r\n  Const.identical = -1;\r\n\r\n  Const.right = 3;\r\n\r\n  Const.bottom_right = 4;\r\n\r\n  Const.bottom = 5;\r\n\r\n  Const.bottom_left = 6;\r\n\r\n  Const.left = 7;\r\n\r\n  Const.top_left = 0;\r\n\r\n  Const.top = 1;\r\n\r\n  Const.top_right = 2;\r\n\r\n  Const.sideLabels = [\"identical\", \"right\", \"bottom right\", \"bottom\", \"bottom left\", \"left\", \"top left\", \"top\", \"top right\"];\r\n\r\n  Const.epsilon = 0.0001;\r\n\r\n  Const.pi = Math.PI;\r\n\r\n  Const.two_pi = 6.283185307179586;\r\n\r\n  Const.half_pi = 1.5707963267948966;\r\n\r\n  Const.quarter_pi = 0.7853981633974483;\r\n\r\n  Const.one_degree = 0.017453292519943295;\r\n\r\n  Const.rad_to_deg = 57.29577951308232;\r\n\r\n  Const.deg_to_rad = 0.017453292519943295;\r\n\r\n  Const.gravity = 9.81;\r\n\r\n  Const.newton = 0.10197;\r\n\r\n  Const.gaussian = 0.3989422804014327;\r\n\r\n  return Const;\r\n\r\n})();\r\n\r\nthis.Const = Const;\r\n\r\nMatrix = (function() {\r\n  function Matrix() {}\r\n\r\n  Matrix.rotateAnchor2D = function(radian, anchor, axis) {\r\n    var a, cosA, sinA;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    a = anchor.get2D(axis);\r\n    cosA = Math.cos(radian);\r\n    sinA = Math.sin(radian);\r\n    return [cosA, sinA, 0, -sinA, cosA, 0, a.x * (1 - cosA) + a.y * sinA, a.y * (1 - cosA) - a.x * sinA, 1];\r\n  };\r\n\r\n  Matrix.reflectAnchor2D = function(line, axis) {\r\n    var ang2, cosA, inc, sinA;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    inc = line.intercept(axis);\r\n    ang2 = Math.atan(inc.slope) * 2;\r\n    cosA = Math.cos(ang2);\r\n    sinA = Math.sin(ang2);\r\n    return [cosA, sinA, 0, sinA, -cosA, 0, -inc.yi * sinA, inc.yi + inc.yi * cosA, 1];\r\n  };\r\n\r\n  Matrix.shearAnchor2D = function(sx, sy, anchor, axis) {\r\n    var a, tx, ty;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    a = anchor.get2D(axis);\r\n    tx = Math.tan(sx);\r\n    ty = Math.tan(sy);\r\n    return [1, tx, 0, ty, 1, 0, -a.y * ty, -a.x * tx, 1];\r\n  };\r\n\r\n  Matrix.scaleAnchor2D = function(sx, sy, anchor, axis) {\r\n    var a;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    a = anchor.get2D(axis);\r\n    return [sx, 0, 0, 0, sy, 0, -a.x * sx + a.x, -a.y * sy + a.y, 1];\r\n  };\r\n\r\n  Matrix.scale2D = function(x, y) {\r\n    return [x, 0, 0, 0, y, 0, 0, 0, 1];\r\n  };\r\n\r\n  Matrix.shear2D = function(x, y) {\r\n    return [1, Math.tan(x), 0, Math.tan(y), 1, 0, 0, 0, 1];\r\n  };\r\n\r\n  Matrix.rotate2D = function(cosA, sinA) {\r\n    return [cosA, sinA, 0, -sinA, cosA, 0, 0, 0, 1];\r\n  };\r\n\r\n  Matrix.translate2D = function(x, y) {\r\n    return [1, 0, 0, 0, 1, 0, x, y, 1];\r\n  };\r\n\r\n  Matrix.transform2D = function(pt, m, axis, byValue) {\r\n    var v, x, y;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    if (byValue == null) {\r\n      byValue = false;\r\n    }\r\n    v = pt.get2D(axis);\r\n    x = v.x * m[0] + v.y * m[3] + m[6];\r\n    y = v.x * m[1] + v.y * m[4] + m[7];\r\n    v.x = x;\r\n    v.y = y;\r\n    v = v.get2D(axis, true);\r\n    if (!byValue) {\r\n      pt.set(v);\r\n      return pt;\r\n    }\r\n    return v;\r\n  };\r\n\r\n  return Matrix;\r\n\r\n})();\r\n\r\nthis.Matrix = Matrix;\r\n\r\nUtil = (function() {\r\n  function Util() {}\r\n\r\n  Util.toRadian = function(angle) {\r\n    return angle * Const.deg_to_rad;\r\n  };\r\n\r\n  Util.toDegree = function(radian) {\r\n    return radian * Const.rad_to_deg;\r\n  };\r\n\r\n  Util.toHexColor = function(number) {\r\n    var h;\r\n    h = Math.floor(number).toString(16);\r\n    if (h.length === 1) {\r\n      return \"0\" + h;\r\n    } else {\r\n      return h;\r\n    }\r\n  };\r\n\r\n  Util.toRGBColor = function(hexString, asRGBA, opacity) {\r\n    var b, g, r;\r\n    if (asRGBA == null) {\r\n      asRGBA = false;\r\n    }\r\n    if (opacity == null) {\r\n      opacity = 1;\r\n    }\r\n    if (hexString[0] === \"#\") {\r\n      hexString = hexString.substr(1);\r\n    }\r\n    if (hexString.length === 3) {\r\n      r = parseInt(hexString[0] + hexString[0], 16);\r\n      g = parseInt(hexString[1] + hexString[1], 16);\r\n      b = parseInt(hexString[2] + hexString[2], 16);\r\n    } else if (hexString.length >= 6) {\r\n      r = parseInt(hexString[0] + hexString[1], 16);\r\n      g = parseInt(hexString[2] + hexString[3], 16);\r\n      b = parseInt(hexString[4] + hexString[5], 16);\r\n    } else {\r\n      r = 0;\r\n      g = 0;\r\n      b = 0;\r\n    }\r\n    if (asRGBA) {\r\n      return \"rgba(\" + r + \",\" + g + \",\" + b + \",\" + opacity + \")\";\r\n    } else {\r\n      return [r, g, b, opacity];\r\n    }\r\n  };\r\n\r\n  Util.bound = function(val, max, positive) {\r\n    var a, half;\r\n    if (positive == null) {\r\n      positive = false;\r\n    }\r\n    a = val % max;\r\n    half = max / 2;\r\n    if (a > half) {\r\n      a -= max;\r\n    } else if (a < -half) {\r\n      a += max;\r\n    }\r\n    if (positive) {\r\n      if (a < 0) {\r\n        return a + max;\r\n      } else {\r\n        return a;\r\n      }\r\n    } else {\r\n      return a;\r\n    }\r\n  };\r\n\r\n  Util.boundAngle = function(ang, positive) {\r\n    return Util.bound(ang, 360, positive);\r\n  };\r\n\r\n  Util.boundRadian = function(radian, positive) {\r\n    return Util.bound(radian, Const.two_pi, positive);\r\n  };\r\n\r\n  Util.boundingBox = function(points, is3D) {\r\n    var aa, len1, maxPt, minPt, p;\r\n    if (is3D == null) {\r\n      is3D = false;\r\n    }\r\n    minPt = new Point(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY);\r\n    maxPt = new Point(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY);\r\n    for (aa = 0, len1 = points.length; aa < len1; aa++) {\r\n      p = points[aa];\r\n      if (p.x < minPt.x) {\r\n        minPt.x = p.x;\r\n      }\r\n      if (p.y < minPt.y) {\r\n        minPt.y = p.y;\r\n      }\r\n      if (p.x > maxPt.x) {\r\n        maxPt.x = p.x;\r\n      }\r\n      if (p.y > maxPt.y) {\r\n        maxPt.y = p.y;\r\n      }\r\n      if (is3D) {\r\n        if (p.z < minPt.z) {\r\n          minPt.z = p.z;\r\n        }\r\n        if (p.z > maxPt.z) {\r\n          maxPt.z = p.z;\r\n        }\r\n      }\r\n    }\r\n    return new Rectangle(minPt).to(maxPt);\r\n  };\r\n\r\n  Util.lerp = function(a, b, t) {\r\n    return (1 - t) * a + t * b;\r\n  };\r\n\r\n  Util.centroid = function(points) {\r\n    var aa, c, len1, p;\r\n    c = new Vector();\r\n    for (aa = 0, len1 = points.length; aa < len1; aa++) {\r\n      p = points[aa];\r\n      c.add(p);\r\n    }\r\n    return c.divide(points.length);\r\n  };\r\n\r\n  Util.same = function(a, b, threshold) {\r\n    if (threshold == null) {\r\n      threshold = Const.epsilon;\r\n    }\r\n    return Math.abs(a - b) < threshold;\r\n  };\r\n\r\n  Util.within = function(p, a, b) {\r\n    return p >= Math.min(a, b) && p <= Math.max(a, b);\r\n  };\r\n\r\n  Util.randomRange = function(a, b) {\r\n    var r;\r\n    if (b == null) {\r\n      b = 0;\r\n    }\r\n    r = a > b ? a - b : b - a;\r\n    return a + Math.random() * r;\r\n  };\r\n\r\n  Util.mixin = function(klass, mix) {\r\n    var k, v;\r\n    for (k in mix) {\r\n      v = mix[k];\r\n      if (mix.hasOwnProperty(k)) {\r\n        klass.prototype[k] = mix[k];\r\n      }\r\n    }\r\n    return klass;\r\n  };\r\n\r\n  Util.extend = function(klass, parent) {\r\n    klass.prototype = Object.create(parent.prototype);\r\n    klass.prototype.constructor = klass;\r\n    return klass;\r\n  };\r\n\r\n  Util.clonePoints = function(array) {\r\n    var aa, len1, p, results;\r\n    results = [];\r\n    for (aa = 0, len1 = array.length; aa < len1; aa++) {\r\n      p = array[aa];\r\n      results.push(p.clone());\r\n    }\r\n    return results;\r\n  };\r\n\r\n  Util.contextRotateOrigin = function(ctx, bound, radian, origin, mask) {\r\n    var msz, size;\r\n    if (origin == null) {\r\n      origin = false;\r\n    }\r\n    size = bound.size();\r\n    if (!origin) {\r\n      origin = size.$multiply(0.5);\r\n      origin.add(bound);\r\n    }\r\n    if (mask) {\r\n      msz = mask.size();\r\n      Form.rect(ctx, mask);\r\n      ctx.clip();\r\n    }\r\n    ctx.translate(origin.x, origin.y);\r\n    ctx.rotate(radian);\r\n    return ctx.translate(-origin.x, -origin.y);\r\n  };\r\n\r\n  Util.sinCosTable = function() {\r\n    var aa, cos, i, sin;\r\n    cos = [];\r\n    sin = [];\r\n    for (i = aa = 0; aa <= 360; i = aa += 1) {\r\n      cos[i] = Math.cos(i * Math.PI / 180);\r\n      sin[i] = Math.sin(i * Math.PI / 180);\r\n    }\r\n    return {\r\n      sin: sin,\r\n      cos: cos\r\n    };\r\n  };\r\n\r\n  Util.chance = function(p) {\r\n    return Math.random() < p;\r\n  };\r\n\r\n  Util.gaussian = function(x, mean, sigma) {\r\n    if (mean == null) {\r\n      mean = 0;\r\n    }\r\n    if (sigma == null) {\r\n      sigma = 1;\r\n    }\r\n    x = (x - mean) / sigma;\r\n    return Const.gaussian * Math.exp(-0.5 * x * x) / sigma;\r\n  };\r\n\r\n  return Util;\r\n\r\n})();\r\n\r\nthis.Util = Util;\r\n\r\nTimer = (function() {\r\n  function Timer(d) {\r\n    if (d == null) {\r\n      d = 1000;\r\n    }\r\n    this.duration = d;\r\n    this._time = 0;\r\n    this._ease = function(t, b, c, d) {\r\n      return t / d;\r\n    };\r\n    this._intervalID = -1;\r\n  }\r\n\r\n  Timer.prototype.start = function(reset) {\r\n    var diff;\r\n    diff = Math.min(Date.now() - this._time, this.duration);\r\n    if (reset || diff >= this.duration) {\r\n      return this._time = Date.now();\r\n    }\r\n  };\r\n\r\n  Timer.prototype.setEasing = function(ease) {\r\n    return this._ease = ease;\r\n  };\r\n\r\n  Timer.prototype.check = function() {\r\n    var diff;\r\n    diff = Math.min(Date.now() - this._time, this.duration);\r\n    return this._ease(diff, 0, 1, this.duration);\r\n  };\r\n\r\n  Timer.prototype.track = function(callback) {\r\n    var me;\r\n    clearInterval(this._intervalID);\r\n    this.start(true);\r\n    me = this;\r\n    this._intervalID = setInterval((function() {\r\n      var t;\r\n      t = me.check();\r\n      callback(t);\r\n      if (t >= 1) {\r\n        return clearInterval(me._intervalID);\r\n      }\r\n    }), 25);\r\n    return this._intervalID;\r\n  };\r\n\r\n  return Timer;\r\n\r\n})();\r\n\r\nthis.Timer = Timer;\r\n\r\nSpace = (function() {\r\n  function Space(id) {\r\n    if (id == null) {\r\n      id = 'space';\r\n    }\r\n    this.id = id;\r\n    this.size = new Vector();\r\n    this.center = new Vector();\r\n    this._timePrev = 0;\r\n    this._timeDiff = 0;\r\n    this._timeEnd = -1;\r\n    this.items = {};\r\n    this._animID = -1;\r\n    this._animCount = 0;\r\n    this._animPause = false;\r\n    this._refresh = true;\r\n  }\r\n\r\n  Space.prototype.refresh = function(b) {\r\n    this._refresh = b;\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.render = function(context) {\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.resize = function(w, h) {};\r\n\r\n  Space.prototype.clear = function() {};\r\n\r\n  Space.prototype.add = function(item) {\r\n    var k;\r\n    if ((item.animate != null) && typeof item.animate === 'function') {\r\n      k = this._animCount++;\r\n      this.items[k] = item;\r\n      item.animateID = k;\r\n      if (item.onSpaceResize != null) {\r\n        item.onSpaceResize(this.size.x, this.size.y);\r\n      }\r\n    } else {\r\n      throw \"a player object for Space.add must define animate()\";\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.remove = function(item) {\r\n    delete this.items[item.animateID];\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.removeAll = function() {\r\n    this.items = {};\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.play = function(time) {\r\n    var err;\r\n    if (time == null) {\r\n      time = 0;\r\n    }\r\n    this._animID = requestAnimationFrame((function(_this) {\r\n      return function(t) {\r\n        return _this.play(t);\r\n      };\r\n    })(this));\r\n    if (this._animPause) {\r\n      return;\r\n    }\r\n    this._timeDiff = time - this._timePrev;\r\n    try {\r\n      this._playItems(time);\r\n    } catch (_error) {\r\n      err = _error;\r\n      cancelAnimationFrame(this._animID);\r\n      console.error(err.stack);\r\n      throw err;\r\n    }\r\n    this._timePrev = time;\r\n    return this;\r\n  };\r\n\r\n  Space.prototype._playItems = function(time) {\r\n    var k, ref, v;\r\n    if (this._refresh) {\r\n      this.clear();\r\n    }\r\n    ref = this.items;\r\n    for (k in ref) {\r\n      v = ref[k];\r\n      v.animate(time, this._timeDiff, this.ctx);\r\n    }\r\n    if (this._timeEnd >= 0 && time > this._timeEnd) {\r\n      cancelAnimationFrame(this._animID);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.pause = function(toggle) {\r\n    if (toggle == null) {\r\n      toggle = false;\r\n    }\r\n    this._animPause = toggle ? !this._animPause : true;\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.resume = function() {\r\n    this._animPause = false;\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.stop = function(t) {\r\n    if (t == null) {\r\n      t = 0;\r\n    }\r\n    this._timeEnd = t;\r\n    return this;\r\n  };\r\n\r\n  Space.prototype.playTime = function(duration) {\r\n    if (duration == null) {\r\n      duration = 5000;\r\n    }\r\n    this.play();\r\n    return this.stop(duration);\r\n  };\r\n\r\n  return Space;\r\n\r\n})();\r\n\r\nthis.Space = Space;\r\n\r\nCanvasSpace = (function(superClass) {\r\n  extend(CanvasSpace, superClass);\r\n\r\n  function CanvasSpace(id, bgcolor, context) {\r\n    if (id == null) {\r\n      id = 'pt_space';\r\n    }\r\n    if (bgcolor == null) {\r\n      bgcolor = false;\r\n    }\r\n    if (context == null) {\r\n      context = '2d';\r\n    }\r\n    CanvasSpace.__super__.constructor.apply(this, arguments);\r\n    this.space = document.querySelector(\"#\" + this.id);\r\n    this.appended = true;\r\n    if (!this.space) {\r\n      this.space = document.createElement(\"canvas\");\r\n      this.space.setAttribute(\"id\", this.id);\r\n      this.appended = false;\r\n    }\r\n    this._mdown = false;\r\n    this._mdrag = false;\r\n    this.bgcolor = bgcolor;\r\n    this.ctx = this.space.getContext(context);\r\n  }\r\n\r\n  CanvasSpace.prototype.display = function(parent_id, readyCallback) {\r\n    var frame, frame_rect;\r\n    if (parent_id == null) {\r\n      parent_id = \"#pt\";\r\n    }\r\n    if (!this.appended) {\r\n      frame = document.querySelector(parent_id);\r\n      frame_rect = frame.getBoundingClientRect();\r\n      if (frame) {\r\n        this.resize(frame_rect.width, frame_rect.height);\r\n        window.addEventListener('resize', (function(evt) {\r\n          frame_rect = frame.getBoundingClientRect();\r\n          return this.resize(frame_rect.width, frame_rect.height, evt);\r\n        }).bind(this));\r\n        if (this.space.parentNode !== frame) {\r\n          frame.appendChild(this.space);\r\n        }\r\n        this.appended = true;\r\n        setTimeout((function() {\r\n          this.space.dispatchEvent(new Event('ready'));\r\n          if (readyCallback) {\r\n            return readyCallback(frame_rect.width, frame_rect.height, this.space);\r\n          }\r\n        }).bind(this));\r\n      } else {\r\n        throw 'Cannot add canvas to element ' + parent_id;\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  CanvasSpace.prototype.resize = function(w, h, evt) {\r\n    var k, p, ref;\r\n    this.size.set(w, h);\r\n    this.center = new Vector(w / 2, h / 2);\r\n    this.space.setAttribute('width', Math.floor(w));\r\n    this.space.setAttribute('height', Math.floor(h));\r\n    ref = this.items;\r\n    for (k in ref) {\r\n      p = ref[k];\r\n      if (p.onSpaceResize != null) {\r\n        p.onSpaceResize(w, h, evt);\r\n      }\r\n    }\r\n    this.render(this.ctx);\r\n    return this;\r\n  };\r\n\r\n  CanvasSpace.prototype.clear = function(bg) {\r\n    var lastColor;\r\n    if (bg) {\r\n      this.bgcolor = bg;\r\n    }\r\n    lastColor = this.ctx.fillStyle;\r\n    if (this.bgcolor) {\r\n      this.ctx.fillStyle = this.bgcolor;\r\n      this.ctx.fillRect(0, 0, this.size.x, this.size.y);\r\n    } else {\r\n      this.ctx.clearRect(0, 0, this.size.x, this.size.y);\r\n    }\r\n    this.ctx.fillStyle = lastColor;\r\n    return this;\r\n  };\r\n\r\n  CanvasSpace.prototype.animate = function(time) {\r\n    var k, ref, v;\r\n    this.ctx.save();\r\n    if (this._refresh) {\r\n      this.clear();\r\n    }\r\n    ref = this.items;\r\n    for (k in ref) {\r\n      v = ref[k];\r\n      v.animate(time, this._timeDiff, this.ctx);\r\n    }\r\n    if (this._timeEnd >= 0 && time > this._timeEnd) {\r\n      cancelAnimationFrame(this._animID);\r\n    }\r\n    this.ctx.restore();\r\n    return this;\r\n  };\r\n\r\n  CanvasSpace.prototype.bindCanvas = function(evt, callback) {\r\n    return this.space.addEventListener(evt, callback);\r\n  };\r\n\r\n  CanvasSpace.prototype.bindMouse = function(_bind) {\r\n    if (_bind == null) {\r\n      _bind = true;\r\n    }\r\n    if (_bind) {\r\n      this.space.addEventListener(\"mousedown\", this._mouseDown.bind(this));\r\n      this.space.addEventListener(\"mouseup\", this._mouseUp.bind(this));\r\n      this.space.addEventListener(\"mouseover\", this._mouseOver.bind(this));\r\n      this.space.addEventListener(\"mouseout\", this._mouseOut.bind(this));\r\n      return this.space.addEventListener(\"mousemove\", this._mouseMove.bind(this));\r\n    } else {\r\n      this.space.removeEventListener(\"mousedown\", this._mouseDown.bind(this));\r\n      this.space.removeEventListener(\"mouseup\", this._mouseUp.bind(this));\r\n      this.space.removeEventListener(\"mouseover\", this._mouseOver.bind(this));\r\n      this.space.removeEventListener(\"mouseout\", this._mouseOut.bind(this));\r\n      return this.space.removeEventListener(\"mousemove\", this._mouseMove.bind(this));\r\n    }\r\n  };\r\n\r\n  CanvasSpace.prototype._mouseAction = function(type, evt) {\r\n    var k, px, py, ref, results, v;\r\n    ref = this.items;\r\n    results = [];\r\n    for (k in ref) {\r\n      v = ref[k];\r\n      px = evt.offsetX || evt.layerX;\r\n      py = evt.offsetY || evt.layerY;\r\n      if (v.onMouseAction != null) {\r\n        results.push(v.onMouseAction(type, px, py, evt));\r\n      } else {\r\n        results.push(void 0);\r\n      }\r\n    }\r\n    return results;\r\n  };\r\n\r\n  CanvasSpace.prototype._mouseDown = function(evt) {\r\n    this._mouseAction(\"down\", evt);\r\n    return this._mdown = true;\r\n  };\r\n\r\n  CanvasSpace.prototype._mouseUp = function(evt) {\r\n    this._mouseAction(\"up\", evt);\r\n    if (this._mdrag) {\r\n      this._mouseAction(\"drop\", evt);\r\n    }\r\n    this._mdown = false;\r\n    return this._mdrag = false;\r\n  };\r\n\r\n  CanvasSpace.prototype._mouseMove = function(evt) {\r\n    this._mouseAction(\"move\", evt);\r\n    if (this._mdown) {\r\n      this._mdrag = true;\r\n      return this._mouseAction(\"drag\", evt);\r\n    }\r\n  };\r\n\r\n  CanvasSpace.prototype._mouseOver = function(evt) {\r\n    return this._mouseAction(\"over\", evt);\r\n  };\r\n\r\n  CanvasSpace.prototype._mouseOut = function(evt) {\r\n    this._mouseAction(\"out\", evt);\r\n    if (this._mdrag) {\r\n      this._mouseAction(\"drop\", evt);\r\n    }\r\n    return this._mdrag = false;\r\n  };\r\n\r\n  return CanvasSpace;\r\n\r\n})(Space);\r\n\r\nthis.CanvasSpace = CanvasSpace;\r\n\r\nDOMSpace = (function(superClass) {\r\n  extend(DOMSpace, superClass);\r\n\r\n  function DOMSpace(id, bgcolor, context) {\r\n    if (id == null) {\r\n      id = 'pt_space';\r\n    }\r\n    if (bgcolor == null) {\r\n      bgcolor = false;\r\n    }\r\n    if (context == null) {\r\n      context = 'html';\r\n    }\r\n    DOMSpace.__super__.constructor.apply(this, arguments);\r\n    this.space = document.querySelector(\"#\" + this.id);\r\n    this.css = {\r\n      width: \"100%\",\r\n      height: \"100%\"\r\n    };\r\n    this.appended = true;\r\n    if (!this.space) {\r\n      this._createSpaceElement();\r\n    }\r\n    this._mdown = false;\r\n    this._mdrag = false;\r\n    this.bgcolor = bgcolor;\r\n    this.ctx = {};\r\n  }\r\n\r\n  DOMSpace.prototype._createSpaceElement = function() {\r\n    this.space = document.createElement(\"div\");\r\n    this.space.setAttribute(\"id\", this.id);\r\n    return this.appended = false;\r\n  };\r\n\r\n  DOMSpace.prototype.setCSS = function(key, val, isPx) {\r\n    if (isPx == null) {\r\n      isPx = false;\r\n    }\r\n    this.css[key] = (isPx ? val + \"px\" : val);\r\n    return this;\r\n  };\r\n\r\n  DOMSpace.prototype.updateCSS = function() {\r\n    var k, ref, results, v;\r\n    ref = this.css;\r\n    results = [];\r\n    for (k in ref) {\r\n      v = ref[k];\r\n      results.push(this.space.style[k] = v);\r\n    }\r\n    return results;\r\n  };\r\n\r\n  DOMSpace.prototype.display = function(parent_id, readyCallback) {\r\n    var frame, frame_rect;\r\n    if (parent_id == null) {\r\n      parent_id = \"#pt\";\r\n    }\r\n    if (!this.appended) {\r\n      frame = document.querySelector(parent_id);\r\n      frame_rect = frame.getBoundingClientRect();\r\n      if (frame) {\r\n        this.resize(frame_rect.width, frame_rect.height);\r\n        window.addEventListener('resize', (function(evt) {\r\n          frame_rect = frame.getBoundingClientRect();\r\n          return this.resize(frame_rect.width, frame_rect.height, evt);\r\n        }).bind(this));\r\n        if (this.space.parentNode !== frame) {\r\n          frame.appendChild(this.space);\r\n        }\r\n        this.appended = true;\r\n        setTimeout((function() {\r\n          this.space.dispatchEvent(new Event('ready'));\r\n          if (readyCallback) {\r\n            return readyCallback(frame_rect.width, frame_rect.height, this.space);\r\n          }\r\n        }).bind(this));\r\n      } else {\r\n        throw 'Cannot add canvas to element ' + parent_id;\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  DOMSpace.prototype.resize = function(w, h, evt) {\r\n    var k, p, ref;\r\n    this.size.set(w, h);\r\n    this.center = new Vector(w / 2, h / 2);\r\n    ref = this.items;\r\n    for (k in ref) {\r\n      p = ref[k];\r\n      if (p.onSpaceResize != null) {\r\n        p.onSpaceResize(w, h, evt);\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  DOMSpace.prototype.clear = function() {\r\n    return this.space.innerHML = \"\";\r\n  };\r\n\r\n  DOMSpace.prototype.animate = function(time) {\r\n    var k, ref, v;\r\n    ref = this.items;\r\n    for (k in ref) {\r\n      v = ref[k];\r\n      v.animate(time, this._timeDiff, this.ctx);\r\n    }\r\n    if (this._timeEnd >= 0 && time > this._timeEnd) {\r\n      cancelAnimationFrame(this._animID);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  DOMSpace.prototype.bindCanvas = function(evt, callback) {\r\n    return this.space.addEventListener(evt, callback);\r\n  };\r\n\r\n  DOMSpace.prototype.bindMouse = function(_bind) {\r\n    if (_bind == null) {\r\n      _bind = true;\r\n    }\r\n    if (_bind) {\r\n      this.space.addEventListener(\"mousedown\", this._mouseDown.bind(this));\r\n      this.space.addEventListener(\"mouseup\", this._mouseUp.bind(this));\r\n      this.space.addEventListener(\"mouseover\", this._mouseOver.bind(this));\r\n      this.space.addEventListener(\"mouseout\", this._mouseOut.bind(this));\r\n      return this.space.addEventListener(\"mousemove\", this._mouseMove.bind(this));\r\n    } else {\r\n      this.space.removeEventListener(\"mousedown\", this._mouseDown.bind(this));\r\n      this.space.removeEventListener(\"mouseup\", this._mouseUp.bind(this));\r\n      this.space.removeEventListener(\"mouseover\", this._mouseOver.bind(this));\r\n      this.space.removeEventListener(\"mouseout\", this._mouseOut.bind(this));\r\n      return this.space.removeEventListener(\"mousemove\", this._mouseMove.bind(this));\r\n    }\r\n  };\r\n\r\n  DOMSpace.prototype._mouseAction = function(type, evt) {\r\n    var k, px, py, ref, results, v;\r\n    ref = this.items;\r\n    results = [];\r\n    for (k in ref) {\r\n      v = ref[k];\r\n      px = evt.offsetX || evt.layerX;\r\n      py = evt.offsetY || evt.layerY;\r\n      if (v.onMouseAction != null) {\r\n        results.push(v.onMouseAction(type, px, py, evt));\r\n      } else {\r\n        results.push(void 0);\r\n      }\r\n    }\r\n    return results;\r\n  };\r\n\r\n  DOMSpace.prototype._mouseDown = function(evt) {\r\n    this._mouseAction(\"down\", evt);\r\n    return this._mdown = true;\r\n  };\r\n\r\n  DOMSpace.prototype._mouseUp = function(evt) {\r\n    this._mouseAction(\"up\", evt);\r\n    if (this._mdrag) {\r\n      this._mouseAction(\"drop\", evt);\r\n    }\r\n    this._mdown = false;\r\n    return this._mdrag = false;\r\n  };\r\n\r\n  DOMSpace.prototype._mouseMove = function(evt) {\r\n    this._mouseAction(\"move\", evt);\r\n    if (this._mdown) {\r\n      this._mdrag = true;\r\n      return this._mouseAction(\"drag\", evt);\r\n    }\r\n  };\r\n\r\n  DOMSpace.prototype._mouseOver = function(evt) {\r\n    return this._mouseAction(\"over\", evt);\r\n  };\r\n\r\n  DOMSpace.prototype._mouseOut = function(evt) {\r\n    this._mouseAction(\"out\", evt);\r\n    if (this._mdrag) {\r\n      this._mouseAction(\"drop\", evt);\r\n    }\r\n    return this._mdrag = false;\r\n  };\r\n\r\n  DOMSpace.attr = function(elem, data) {\r\n    var k, results, v;\r\n    results = [];\r\n    for (k in data) {\r\n      v = data[k];\r\n      results.push(elem.setAttribute(k, v));\r\n    }\r\n    return results;\r\n  };\r\n\r\n  DOMSpace.css = function(data) {\r\n    var k, str, v;\r\n    str = \"\";\r\n    for (k in data) {\r\n      v = data[k];\r\n      if (v) {\r\n        str += k + \": \" + v + \"; \";\r\n      }\r\n    }\r\n    return str;\r\n  };\r\n\r\n  return DOMSpace;\r\n\r\n})(Space);\r\n\r\nthis.DOMSpace = DOMSpace;\r\n\r\nForm = (function() {\r\n  function Form(space) {\r\n    this.cc = space.ctx;\r\n    this.cc.fillStyle = '#999';\r\n    this.cc.strokeStyle = '#666';\r\n    this.cc.lineWidth = 1;\r\n    this.cc.font = \"11px sans-serif\";\r\n    this.filled = true;\r\n    this.stroked = true;\r\n    this.fontSize = 11;\r\n    this.fontFace = \"sans-serif\";\r\n  }\r\n\r\n  Form.context = function(canvas_id) {\r\n    var cc, elem;\r\n    elem = document.getElementById(canvas_id);\r\n    cc = elem && elem.getContext ? elem.getContext('2d') : false;\r\n    if (!cc) {\r\n      throw \"Cannot initiate canvas 2d context\";\r\n    }\r\n    return cc;\r\n  };\r\n\r\n  Form.line = function(ctx, pair) {\r\n    if (!pair.p1) {\r\n      throw (pair.toString()) + \" is not a Pair\";\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(pair.x, pair.y);\r\n    ctx.lineTo(pair.p1.x, pair.p1.y);\r\n    return ctx.stroke();\r\n  };\r\n\r\n  Form.lines = function(ctx, pairs) {\r\n    var aa, len1, ln, results;\r\n    results = [];\r\n    for (aa = 0, len1 = pairs.length; aa < len1; aa++) {\r\n      ln = pairs[aa];\r\n      results.push(Form.line(ctx, ln));\r\n    }\r\n    return results;\r\n  };\r\n\r\n  Form.rect = function(ctx, pair, fill, stroke) {\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    if (!pair.p1) {\r\n      throw \"\" + (pair.toString() === !a(Pair));\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(pair.x, pair.y);\r\n    ctx.lineTo(pair.x, pair.p1.y);\r\n    ctx.lineTo(pair.p1.x, pair.p1.y);\r\n    ctx.lineTo(pair.p1.x, pair.y);\r\n    ctx.closePath();\r\n    if (stroke) {\r\n      ctx.stroke();\r\n    }\r\n    if (fill) {\r\n      return ctx.fill();\r\n    }\r\n  };\r\n\r\n  Form.circle = function(ctx, c, fill, stroke) {\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    ctx.beginPath();\r\n    ctx.arc(c.x, c.y, c.radius, 0, Const.two_pi, false);\r\n    if (fill) {\r\n      ctx.fill();\r\n    }\r\n    if (stroke) {\r\n      ctx.stroke();\r\n    }\r\n  };\r\n\r\n  Form.triangle = function(ctx, tri, fill, stroke) {\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(tri.x, tri.y);\r\n    ctx.lineTo(tri.p1.x, tri.p1.y);\r\n    ctx.lineTo(tri.p2.x, tri.p2.y);\r\n    ctx.closePath();\r\n    if (fill) {\r\n      ctx.fill();\r\n    }\r\n    if (stroke) {\r\n      ctx.stroke();\r\n    }\r\n  };\r\n\r\n  Form.point = function(ctx, pt, halfsize, fill, stroke, circle) {\r\n    var x1, x2, y1, y2;\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    if (circle == null) {\r\n      circle = false;\r\n    }\r\n    if (circle) {\r\n      ctx.beginPath();\r\n      ctx.arc(pt.x, pt.y, halfsize, 0, Const.two_pi, false);\r\n    } else {\r\n      x1 = pt.x - halfsize;\r\n      y1 = pt.y - halfsize;\r\n      x2 = pt.x + halfsize;\r\n      y2 = pt.y + halfsize;\r\n      ctx.beginPath();\r\n      ctx.moveTo(x1, y1);\r\n      ctx.lineTo(x1, y2);\r\n      ctx.lineTo(x2, y2);\r\n      ctx.lineTo(x2, y1);\r\n      ctx.closePath();\r\n    }\r\n    if (fill) {\r\n      ctx.fill();\r\n    }\r\n    if (stroke) {\r\n      ctx.stroke();\r\n    }\r\n    return pt;\r\n  };\r\n\r\n  Form.points = function(ctx, pts, halfsize, fill, stroke, circle) {\r\n    var aa, len1, p, results;\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    if (circle == null) {\r\n      circle = false;\r\n    }\r\n    results = [];\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      results.push(Form.point(ctx, p, halfsize, fill, stroke, circle));\r\n    }\r\n    return results;\r\n  };\r\n\r\n  Form.polygon = function(ctx, pts, closePath, fill, stroke) {\r\n    var aa, i, ref;\r\n    if (closePath == null) {\r\n      closePath = true;\r\n    }\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = true;\r\n    }\r\n    if (pts.length <= 1) {\r\n      return;\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(pts[0].x, pts[0].y);\r\n    for (i = aa = 1, ref = pts.length; aa < ref; i = aa += 1) {\r\n      ctx.lineTo(pts[i].x, pts[i].y);\r\n    }\r\n    if (closePath) {\r\n      ctx.closePath();\r\n    }\r\n    if (fill) {\r\n      ctx.fill();\r\n    }\r\n    if (stroke) {\r\n      ctx.stroke();\r\n    }\r\n  };\r\n\r\n  Form.curve = function(ctx, pts) {\r\n    return Form.polygon(ctx, pts, false, false, true);\r\n  };\r\n\r\n  Form.text = function(ctx, pt, txt, maxWidth) {\r\n    return ctx.fillText(txt, pt.x, pt.y, maxWidth);\r\n  };\r\n\r\n  Form.prototype.fill = function(c) {\r\n    this.cc.fillStyle = c ? c : \"transparent\";\r\n    this.filled = !!c;\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.stroke = function(c, width, joint) {\r\n    this.cc.strokeStyle = c ? c : \"transparent\";\r\n    this.stroked = !!c;\r\n    if (width) {\r\n      this.cc.lineWidth = width;\r\n    }\r\n    if (joint) {\r\n      this.cc.lineJoin = joint;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.font = function(size, face) {\r\n    if (face == null) {\r\n      face = this.fontFace;\r\n    }\r\n    this.fontSize = size;\r\n    this.cc.font = size + \"px \" + face;\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.draw = function(shape) {\r\n    return this.sketch(shape);\r\n  };\r\n\r\n  Form.prototype.sketch = function(shape) {\r\n    shape.floor();\r\n    if (shape instanceof Circle) {\r\n      Form.circle(this.cc, shape, this.filled, this.stroked);\r\n    } else if (shape instanceof Rectangle) {\r\n      Form.rect(this.cc, shape, this.filled, this.stroked);\r\n    } else if (shape instanceof Triangle) {\r\n      Form.triangle(this.cc, shape, this.filled, this.stroked);\r\n    } else if (shape instanceof Line || shape instanceof Pair) {\r\n      Form.line(this.cc, shape);\r\n    } else if (shape instanceof PointSet) {\r\n      Form.polygon(this.cc, shape.points);\r\n    } else if (shape instanceof Vector || shape instanceof Point) {\r\n      Form.point(this.cc, shape);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.point = function(p, halfsize, isCircle) {\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (isCircle == null) {\r\n      isCircle = false;\r\n    }\r\n    Form.point(this.cc, p, halfsize, this.filled, this.stroked, isCircle);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.points = function(ps, halfsize, isCircle) {\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (isCircle == null) {\r\n      isCircle = false;\r\n    }\r\n    Form.points(this.cc, ps, halfsize, this.filled, this.stroked, isCircle);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.line = function(p) {\r\n    Form.line(this.cc, p);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.lines = function(ps) {\r\n    Form.lines(this.cc, ps);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.rect = function(p) {\r\n    Form.rect(this.cc, p, this.filled, this.stroked);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.circle = function(p) {\r\n    Form.circle(this.cc, p, this.filled, this.stroked);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.triangle = function(p) {\r\n    Form.triangle(this.cc, p, this.filled, this.stroked);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.polygon = function(ps, closePath) {\r\n    Form.polygon(this.cc, ps, closePath, this.filled, this.stroked);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.curve = function(ps) {\r\n    Form.curve(this.cc, ps);\r\n    return this;\r\n  };\r\n\r\n  Form.prototype.text = function(p, txt, maxWidth, xoff, yoff) {\r\n    var pos;\r\n    if (maxWidth == null) {\r\n      maxWidth = 1000;\r\n    }\r\n    pos = new Vector(p);\r\n    if (xoff) {\r\n      pos.add(xoff, 0);\r\n    }\r\n    if (yoff) {\r\n      pos.add(0, yoff);\r\n    }\r\n    this.cc.fillText(txt, pos.x, pos.y, maxWidth);\r\n    return this;\r\n  };\r\n\r\n  return Form;\r\n\r\n})();\r\n\r\nthis.Form = Form;\r\n\r\nPoint = (function() {\r\n  function Point(args) {\r\n    this.copy(Point.get(arguments));\r\n  }\r\n\r\n  Point.get = function(args) {\r\n    if (args.length > 0) {\r\n      if (typeof args[0] === 'object') {\r\n        if (args[0] instanceof Array || args[0].length > 0) {\r\n          return {\r\n            x: args[0][0] || 0,\r\n            y: args[0][1] || 0,\r\n            z: args[0][2] || 0\r\n          };\r\n        } else {\r\n          return {\r\n            x: args[0].x || 0,\r\n            y: args[0].y || 0,\r\n            z: args[0].z || 0\r\n          };\r\n        }\r\n      } else {\r\n        return {\r\n          x: args[0] || 0,\r\n          y: args[1] || 0,\r\n          z: args[2] || 0\r\n        };\r\n      }\r\n    } else {\r\n      return {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0\r\n      };\r\n    }\r\n  };\r\n\r\n  Point.prototype.quadrant = function(pt, epsilon) {\r\n    if (epsilon == null) {\r\n      epsilon = Const.epsilon;\r\n    }\r\n    if (pt.near(this)) {\r\n      return Const.identical;\r\n    }\r\n    if (Math.abs(pt.x - this.x) < epsilon) {\r\n      if (pt.y < this.y) {\r\n        return Const.top;\r\n      } else {\r\n        return Const.bottom;\r\n      }\r\n    }\r\n    if (Math.abs(pt.y - this.y) < epsilon) {\r\n      if (pt.x < this.x) {\r\n        return Const.left;\r\n      } else {\r\n        return Const.right;\r\n      }\r\n    }\r\n    if (pt.y < this.y && pt.x > this.x) {\r\n      return Const.top_right;\r\n    } else if (pt.y < this.y && pt.x < this.x) {\r\n      return Const.top_left;\r\n    } else if (pt.y > this.y && pt.x < this.x) {\r\n      return Const.bottom_left;\r\n    } else {\r\n      return Const.bottom_right;\r\n    }\r\n  };\r\n\r\n  Point.prototype.set = function(args) {\r\n    var p;\r\n    p = Point.get(arguments);\r\n    this.x = p.x;\r\n    this.y = p.y;\r\n    this.z = p.z;\r\n    return this;\r\n  };\r\n\r\n  Point.prototype.copy = function(p) {\r\n    this.x = p.x;\r\n    this.y = p.y;\r\n    this.z = p.z;\r\n    return this;\r\n  };\r\n\r\n  Point.prototype.clone = function() {\r\n    return new Point(this);\r\n  };\r\n\r\n  Point.prototype.toString = function() {\r\n    return \"Point \" + this.x + \", \" + this.y + \", \" + this.z;\r\n  };\r\n\r\n  Point.prototype.toArray = function() {\r\n    return [this];\r\n  };\r\n\r\n  Point.prototype.get2D = function(axis, reverse) {\r\n    if (reverse == null) {\r\n      reverse = false;\r\n    }\r\n    if (axis === Const.xy) {\r\n      return new this.__proto__.constructor(this);\r\n    }\r\n    if (axis === Const.xz) {\r\n      return new this.__proto__.constructor(this.x, this.z, this.y);\r\n    }\r\n    if (axis === Const.yz) {\r\n      if (reverse) {\r\n        return new this.__proto__.constructor(this.z, this.x, this.y);\r\n      } else {\r\n        return new this.__proto__.constructor(this.y, this.z, this.x);\r\n      }\r\n    }\r\n    return new this.__proto__.constructor(this);\r\n  };\r\n\r\n  Point.prototype.min = function(args) {\r\n    var _p;\r\n    _p = Point.get(arguments);\r\n    this.x = Math.min(this.x, _p.x);\r\n    this.y = Math.min(this.y, _p.y);\r\n    this.z = Math.min(this.z, _p.z);\r\n    return this;\r\n  };\r\n\r\n  Point.prototype.$min = function(args) {\r\n    var _p;\r\n    _p = Point.get(arguments);\r\n    return new this.__proto__.constructor(Math.min(this.x, _p.x), Math.min(this.y, _p.y), Math.min(this.z, _p.z));\r\n  };\r\n\r\n  Point.prototype.max = function(args) {\r\n    var _p;\r\n    _p = Point.get(arguments);\r\n    this.x = Math.max(this.x, _p.x);\r\n    this.y = Math.max(this.y, _p.y);\r\n    this.z = Math.max(this.z, _p.z);\r\n    return this;\r\n  };\r\n\r\n  Point.prototype.$max = function(args) {\r\n    var _p;\r\n    _p = Point.get(arguments);\r\n    return new this.__proto__.constructor(Math.max(this.x, _p.x), Math.max(this.y, _p.y), Math.max(this.z, _p.z));\r\n  };\r\n\r\n  Point.prototype.equal = function(args) {\r\n    var _p;\r\n    _p = Point.get(arguments);\r\n    return (_p.x === this.x) && (_p.y === this.y) && (_p.z === this.z);\r\n  };\r\n\r\n  Point.prototype.near = function(pt, epsilon) {\r\n    var _p;\r\n    if (epsilon == null) {\r\n      epsilon = Const.epsilon;\r\n    }\r\n    _p = Point.get(arguments);\r\n    return (Math.abs(_p.x - this.x) < epsilon) && (Math.abs(_p.y - this.y) < epsilon) && (Math.abs(_p.z - this.z) < epsilon);\r\n  };\r\n\r\n  Point.prototype.floor = function() {\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n    return this;\r\n  };\r\n\r\n  Point.prototype.ceil = function() {\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n    return this;\r\n  };\r\n\r\n  return Point;\r\n\r\n})();\r\n\r\nthis.Point = Point;\r\n\r\nVector = (function(superClass) {\r\n  extend(Vector, superClass);\r\n\r\n  function Vector() {\r\n    Vector.__super__.constructor.apply(this, arguments);\r\n  }\r\n\r\n  Vector.prototype._getArgs = function(args) {\r\n    if (typeof args[0] === 'number' && args.length > 1) {\r\n      return args;\r\n    } else {\r\n      return args[0];\r\n    }\r\n  };\r\n\r\n  Vector.prototype.add = function(args) {\r\n    var _p;\r\n    if (typeof arguments[0] === 'number' && arguments.length === 1) {\r\n      this.x += arguments[0];\r\n      this.y += arguments[0];\r\n      this.z += arguments[0];\r\n    } else {\r\n      _p = Point.get(arguments);\r\n      this.x += _p.x;\r\n      this.y += _p.y;\r\n      this.z += _p.z;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.$add = function(args) {\r\n    var a;\r\n    a = this._getArgs(arguments);\r\n    return new Vector(this).add(a);\r\n  };\r\n\r\n  Vector.prototype.subtract = function(args) {\r\n    var _p;\r\n    if (typeof arguments[0] === 'number' && arguments.length === 1) {\r\n      this.x -= arguments[0];\r\n      this.y -= arguments[0];\r\n      this.z -= arguments[0];\r\n    } else {\r\n      _p = Point.get(arguments);\r\n      this.x -= _p.x;\r\n      this.y -= _p.y;\r\n      this.z -= _p.z;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.$subtract = function(args) {\r\n    var a;\r\n    a = this._getArgs(arguments);\r\n    return new Vector(this).subtract(a);\r\n  };\r\n\r\n  Vector.prototype.multiply = function(args) {\r\n    var _p;\r\n    if (arguments.length === 1 && (typeof arguments[0] === 'number' || (typeof arguments[0] === 'object' && arguments[0].length === 1))) {\r\n      this.x *= arguments[0];\r\n      this.y *= arguments[0];\r\n      this.z *= arguments[0];\r\n    } else {\r\n      _p = Point.get(arguments);\r\n      this.x *= _p.x;\r\n      this.y *= _p.y;\r\n      this.z *= _p.z;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.$multiply = function(args) {\r\n    var a;\r\n    a = this._getArgs(arguments);\r\n    return new Vector(this).multiply(a);\r\n  };\r\n\r\n  Vector.prototype.divide = function(args) {\r\n    var _p;\r\n    if (arguments.length === 1 && (typeof arguments[0] === 'number' || (typeof arguments[0] === 'object' && arguments[0].length === 1))) {\r\n      this.x /= arguments[0];\r\n      this.y /= arguments[0];\r\n      this.z /= arguments[0];\r\n    } else {\r\n      _p = Point.get(arguments);\r\n      this.x /= _p.x;\r\n      this.y /= _p.y;\r\n      this.z /= _p.z;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.$divide = function(args) {\r\n    var a;\r\n    a = this._getArgs(arguments);\r\n    return new Vector(this).divide(a);\r\n  };\r\n\r\n  Vector.prototype.op = function() {\r\n    var aa, args, len1, name, p, pts;\r\n    name = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      p[name].apply(p, args);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.$op = function() {\r\n    var aa, args, instance, len1, name, p, pts;\r\n    name = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\r\n    instance = this.clone();\r\n    pts = instance.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      p[name].apply(p, args);\r\n    }\r\n    return instance;\r\n  };\r\n\r\n  Vector.prototype.angle = function(args) {\r\n    var axis, p;\r\n    if (arguments.length === 0) {\r\n      return Math.atan2(this.y, this.x);\r\n    }\r\n    if (typeof arguments[0] === 'string') {\r\n      axis = arguments[0];\r\n      p = arguments.length > 1 ? this.$subtract(arguments[1]).multiply(-1) : void 0;\r\n    } else {\r\n      p = this.$subtract(arguments[0]).multiply(-1);\r\n      axis = false;\r\n    }\r\n    if (p && !axis) {\r\n      return Math.atan2(p.y, p.x);\r\n    } else if (axis === Const.xy) {\r\n      if (p) {\r\n        return Math.atan2(p.y, p.x);\r\n      } else {\r\n        return Math.atan2(this.y, this.x);\r\n      }\r\n    } else if (axis === Const.yz) {\r\n      if (p) {\r\n        return Math.atan2(p.z, p.y);\r\n      } else {\r\n        return Math.atan2(this.z, this.y);\r\n      }\r\n    } else if (axis === Const.xz) {\r\n      if (p) {\r\n        return Math.atan2(p.z, p.x);\r\n      } else {\r\n        return Math.atan2(this.z, this.x);\r\n      }\r\n    }\r\n  };\r\n\r\n  Vector.prototype.angleBetween = function(vec, axis) {\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    return Util.boundRadian(this.angle(axis), true) - Util.boundRadian(vec.angle(axis), true);\r\n  };\r\n\r\n  Vector.prototype.magnitude = function(args) {\r\n    var _sq, axis, m, mag, p, useSq;\r\n    m = {\r\n      x: this.x * this.x,\r\n      y: this.y * this.y,\r\n      z: this.z * this.z\r\n    };\r\n    useSq = arguments.length >= 1 && !arguments[arguments.length - 1];\r\n    _sq = useSq ? (function(x) {\r\n      return x;\r\n    }) : Math.sqrt;\r\n    if (arguments.length === 0) {\r\n      return _sq(m.x + m.y + m.z);\r\n    }\r\n    if (typeof arguments[0] === 'string') {\r\n      axis = arguments[0];\r\n      if (arguments.length > 1 && arguments[1]) {\r\n        p = this.$subtract(arguments[1]);\r\n      } else {\r\n        p = void 0;\r\n      }\r\n    } else {\r\n      p = this.$subtract(arguments[0]);\r\n      axis = false;\r\n    }\r\n    mag = p ? {\r\n      x: p.x * p.x,\r\n      y: p.y * p.y,\r\n      z: p.z * p.z\r\n    } : m;\r\n    if (p && !axis) {\r\n      return _sq(mag.x + mag.y + mag.z);\r\n    } else if (axis === Const.xy) {\r\n      return _sq(mag.x + mag.y);\r\n    } else if (axis === Const.yz) {\r\n      return _sq(mag.y + mag.z);\r\n    } else if (axis === Const.xz) {\r\n      return _sq(mag.x + mag.z);\r\n    }\r\n  };\r\n\r\n  Vector.prototype.distance = function(pt, axis) {\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    return this.magnitude(axis, pt);\r\n  };\r\n\r\n  Vector.prototype.normalize = function() {\r\n    this.set(this.$normalize());\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.$normalize = function() {\r\n    var m;\r\n    m = this.magnitude();\r\n    if (m === 0) {\r\n      return new Vector();\r\n    } else {\r\n      return new Vector(this.x / m, this.y / m, this.z / m);\r\n    }\r\n  };\r\n\r\n  Vector.prototype.abs = function() {\r\n    this.x = Math.abs(this.x);\r\n    this.y = Math.abs(this.y);\r\n    this.z = Math.abs(this.z);\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.dot = function(p, axis) {\r\n    if (axis == null) {\r\n      axis = Const.xyz;\r\n    }\r\n    if (axis === Const.xyz) {\r\n      return this.x * p.x + this.y * p.y + this.z * p.z;\r\n    } else if (axis === Const.xy) {\r\n      return this.x * p.x + this.y * p.y;\r\n    } else if (axis === Const.yz) {\r\n      return this.y * p.y + this.z * p.z;\r\n    } else if (axis === Const.xz) {\r\n      return this.x * p.x + this.z * p.z;\r\n    } else {\r\n      return this.x * p.x + this.y * p.y + this.z * p.z;\r\n    }\r\n  };\r\n\r\n  Vector.prototype.projection = function(vec, axis) {\r\n    var a, b, dot, m;\r\n    if (axis == null) {\r\n      axis = Const.xyz;\r\n    }\r\n    m = vec.magnitude();\r\n    a = this.$normalize();\r\n    b = new Vector(vec.x / m, vec.y / m, vec.z / m);\r\n    dot = a.dot(b, axis);\r\n    return a.$multiply(m * dot);\r\n  };\r\n\r\n  Vector.prototype.cross = function(p) {\r\n    return new Vector(this.y * p.z - this.z * p.y, this.z * p.x - this.x * p.z, this.x * p.y - this.y * p.x);\r\n  };\r\n\r\n  Vector.prototype.bisect = function(vec, isNormalized) {\r\n    if (isNormalized == null) {\r\n      isNormalized = false;\r\n    }\r\n    if (isNormalized) {\r\n      return this.$add(vec).divide(2);\r\n    } else {\r\n      return this.$normalize().add(vec.$normalize()).divide(2);\r\n    }\r\n  };\r\n\r\n  Vector.prototype.perpendicular = function(axis) {\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    switch (axis) {\r\n      case Const.xy:\r\n        return [new Vector(-this.y, this.x, this.z), new Vector(this.y, -this.x, this.z)];\r\n      case Const.yz:\r\n        return [new Vector(this.x, -this.z, this.y), new Vector(this.x, this.z, -this.y)];\r\n      case Const.xz:\r\n        return [new Vector(-this.z, this.y, this.x), new Vector(this.z, -this.y, this.x)];\r\n      default:\r\n        return [new Vector(-this.y, this.x, this.z), new Vector(this.y, -this.x, this.z)];\r\n    }\r\n  };\r\n\r\n  Vector.prototype.isPerpendicular = function(p, axis) {\r\n    if (axis == null) {\r\n      axis = Const.xyz;\r\n    }\r\n    return this.dot(p, axis) === 0;\r\n  };\r\n\r\n  Vector.prototype.surfaceNormal = function(p) {\r\n    return this.cross(p).normalize(true);\r\n  };\r\n\r\n  Vector.prototype.moveTo = function(args) {\r\n    var aa, d, len1, p, pts, target;\r\n    target = Point.get(arguments);\r\n    d = this.$subtract(target);\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      p.subtract(d);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.moveBy = function(args) {\r\n    var aa, inc, len1, p, pts;\r\n    inc = Point.get(arguments);\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      p.add(inc);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.rotate2D = function(radian, anchor, axis) {\r\n    var aa, len1, mx, p, pts;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    if (!anchor) {\r\n      anchor = new Point(0, 0, 0);\r\n    }\r\n    mx = Matrix.rotateAnchor2D(radian, anchor, axis);\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      Matrix.transform2D(p, mx, axis);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.reflect2D = function(line, axis) {\r\n    var aa, len1, mx, p, pts;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    mx = Matrix.reflectAnchor2D(line, axis);\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      Matrix.transform2D(p, mx, axis);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.scale2D = function(sx, sy, anchor, axis) {\r\n    var aa, len1, mx, p, pts;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    if (!anchor) {\r\n      anchor = new Point(0, 0, 0);\r\n    }\r\n    mx = Matrix.scaleAnchor2D(sx, sy, anchor, axis);\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      Matrix.transform2D(p, mx, axis);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.shear2D = function(sx, sy, anchor, axis) {\r\n    var aa, len1, mx, p, pts;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    if (!anchor) {\r\n      anchor = new Point(0, 0, 0);\r\n    }\r\n    mx = Matrix.shearAnchor2D(sx, sy, anchor, axis);\r\n    pts = this.toArray();\r\n    for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n      p = pts[aa];\r\n      Matrix.transform2D(p, mx, axis);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Vector.prototype.clone = function() {\r\n    return new Vector(this);\r\n  };\r\n\r\n  Vector.prototype.toString = function() {\r\n    return \"Vector \" + this.x + \", \" + this.y + \", \" + this.z;\r\n  };\r\n\r\n  return Vector;\r\n\r\n})(Point);\r\n\r\nthis.Vector = Vector;\r\n\r\nColor = (function(superClass) {\r\n  extend(Color, superClass);\r\n\r\n  function Color(args) {\r\n    Color.__super__.constructor.apply(this, arguments);\r\n    this.alpha = arguments.length >= 4 ? Math.min(1, Math.max(arguments[3], 0)) : 1;\r\n    this.mode = arguments.length >= 5 ? arguments[4] : 'rgb';\r\n  }\r\n\r\n  Color.XYZ = {\r\n    D65: {\r\n      x: 95.047,\r\n      y: 100,\r\n      z: 108.883\r\n    }\r\n  };\r\n\r\n  Color.parseHex = function(hex, asColor) {\r\n    var hexValue, rgb;\r\n    if (asColor == null) {\r\n      asColor = false;\r\n    }\r\n    if (hex.indexOf('#') === 0) {\r\n      hex = hex.substr(1);\r\n    }\r\n    if (hex.length === 3) {\r\n      hex = \"\" + hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\r\n    }\r\n    if (hex.length === 8) {\r\n      this.alpha = hex.substr(6) & 0xFF / 255;\r\n      hex = hex.substring(0, 6);\r\n    }\r\n    hexValue = parseInt(hex, 16);\r\n    rgb = [hexValue >> 16, hexValue >> 8 & 0xFF, hexValue & 0xFF];\r\n    if (asColor) {\r\n      return new Color(rgb[0], rgb[1], rgb[2]);\r\n    } else {\r\n      return rgb;\r\n    }\r\n  };\r\n\r\n  Color.prototype.setMode = function(m) {\r\n    m = m.toLowerCase();\r\n    if (m !== this.mode) {\r\n      switch (this.mode) {\r\n        case 'hsl':\r\n          this.copy(Point.get(Color.HSLtoRGB(this.x, this.y, this.z)));\r\n          break;\r\n        case 'hsb':\r\n          this.copy(Point.get(Color.HSBtoRGB(this.x, this.y, this.z)));\r\n          break;\r\n        case 'lab':\r\n          this.copy(Point.get(Color.LABtoRGB(this.x, this.y, this.z)));\r\n          break;\r\n        case 'lch':\r\n          this.copy(Point.get(Color.LCHtoRGB(this.x, this.y, this.z)));\r\n          break;\r\n        case 'xyz':\r\n          this.copy(Point.get(Color.XYZtoRGB(this.x, this.y, this.z)));\r\n      }\r\n      switch (m) {\r\n        case 'hsl':\r\n          this.copy(Point.get(Color.RGBtoHSL(this.x, this.y, this.z)));\r\n          break;\r\n        case 'hsb':\r\n          this.copy(Point.get(Color.RGBtoHSB(this.x, this.y, this.z)));\r\n          break;\r\n        case 'lab':\r\n          this.copy(Point.get(Color.RGBtoLAB(this.x, this.y, this.z)));\r\n          break;\r\n        case 'lch':\r\n          this.copy(Point.get(Color.RGBtoLCH(this.x, this.y, this.z)));\r\n          break;\r\n        case 'xyz':\r\n          this.copy(Point.get(Color.RGBtoXYZ(this.x, this.y, this.z)));\r\n      }\r\n    }\r\n    this.mode = m;\r\n    return this;\r\n  };\r\n\r\n  Color.prototype.hex = function() {\r\n    var _hexstring, cs, ct, n;\r\n    if (this.mode === 'rgb') {\r\n      this.floor();\r\n    }\r\n    cs = this.values(this.mode !== 'rgb');\r\n    _hexstring = function(n) {\r\n      n = n.toString(16);\r\n      if (n.length < 2) {\r\n        return '0' + n;\r\n      } else {\r\n        return n;\r\n      }\r\n    };\r\n    ct = (function() {\r\n      var aa, len1, results;\r\n      results = [];\r\n      for (aa = 0, len1 = cs.length; aa < len1; aa++) {\r\n        n = cs[aa];\r\n        results.push(_hexstring(n));\r\n      }\r\n      return results;\r\n    })();\r\n    return '#' + ct[0] + ct[1] + ct[2];\r\n  };\r\n\r\n  Color.prototype.rgb = function() {\r\n    var cs;\r\n    if (this.mode === 'rgb') {\r\n      this.floor();\r\n    }\r\n    cs = this.values(this.mode !== 'rgb');\r\n    return \"rgb(\" + cs[0] + \", \" + cs[1] + \", \" + cs[2] + \")\";\r\n  };\r\n\r\n  Color.prototype.rgba = function() {\r\n    var cs;\r\n    if (this.mode === 'rgb') {\r\n      this.floor();\r\n    }\r\n    cs = this.values(this.mode !== 'rgb');\r\n    return \"rgba(\" + cs[0] + \", \" + cs[1] + \", \" + cs[2] + \", \" + this.alpha + \")\";\r\n  };\r\n\r\n  Color.prototype.values = function(toRGB) {\r\n    var cs, v;\r\n    if (toRGB == null) {\r\n      toRGB = false;\r\n    }\r\n    cs = [this.x, this.y, this.z];\r\n    if (toRGB && this.mode !== 'rgb') {\r\n      switch (this.mode) {\r\n        case 'hsl':\r\n          cs = Color.HSLtoRGB(this.x, this.y, this.z);\r\n          break;\r\n        case 'hsb':\r\n          cs = Color.HSBtoRGB(this.x, this.y, this.z);\r\n          break;\r\n        case 'lab':\r\n          cs = Color.LABtoRGB(this.x, this.y, this.z);\r\n          break;\r\n        case 'lch':\r\n          cs = Color.LCHtoRGB(this.x, this.y, this.z);\r\n          break;\r\n        case 'xyz':\r\n          cs = Color.XYZtoRGB(this.x, this.y, this.z);\r\n      }\r\n    }\r\n    return (function() {\r\n      var aa, len1, results;\r\n      results = [];\r\n      for (aa = 0, len1 = cs.length; aa < len1; aa++) {\r\n        v = cs[aa];\r\n        results.push(Math.floor(v));\r\n      }\r\n      return results;\r\n    })();\r\n  };\r\n\r\n  Color.RGBtoHSL = function(r, g, b, normalizedInput, normalizedOutput) {\r\n    var d, h, l, max, min, s;\r\n    if (!normalizedInput) {\r\n      r /= 255;\r\n      g /= 255;\r\n      b /= 255;\r\n    }\r\n    max = Math.max(r, g, b);\r\n    min = Math.min(r, g, b);\r\n    h = (max + min) / 2;\r\n    s = h;\r\n    l = h;\r\n    if (max === min) {\r\n      h = 0;\r\n      s = 0;\r\n    } else {\r\n      d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n        default:\r\n          h = 0;\r\n      }\r\n    }\r\n    if (normalizedOutput) {\r\n      return [h / 60, s, l];\r\n    } else {\r\n      return [h * 60, s, l];\r\n    }\r\n  };\r\n\r\n  Color.HSLtoRGB = function(h, s, l, normalizedInput, normalizedOutput) {\r\n    var b, g, hue2rgb, p, q, r;\r\n    if (s === 0) {\r\n      if (normalizedOutput) {\r\n        return [1, 1, 1];\r\n      } else {\r\n        return [255, 255, 255];\r\n      }\r\n    } else {\r\n      if (!normalizedInput) {\r\n        h /= 360;\r\n      }\r\n      q = l <= 0.5 ? l * (1 + s) : l + s - (l * s);\r\n      p = 2 * l - q;\r\n      hue2rgb = function(p, q, t) {\r\n        if (t < 0) {\r\n          t += 1;\r\n        } else if (t > 1) {\r\n          t -= 1;\r\n        }\r\n        if (t * 6 < 1) {\r\n          return p + (q - p) * t * 6;\r\n        } else if (t * 2 < 1) {\r\n          return q;\r\n        } else if (t * 3 < 2) {\r\n          return p + (q - p) * ((2 / 3) - t) * 6;\r\n        } else {\r\n          return p;\r\n        }\r\n      };\r\n      r = hue2rgb(p, q, h + 1 / 3);\r\n      g = hue2rgb(p, q, h);\r\n      b = hue2rgb(p, q, h - 1 / 3);\r\n      if (normalizedOutput) {\r\n        return [r, g, b];\r\n      } else {\r\n        return [r * 255, g * 255, b * 255];\r\n      }\r\n    }\r\n  };\r\n\r\n  Color.RGBtoHSB = function(r, g, b, normalizedInput, normalizedOutput) {\r\n    var d, h, max, min, s, v;\r\n    if (!normalizedInput) {\r\n      r /= 255;\r\n      g /= 255;\r\n      b /= 255;\r\n    }\r\n    max = Math.max(r, g, b);\r\n    min = Math.min(r, g, b);\r\n    d = max - min;\r\n    s = max === 0 ? 0 : d / max;\r\n    v = max;\r\n    if (max === min) {\r\n      h = 0;\r\n    } else {\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n        default:\r\n          h = 0;\r\n      }\r\n    }\r\n    if (normalizedOutput) {\r\n      return [h / 60, s, v];\r\n    } else {\r\n      return [h * 60, s, v];\r\n    }\r\n  };\r\n\r\n  Color.HSBtoRGB = function(h, s, v, normalizedInput, normalizedOutput) {\r\n    var f, i, p, q, rgb, t;\r\n    if (!normalizedInput) {\r\n      h /= 360;\r\n    }\r\n    i = Math.floor(h * 6);\r\n    f = h * 6 - i;\r\n    p = v * (1 - s);\r\n    q = v * (1 - f * s);\r\n    t = v * (1 - (1 - f) * s);\r\n    switch (i % 6) {\r\n      case 0:\r\n        rgb = [v, t, p];\r\n        break;\r\n      case 1:\r\n        rgb = [q, v, p];\r\n        break;\r\n      case 2:\r\n        rgb = [p, v, t];\r\n        break;\r\n      case 3:\r\n        rgb = [p, q, v];\r\n        break;\r\n      case 4:\r\n        rgb = [t, p, v];\r\n        break;\r\n      case 5:\r\n        rgb = [v, p, q];\r\n        break;\r\n      default:\r\n        rgb = [0, 0, 0];\r\n    }\r\n    if (normalizedOutput) {\r\n      return rgb;\r\n    } else {\r\n      return [rgb[0] * 255, rgb[1] * 255, rgb[2] * 255];\r\n    }\r\n  };\r\n\r\n  Color.RGBtoLAB = function(r, g, b, normalizedInput, normalizedOutput) {\r\n    var xyz;\r\n    if (normalizedInput) {\r\n      r *= 255;\r\n      g *= 255;\r\n      b *= 255;\r\n    }\r\n    xyz = Color.RGBtoXYZ(r, g, b);\r\n    return Color.XYZtoLAB(xyz[0], xyz[1], xyz[2]);\r\n  };\r\n\r\n  Color.LABtoRGB = function(L, a, b, normalizedInput, normalizedOutput) {\r\n    var rgb, xyz;\r\n    if (normalizedInput) {\r\n      L *= 100;\r\n      a = (a - 0.5) * 127;\r\n      b = (b - 0.5) * 127;\r\n    }\r\n    xyz = Color.LABtoXYZ(L, a, b);\r\n    rgb = Color.XYZtoRGB(xyz[0], xyz[1], xyz[2]);\r\n    if (normalizedOutput) {\r\n      return [rgb[0] / 255, rgb[1] / 255, rgb[2] / 255];\r\n    } else {\r\n      return rgb;\r\n    }\r\n  };\r\n\r\n  Color.RGBtoLCH = function(r, g, b, normalizedInput, normalizedOutput) {\r\n    var lab, lch;\r\n    if (normalizedInput) {\r\n      r *= 255;\r\n      g *= 255;\r\n      b *= 255;\r\n    }\r\n    lab = Color.RGBtoLAB(r, g, b);\r\n    lch = Color.LABtoLCH(lab[0], lab[1], lab[2]);\r\n    if (normalizedOutput) {\r\n      return [lch[0] / 100, lch[1] / 100, lch[2] / 360];\r\n    } else {\r\n      return lch;\r\n    }\r\n  };\r\n\r\n  Color.LCHtoRGB = function(L, c, h, normalizedInput, normalizedOutput) {\r\n    var lab, rgb, xyz;\r\n    if (normalizedInput) {\r\n      L *= 100;\r\n      c *= 100;\r\n      h *= 360;\r\n    }\r\n    lab = Color.LCHtoLAB(L, c, h);\r\n    xyz = Color.LABtoXYZ(lab[0], lab[1], lab[2]);\r\n    rgb = Color.XYZtoRGB(xyz[0], xyz[1], xyz[2]);\r\n    if (normalizedOutput) {\r\n      return [rgb[0] / 255, rgb[1] / 255, rgb[2] / 255];\r\n    } else {\r\n      return rgb;\r\n    }\r\n  };\r\n\r\n  Color.XYZtoRGB = function(x, y, z, normalizedInput, normalizedOutput) {\r\n    var aa, c, i, len1, rgb;\r\n    if (!normalizedInput) {\r\n      x = x / 100;\r\n      y = y / 100;\r\n      z = z / 100;\r\n    }\r\n    rgb = [x * 3.2404542 + y * -1.5371385 + z * -0.4985314, x * -0.9692660 + y * 1.8760108 + z * 0.0415560, x * 0.0556434 + y * -0.2040259 + z * 1.0572252];\r\n    for (i = aa = 0, len1 = rgb.length; aa < len1; i = ++aa) {\r\n      c = rgb[i];\r\n      if (c < 0) {\r\n        rgb[i] = 0;\r\n      } else {\r\n        rgb[i] = Math.min(1, c > 0.0031308 ? 1.055 * (Math.pow(c, 1 / 2.4)) - 0.055 : 12.92 * c);\r\n      }\r\n    }\r\n    if (normalizedOutput) {\r\n      return rgb;\r\n    } else {\r\n      return [Math.round(rgb[0] * 255), Math.round(rgb[1] * 255), Math.round(rgb[2] * 255)];\r\n    }\r\n  };\r\n\r\n  Color.RGBtoXYZ = function(r, g, b, normalizedInput, normalizedOutput) {\r\n    if (!normalizedInput) {\r\n      r = r / 255;\r\n      g = g / 255;\r\n      b = b / 255;\r\n    }\r\n    r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\r\n    g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\r\n    b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\r\n    if (!normalizedOutput) {\r\n      r = r * 100;\r\n      g = g * 100;\r\n      b = b * 100;\r\n    }\r\n    return [r * 0.4124564 + g * 0.3575761 + b * 0.1804375, r * 0.2126729 + g * 0.7151522 + b * 0.0721750, r * 0.0193339 + g * 0.1191920 + b * 0.9503041];\r\n  };\r\n\r\n  Color.XYZtoLAB = function(x, y, z) {\r\n    var calc, cy;\r\n    x = x / Color.XYZ.D65.x;\r\n    y = y / Color.XYZ.D65.y;\r\n    z = z / Color.XYZ.D65.z;\r\n    calc = function(n) {\r\n      if (n > 0.008856) {\r\n        return Math.pow(n, 1 / 3);\r\n      } else {\r\n        return (7.787 * n) + 16 / 116;\r\n      }\r\n    };\r\n    cy = calc(y);\r\n    return [(116 * cy) - 16, 500 * (calc(x) - cy), 200 * (cy - calc(z))];\r\n  };\r\n\r\n  Color.LABtoXYZ = function(L, a, b) {\r\n    var calc, x, xyz, y, z;\r\n    y = (L + 16) / 116;\r\n    x = a / 500 + y;\r\n    z = y - b / 200;\r\n    calc = function(n) {\r\n      var nnn;\r\n      nnn = Math.pow(n, 3);\r\n      if (nnn > 0.008856) {\r\n        return nnn;\r\n      } else {\r\n        return (n - 16 / 116) / 7.787;\r\n      }\r\n    };\r\n    xyz = [Math.min(Color.XYZ.D65.x, Color.XYZ.D65.x * calc(x)), Math.min(Color.XYZ.D65.y, Color.XYZ.D65.y * calc(y)), Math.min(Color.XYZ.D65.y, Color.XYZ.D65.z * calc(z))];\r\n    return xyz;\r\n  };\r\n\r\n  Color.XYZtoLUV = function(x, y, z) {\r\n    var L, refU, refV, u, v;\r\n    u = (4 * x) / (x + (15 * y) + (3 * z));\r\n    v = (9 * y) / (x + (15 * y) + (3 * z));\r\n    y = y / 100;\r\n    y = y > 0.008856 ? Math.pow(y, 1 / 3) : 7.787 * y + 16 / 116;\r\n    refU = (4 * Color.XYZ.D65.x) / (Color.XYZ.D65.x + (15 * Color.XYZ.D65.y) + (3 * Color.XYZ.D65.z));\r\n    refV = (9 * Color.XYZ.D65.y) / (Color.XYZ.D65.x + (15 * Color.XYZ.D65.y) + (3 * Color.XYZ.D65.z));\r\n    L = (116 * y) - 16;\r\n    return [L, 13 * L * (u - refU), 13 * L * (v - refV)];\r\n  };\r\n\r\n  Color.LUVtoXYZ = function(L, u, v) {\r\n    var cubeY, refU, refV, x, y;\r\n    y = (L + 16) / 116;\r\n    cubeY = y * y * y;\r\n    y = cubeY > 0.008856 ? cubeY : (y - 16 / 116) / 7.787;\r\n    refU = (4 * Color.XYZ.D65.x) / (Color.XYZ.D65.x + (15 * Color.XYZ.D65.y) + (3 * Color.XYZ.D65.z));\r\n    refV = (9 * Color.XYZ.D65.y) / (Color.XYZ.D65.x + (15 * Color.XYZ.D65.y) + (3 * Color.XYZ.D65.z));\r\n    u = u / (13 * L) + refU;\r\n    v = v / (13 * L) + refV;\r\n    y = y * 100;\r\n    x = -1 * (9 * y * u) / ((u - 4) * v - u * v);\r\n    return [x, y, (9 * y - (15 * v * y) - (v * x)) / (3 * v)];\r\n  };\r\n\r\n  Color.LABtoLCH = function(L, a, b) {\r\n    var h;\r\n    h = Math.atan2(b, a);\r\n    h = h > 0 ? 180 * h / Math.PI : 360 - (180 * Math.abs(h) / Math.PI);\r\n    return [L, Math.sqrt(a * a + b * b), h];\r\n  };\r\n\r\n  Color.LCHtoLAB = function(L, c, h) {\r\n    var radH;\r\n    radH = Math.PI * h / 180;\r\n    return [L, Math.cos(radH) * c, Math.sin(radH) * c];\r\n  };\r\n\r\n  Color.LUVtoLCH = function(L, u, v) {\r\n    return LABtoLCH(L, u, v);\r\n  };\r\n\r\n  Color.LCHtoLUV = function(L, c, h) {\r\n    return LCHtoLAB(L, c, h);\r\n  };\r\n\r\n  return Color;\r\n\r\n})(Vector);\r\n\r\nthis.Color = Color;\r\n\r\nCircle = (function(superClass) {\r\n  extend(Circle, superClass);\r\n\r\n  function Circle() {\r\n    Circle.__super__.constructor.apply(this, arguments);\r\n    this.radius = arguments[3] != null ? arguments[3] : 0;\r\n  }\r\n\r\n  Circle.prototype.setRadius = function(r) {\r\n    this.radius = r;\r\n    return this;\r\n  };\r\n\r\n  Circle.prototype.intersectPoint = function(args) {\r\n    var d, item;\r\n    item = new Vector(Point.get(arguments));\r\n    d = item.$subtract(this);\r\n    return d.x * d.x + d.y * d.y < this.radius * this.radius;\r\n  };\r\n\r\n  Circle.prototype.intersectPath = function(path, get_pts) {\r\n    var a, b, c, d, disc, discSqrt, f, p, p1, p2, q, t1, t2;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    if (!path instanceof Pair) {\r\n      return false;\r\n    }\r\n    d = path.direction();\r\n    f = this.$subtract(path);\r\n    a = d.dot(d, Const.xy);\r\n    b = f.dot(d, Const.xy);\r\n    c = f.dot(f, Const.xy) - (this.radius * this.radius);\r\n    p = b / a;\r\n    q = c / a;\r\n    disc = p * p - q;\r\n    if (disc < 0) {\r\n      return (get_pts ? [] : false);\r\n    } else {\r\n      if (!get_pts) {\r\n        return true;\r\n      }\r\n      discSqrt = Math.sqrt(disc);\r\n      t1 = -p + discSqrt;\r\n      t2 = -p - discSqrt;\r\n      p1 = new Point(path.x - d.x * t1, path.y - d.y * t1);\r\n      p2 = new Point(path.x - d.x * t2, path.y - d.y * t2);\r\n      if (disc === 0) {\r\n        return [p1];\r\n      } else {\r\n        return [p1, p2];\r\n      }\r\n    }\r\n  };\r\n\r\n  Circle.prototype.intersectLine = function(line, get_pts) {\r\n    var aa, bounds, len1, p, pi, pts;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    pts = this.intersectPath(line);\r\n    if (pts && pts.length > 0) {\r\n      pi = [];\r\n      bounds = line.bounds();\r\n      for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n        p = pts[aa];\r\n        if (Rectangle.contain(p, bounds, bounds.p1)) {\r\n          if (!get_pts) {\r\n            return true;\r\n          }\r\n          pi.push(p);\r\n        }\r\n      }\r\n      return (get_pts ? pi : pi.length > 0);\r\n    } else {\r\n      return (get_pts ? [] : false);\r\n    }\r\n  };\r\n\r\n  Circle.prototype.intersectLines = function(lines, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    return Line.intersectLines(this, lines, get_pts);\r\n  };\r\n\r\n  Circle.prototype.intersectCircle = function(circle, get_pts) {\r\n    var a, ca_r2, cb_r2, dr, dr2, dv, h, p;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    dv = circle.$subtract(this);\r\n    dr2 = dv.magnitude(false);\r\n    dr = Math.sqrt(dr2);\r\n    ca_r2 = this.radius * this.radius;\r\n    cb_r2 = circle.radius * circle.radius;\r\n    if (dr > this.radius + circle.radius) {\r\n      return (get_pts ? [] : false);\r\n    } else if (dr < Math.abs(this.radius - circle.radius)) {\r\n      return (get_pts ? [new Vector(this), new Vector(circle)] : true);\r\n    } else {\r\n      if (!get_pts) {\r\n        return true;\r\n      }\r\n      a = (ca_r2 - cb_r2 + dr2) / (2 * dr);\r\n      h = Math.sqrt(ca_r2 - a * a);\r\n      p = dv.$multiply(a / dr).add(this);\r\n      return [new Vector(p.x + h * dv.y / dr, p.y - h * dv.x / dr), new Vector(p.x - h * dv.y / dr, p.y + h * dv.x / dr)];\r\n    }\r\n  };\r\n\r\n  Circle.prototype.hasIntersect = function(item, get_pts) {\r\n    var d, ins;\r\n    if (get_pts == null) {\r\n      get_pts = false;\r\n    }\r\n    if (item instanceof Circle) {\r\n      return this.intersectCircle(item, get_pts);\r\n    } else if (item instanceof Rectangle || item instanceof PointSet || item instanceof Triangle) {\r\n      return this.intersectLines(item.sides(), get_pts);\r\n    } else if (item instanceof Pair) {\r\n      ins = this.intersectLine(item);\r\n      if (!get_pts) {\r\n        return ins.length > 0;\r\n      } else {\r\n        return ins;\r\n      }\r\n    } else if (item instanceof Point) {\r\n      d = item.$subtract(this);\r\n      return d.x * d.x + d.y * d.y < this.radius * this.radius;\r\n    } else {\r\n      if (get_pts) {\r\n        return [];\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  };\r\n\r\n  return Circle;\r\n\r\n})(Vector);\r\n\r\nthis.Circle = Circle;\r\n\r\nParticle = (function(superClass) {\r\n  extend(Particle, superClass);\r\n\r\n  function Particle() {\r\n    Particle.__super__.constructor.apply(this, arguments);\r\n    this.id = 0;\r\n    this.life = {\r\n      age: 0,\r\n      maxAge: 0,\r\n      active: true,\r\n      complete: false\r\n    };\r\n    this.momentum = new Vector();\r\n    this.velocity = new Vector();\r\n    this.mass = 2;\r\n    this.friction = 0;\r\n    this.frame_ms = 20;\r\n  }\r\n\r\n  Particle.prototype.play = function(time, timeDiff) {\r\n    var dt, results, t;\r\n    t = 0;\r\n    results = [];\r\n    while (timeDiff > 0) {\r\n      dt = Math.min(timeDiff, this.frame_ms);\r\n      this.integrate(t / 1000, dt / 1000);\r\n      timeDiff -= dt;\r\n      t += dt;\r\n      results.push(this.life.age++);\r\n    }\r\n    return results;\r\n  };\r\n\r\n  Particle.prototype.integrate = function(t, dt) {\r\n    return this.integrateRK4(t, dt);\r\n  };\r\n\r\n  Particle.prototype.forces = function(state, t) {\r\n    return {\r\n      force: new Vector()\r\n    };\r\n  };\r\n\r\n  Particle.prototype.impulse = function(force_dt) {\r\n    this.momentum.add(force_dt);\r\n    return this.velocity = this.momentum.$divide(this.mass);\r\n  };\r\n\r\n  Particle.prototype._evaluate = function(t, dt, derivative) {\r\n    var f, state;\r\n    if (dt == null) {\r\n      dt = 0;\r\n    }\r\n    if (derivative == null) {\r\n      derivative = false;\r\n    }\r\n    if (dt !== 0 && derivative) {\r\n      state = {\r\n        position: this.$add(derivative.velocity.$multiply(dt)),\r\n        momentum: this.momentum.$add(derivative.force.$multiply(dt))\r\n      };\r\n    } else {\r\n      state = {\r\n        position: new Vector(this),\r\n        momentum: new Vector(this.momentum)\r\n      };\r\n    }\r\n    state.velocity = state.momentum.$divide(this.mass);\r\n    f = this.forces(state, t + dt);\r\n    return {\r\n      velocity: state.velocity,\r\n      force: f.force\r\n    };\r\n  };\r\n\r\n  Particle.prototype.integrateRK4 = function(t, dt) {\r\n    var _map, a, b, c, d;\r\n    _map = function(m1, m2, m3, m4) {\r\n      var v;\r\n      v = new Vector((m1.x + 2 * (m2.x + m3.x) + m4.x) / 6, (m1.y + 2 * (m2.y + m3.y) + m4.y) / 6, (m1.z + 2 * (m2.z + m3.z) + m4.z) / 6);\r\n      return v;\r\n    };\r\n    a = this._evaluate(t, 0);\r\n    b = this._evaluate(t, dt * 0.5, a);\r\n    c = this._evaluate(t, dt * 0.5, b);\r\n    d = this._evaluate(t, dt, c);\r\n    this.add(_map(a.velocity, b.velocity, c.velocity, d.velocity));\r\n    return this.momentum.add(_map(a.force, b.force, c.force, d.force));\r\n  };\r\n\r\n  Particle.prototype.integrateEuler = function(t, dt) {\r\n    var f;\r\n    f = this.forces({\r\n      position: new Vector(this),\r\n      momentum: new Vector(this.momentum)\r\n    }, t + dt);\r\n    this.add(this.velocity);\r\n    this.momentum.add(f.force);\r\n    return this.velocity = this.momentum.$divide(this.mass);\r\n  };\r\n\r\n  Particle.prototype.collideLine2d = function(wall, precise) {\r\n    var collideEndPt, collided, crossed, curr_dist, curr_pos, dot, end_path, next_dist, next_pos, path, perpend, prev_pt_on_wall, proj, pt, pt2, pt_on_wall, pvec, r, tangent, wall_path;\r\n    if (precise == null) {\r\n      precise = true;\r\n    }\r\n    curr_pos = new Vector(this);\r\n    curr_dist = Math.abs(wall.getDistanceFromPoint(curr_pos));\r\n    collided = Math.abs(curr_dist) < this.radius;\r\n    if (precise) {\r\n      next_pos = this.$add(this.velocity);\r\n      next_dist = Math.abs(wall.getDistanceFromPoint(next_pos));\r\n      crossed = wall.intersectLine(new Line(curr_pos).to(next_pos));\r\n      if (crossed) {\r\n        next_pos = crossed.$add(this.velocity.$normalize().$multiply(-this.radius / 2));\r\n        next_dist = Math.abs(wall.getDistanceFromPoint(next_pos));\r\n        collided = true;\r\n      }\r\n    }\r\n    if (collided) {\r\n      pt_on_wall = wall.getPerpendicularFromPoint(curr_pos);\r\n      wall_path = wall.$subtract(wall.p1);\r\n      collideEndPt = false;\r\n      if (!wall.withinBounds(pt_on_wall, Const.xy)) {\r\n        if (this.intersectPoint(wall)) {\r\n          collideEndPt = true;\r\n          end_path = this.$subtract(wall);\r\n        }\r\n        if (this.intersectPoint(wall.p1)) {\r\n          collideEndPt = true;\r\n          end_path = this.$subtract(wall.p1);\r\n        }\r\n        if (collideEndPt) {\r\n          wall_path = new Vector(-end_path.y, end_path.x);\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n      dot = wall_path.dot(this.velocity);\r\n      proj = wall_path.$multiply(dot / wall_path.dot(wall_path));\r\n      tangent = proj.$subtract(this.velocity);\r\n      this.velocity = proj.$add(tangent);\r\n      this.momentum = this.velocity.$multiply(this.mass);\r\n      if (precise && !collideEndPt) {\r\n        perpend = new Line(pt_on_wall).to(curr_pos);\r\n        prev_pt_on_wall = wall.getPerpendicularFromPoint(next_pos);\r\n        path = new Line(pt_on_wall).to(prev_pt_on_wall);\r\n        pvec = path.direction();\r\n        r = (this.radius - curr_dist) / (next_dist - curr_dist);\r\n        pt = pvec.$multiply(r).$add(path);\r\n        pt2 = pt.$add(perpend.direction().$normalize().$multiply(this.radius));\r\n        this.set(pt2.$add(this.velocity.$normalize()));\r\n      }\r\n    }\r\n    return collided;\r\n  };\r\n\r\n  Particle.prototype.collideWithinBounds = function(bound) {\r\n    if (this.x - this.radius < bound.x || this.x + this.radius > bound.p1.x) {\r\n      if (this.x - this.radius < bound.x) {\r\n        this.x = bound.x + this.radius;\r\n      } else if (this.x + this.radius > bound.p1.x) {\r\n        this.x = bound.p1.x - this.radius;\r\n      }\r\n      this.velocity.x *= -1;\r\n      this.momentum = this.velocity.$multiply(this.mass);\r\n      return true;\r\n    } else if (this.y - this.radius < bound.y || this.y + this.radius > bound.p1.y) {\r\n      if (this.y - this.radius < bound.y) {\r\n        this.y = bound.y + this.radius;\r\n      } else if (this.y + this.radius > bound.p1.y) {\r\n        this.y = bound.p1.y - this.radius;\r\n      }\r\n      this.velocity.y *= -1;\r\n      this.momentum = this.velocity.$multiply(this.mass);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  Particle.prototype.collideParticle2d = function(pb) {\r\n    if (this.hasIntersect(pb)) {\r\n      return Particle.collideParticle2d(this, pb, true);\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Particle.collideParticle2d = function(pa, pb, update, checkOverlap) {\r\n    var d1, d2, dir, dot1n, dot1t, dot2n, dot2t, mag, magDiff, normal, pav, pbv, tangent, v1n, v1t, v2n, v2t;\r\n    if (update == null) {\r\n      update = true;\r\n    }\r\n    if (checkOverlap == null) {\r\n      checkOverlap = true;\r\n    }\r\n    normal = pa.$subtract(pb).normalize();\r\n    tangent = new Vector(-normal.y, normal.x);\r\n    dot1n = normal.dot(pa.velocity);\r\n    dot1t = tangent.dot(pa.velocity);\r\n    dot2n = normal.dot(pb.velocity);\r\n    dot2t = tangent.dot(pb.velocity);\r\n    d1 = (dot1n * (pa.mass - pb.mass) + 2 * pb.mass * dot2n) / (pa.mass + pb.mass);\r\n    d2 = (dot2n * (pb.mass - pa.mass) + 2 * pa.mass * dot1n) / (pa.mass + pb.mass);\r\n    v1n = normal.$multiply(d1);\r\n    v1t = tangent.$multiply(dot1t);\r\n    v2n = normal.$multiply(d2);\r\n    v2t = tangent.$multiply(dot2t);\r\n    pav = v1n.$add(v1t);\r\n    pbv = v2n.$add(v2t);\r\n    if (checkOverlap) {\r\n      mag = pa.magnitude(pb);\r\n      if (mag < pa.radius + pb.radius) {\r\n        dir = pa.$subtract(pb).normalize();\r\n        magDiff = Math.abs(mag - pa.radius - pb.radius) / 1.98;\r\n        pa.add(dir.multiply(magDiff));\r\n        pb.add(dir.multiply(-magDiff));\r\n      }\r\n    }\r\n    if (update) {\r\n      pa.velocity = pav;\r\n      pb.velocity = pbv;\r\n      pa.momentum = pa.velocity.$multiply(pa.mass);\r\n      pb.momentum = pb.velocity.$multiply(pb.mass);\r\n    }\r\n    return [pav, pbv];\r\n  };\r\n\r\n  Particle.force_gravitation = function(state, t, pa, pb, g) {\r\n    var d, force, mag, meterToPixel;\r\n    if (g == null) {\r\n      g = 0.0067;\r\n    }\r\n    meterToPixel = 30;\r\n    d = pb.$subtract(state.position);\r\n    mag = d.magnitude() / meterToPixel;\r\n    force = mag === 0 ? 0 : t * g * pa.mass * pb.mass / (mag * mag);\r\n    d.normalize().multiply(force);\r\n    return {\r\n      force: d\r\n    };\r\n  };\r\n\r\n  Particle.RK4 = function(c, d, func, dt, t) {\r\n    var a1, a2, a3, c1, c2, c3, c4, d1, d2, d3, d4, dc, dd;\r\n    c1 = c;\r\n    d1 = d;\r\n    a1 = func(c1, d1, 0, t);\r\n    c2 = c + 0.5 * d1 * dt;\r\n    d2 = d + 0.5 * a1 * dt;\r\n    a2 = func(c2, d2, dt / 2, t);\r\n    c3 = c + 0.5 * d2 * dt;\r\n    d3 = d + 0.5 * a2 * dt;\r\n    a3 = func(c3, d3, dt / 2, t);\r\n    c4 = c + d3 * dt;\r\n    d4 = d + a3 * dt;\r\n    dc = (c1 + 2 * (c2 + c3) + c4) / 6;\r\n    dd = (d1 + 2 * (d2 + d3) + d4) / 6;\r\n    return {\r\n      c: c + dc * dt,\r\n      d: d + dd * dt\r\n    };\r\n  };\r\n\r\n  return Particle;\r\n\r\n})(Circle);\r\n\r\nthis.Particle = Particle;\r\n\r\nParticleSystem = (function() {\r\n  function ParticleSystem() {\r\n    this.count = 0;\r\n    this.particles = [];\r\n    this.time = 0;\r\n  }\r\n\r\n  ParticleSystem.prototype.add = function(particle) {\r\n    particle.id = this.count++;\r\n    this.particles.push(particle);\r\n    return this;\r\n  };\r\n\r\n  ParticleSystem.prototype.remove = function(particle) {\r\n    if (particle && particle.life) {\r\n      particle.life.complete = true;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  ParticleSystem.prototype.animate = function(time, frame, ctx) {\r\n    var _remove, aa, ab, i, index, len1, len2, p, ref, results;\r\n    this.time++;\r\n    _remove = [];\r\n    ref = this.particles;\r\n    for (i = aa = 0, len1 = ref.length; aa < len1; i = ++aa) {\r\n      p = ref[i];\r\n      if (p.life.complete) {\r\n        _remove.push(i);\r\n      } else if (p.life.active) {\r\n        p.animate(time, frame, ctx);\r\n      }\r\n    }\r\n    if (_remove.length > 0) {\r\n      results = [];\r\n      for (ab = 0, len2 = _remove.length; ab < len2; ab++) {\r\n        index = _remove[ab];\r\n        results.push(this.particles.splice(index, 1));\r\n      }\r\n      return results;\r\n    }\r\n  };\r\n\r\n  return ParticleSystem;\r\n\r\n})();\r\n\r\nthis.ParticleSystem = ParticleSystem;\r\n\r\nPair = (function(superClass) {\r\n  extend(Pair, superClass);\r\n\r\n  function Pair() {\r\n    Pair.__super__.constructor.apply(this, arguments);\r\n    this.p1 = new Vector(this.x, this.y, this.z);\r\n    if (arguments.length === 4) {\r\n      this.z = 0;\r\n      this.p1.set(arguments[2], arguments[3]);\r\n    } else if (arguments.length === 6) {\r\n      this.p1.set(arguments[3], arguments[4], arguments[5]);\r\n    }\r\n  }\r\n\r\n  Pair.prototype.to = function() {\r\n    this.p1 = new Vector(Point.get(arguments));\r\n    return this;\r\n  };\r\n\r\n  Pair.prototype.getAt = function(index) {\r\n    if (index === 1 || index === \"p1\") {\r\n      return this.p1;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Pair.prototype.$getAt = function(index) {\r\n    return new Vector(this.getAt(index));\r\n  };\r\n\r\n  Pair.prototype.relative = function() {\r\n    this.p1.add(this);\r\n    return this;\r\n  };\r\n\r\n  Pair.prototype.$relative = function() {\r\n    return this.$add(this.p1);\r\n  };\r\n\r\n  Pair.prototype.bounds = function() {\r\n    return new Pair(this.$min(this.p1)).to(this.$max(this.p1));\r\n  };\r\n\r\n  Pair.prototype.withinBounds = function(pt, axis) {\r\n    var a, b;\r\n    if (axis) {\r\n      a = this.get2D(axis);\r\n      b = this.p1.get2D(axis);\r\n      if (a.x === b.x) {\r\n        return pt.y >= Math.min(a.y, b.y) && pt.y <= Math.max(a.y, b.y);\r\n      } else if (a.y === b.y) {\r\n        return pt.x >= Math.min(a.x, b.x) && pt.x <= Math.max(a.x, b.x);\r\n      } else {\r\n        return pt.x >= Math.min(a.x, b.x) && pt.y >= Math.min(a.y, b.y) && pt.x <= Math.max(a.x, b.x) && pt.y <= Math.max(a.y, b.y);\r\n      }\r\n    } else {\r\n      return pt.x >= Math.min(this.x, this.p1.x) && pt.y >= Math.min(this.y, this.p1.y) && pt.z >= Math.min(this.z, this.p1.z) && pt.x <= Math.max(this.x, this.p1.x) && pt.y <= Math.max(this.y, this.p1.y) && pt.z <= Math.max(this.z, this.p1.z);\r\n    }\r\n  };\r\n\r\n  Pair.prototype.interpolate = function(t, relative) {\r\n    var p2;\r\n    if (relative == null) {\r\n      relative = false;\r\n    }\r\n    p2 = relative ? this.$relative() : this.p1;\r\n    return new Vector((1 - t) * this.x + t * p2.x, (1 - t) * this.y + t * p2.y, (1 - t) * this.z + t * p2.z);\r\n  };\r\n\r\n  Pair.prototype.midpoint = function() {\r\n    return this.interpolate(0.5);\r\n  };\r\n\r\n  Pair.prototype.direction = function(reverse) {\r\n    if (reverse) {\r\n      return this.$subtract(this.p1);\r\n    } else {\r\n      return this.p1.$subtract(this);\r\n    }\r\n  };\r\n\r\n  Pair.prototype.size = function() {\r\n    if (arguments.length > 0) {\r\n      this.p1 = this.$add(Point.get(arguments));\r\n      return this;\r\n    } else {\r\n      return this.p1.$subtract(this).abs();\r\n    }\r\n  };\r\n\r\n  Pair.prototype.length = function(sqrt) {\r\n    var d, dx, dy, dz;\r\n    if (sqrt == null) {\r\n      sqrt = true;\r\n    }\r\n    dz = this.z - this.p1.z;\r\n    dy = this.y - this.p1.y;\r\n    dx = this.x - this.p1.x;\r\n    d = dx * dx + dy * dy + dz * dz;\r\n    if (sqrt) {\r\n      return Math.sqrt(d);\r\n    } else {\r\n      return d;\r\n    }\r\n  };\r\n\r\n  Pair.prototype.collinear = function(point) {\r\n    return (this.p1.x - this.x) * (point.y - this.y) - (point.x - this.x) * (this.p1.y - this.y);\r\n  };\r\n\r\n  Pair.prototype.resetBounds = function() {\r\n    var temp;\r\n    temp = this.$min(this.p1);\r\n    this.p1.set(this.$max(this.p1));\r\n    this.set(temp);\r\n    return this;\r\n  };\r\n\r\n  Pair.prototype.equal = function(epsilon) {\r\n    if (epsilon == null) {\r\n      epsilon = false;\r\n    }\r\n    if (arguments[0] instanceof Pair) {\r\n      return Pair.__super__.equal.call(this, arguments[0]) && this.p1.equal(arguments[0].p1);\r\n    } else {\r\n      return Pair.__super__.equal.apply(this, arguments);\r\n    }\r\n  };\r\n\r\n  Pair.prototype.clone = function() {\r\n    var p;\r\n    p = new Pair(this);\r\n    p.to(this.p1.clone());\r\n    return p;\r\n  };\r\n\r\n  Pair.prototype.floor = function() {\r\n    Pair.__super__.floor.apply(this, arguments);\r\n    return this.p1.floor();\r\n  };\r\n\r\n  Pair.prototype.toString = function() {\r\n    return \"Pair of vectors from (\" + this.x + \", \" + this.y + \", \" + this.z + \") to (\" + this.p1.x + \", \" + this.p1.y + \", \" + this.p1.z + \")\";\r\n  };\r\n\r\n  Pair.prototype.toArray = function() {\r\n    return [this, this.p1];\r\n  };\r\n\r\n  return Pair;\r\n\r\n})(Vector);\r\n\r\nthis.Pair = Pair;\r\n\r\nLine = (function(superClass) {\r\n  extend(Line, superClass);\r\n\r\n  function Line() {\r\n    Line.__super__.constructor.apply(this, arguments);\r\n  }\r\n\r\n  Line.slope = function(a, b, axis) {\r\n    var p1, p2;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    p1 = a.get2D(axis);\r\n    p2 = b.get2D(axis);\r\n    if (p2.x - p1.x === 0) {\r\n      return false;\r\n    } else {\r\n      return (p2.y - p1.y) / (p2.x - p1.x);\r\n    }\r\n  };\r\n\r\n  Line.intercept = function(a, b, axis) {\r\n    var c, m, p1, p2;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    p1 = a.get2D(axis);\r\n    p2 = b.get2D(axis);\r\n    if (p2.x - p1.x === 0) {\r\n      return false;\r\n    } else {\r\n      m = (p2.y - p1.y) / (p2.x - p1.x);\r\n      c = p1.y - m * p1.x;\r\n      return {\r\n        slope: m,\r\n        yi: c,\r\n        xi: m === 0 ? false : -c / m\r\n      };\r\n    }\r\n  };\r\n\r\n  Line.isPerpendicularLine = function(line1, line2, axis) {\r\n    var s1, s2;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    s1 = Line.slope(line1, line1.p1, axis);\r\n    s2 = Line.slope(line2, line2.p1, axis);\r\n    if (s1 === false) {\r\n      return s2 === 0;\r\n    } else if (s2 === false) {\r\n      return s1 === 0;\r\n    } else {\r\n      return s1 * s2 === -1;\r\n    }\r\n  };\r\n\r\n  Line.prototype.slope = function(axis) {\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    return Line.slope(this, this.p1, axis);\r\n  };\r\n\r\n  Line.prototype.intercept = function(axis) {\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    return Line.intercept(this, this.p1, axis);\r\n  };\r\n\r\n  Line.prototype.getPerpendicular = function(t, len, reverse, axis) {\r\n    var line, pn, pp;\r\n    if (len == null) {\r\n      len = 10;\r\n    }\r\n    if (reverse == null) {\r\n      reverse = false;\r\n    }\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    pn = this.direction().normalize().perpendicular(axis);\r\n    pp = reverse ? pn[1] : pn[0];\r\n    line = new Line(this.interpolate(t));\r\n    line.to(pp.multiply(len).add(line));\r\n    return line;\r\n  };\r\n\r\n  Line.prototype.getDistanceFromPoint = function(pt) {\r\n    var normal, path;\r\n    path = this.$subtract(this.p1);\r\n    normal = new Vector(-path.y, path.x).normalize();\r\n    return this.$subtract(pt).dot(normal);\r\n  };\r\n\r\n  Line.prototype.getPerpendicularFromPoint = function(pt, fromProjection) {\r\n    var proj;\r\n    if (fromProjection == null) {\r\n      fromProjection = true;\r\n    }\r\n    proj = this.p1.$subtract(this).projection(pt.$subtract(this));\r\n    if (!fromProjection) {\r\n      return proj;\r\n    } else {\r\n      return proj.add(this);\r\n    }\r\n  };\r\n\r\n  Line.prototype.intersectPath = function(line, axis) {\r\n    var a, b, ln, p, px, py, y1;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    a = this.intercept(axis);\r\n    b = line.intercept(axis);\r\n    p = this.get2D(axis);\r\n    ln = line.get2D(axis);\r\n    if (a === false) {\r\n      if (b === false) {\r\n        return false;\r\n      }\r\n      y1 = -b.slope * (ln.x - p.x) + ln.y;\r\n      if (axis === Const.xy) {\r\n        return new Vector(p.x, y1);\r\n      } else {\r\n        return new Vector(p.x, y1).get2D(axis, true);\r\n      }\r\n    } else {\r\n      if (b === false) {\r\n        y1 = -a.slope * (p.x - ln.x) + p.y;\r\n        return new Vector(ln.x, y1);\r\n      } else if (b.slope !== a.slope) {\r\n        px = (a.slope * p.x - b.slope * ln.x + ln.y - p.y) / (a.slope - b.slope);\r\n        py = a.slope * (px - p.x) + p.y;\r\n        if (axis === Const.xy) {\r\n          return new Vector(px, py);\r\n        } else {\r\n          return new Vector(px, py).get2D(axis, true);\r\n        }\r\n      } else {\r\n        if (a.yi === b.yi) {\r\n          return null;\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  Line.prototype.intersectLine = function(line, axis) {\r\n    var pt;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    pt = this.intersectPath(line, axis);\r\n    if (pt && this.withinBounds(pt, axis) && line.withinBounds(pt, axis)) {\r\n      return pt;\r\n    } else {\r\n      if (pt === null) {\r\n        return null;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  };\r\n\r\n  Line.intersectLines = function(elem, lines, get_pts) {\r\n    var aa, i, ins, len1, ln, p, pts;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    if (!elem.intersectLine) {\r\n      throw \"No intersectLine function found in \" + elem.toString();\r\n    }\r\n    pts = [];\r\n    for (i in lines) {\r\n      ln = lines[i];\r\n      ins = elem.intersectLine(ln, get_pts);\r\n      if (ins) {\r\n        if (!get_pts) {\r\n          return true;\r\n        }\r\n        if (ins.length > 0) {\r\n          for (aa = 0, len1 = ins.length; aa < len1; aa++) {\r\n            p = ins[aa];\r\n            pts.push(p);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (get_pts) {\r\n      return pts;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Line.prototype.intersectGridLine = function(line, path_only, axis) {\r\n    var a1, a2, b1, b2;\r\n    if (path_only == null) {\r\n      path_only = false;\r\n    }\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    a1 = this.get2D(axis);\r\n    a2 = this.p1.get2D(axis);\r\n    b1 = line.get2D(axis);\r\n    b2 = line.p1.get2D(axis);\r\n    if (a2.x - a1.x === 0) {\r\n      if (b2.y - b1.y === 0 && Util.within(a1.x, b1.x, b2.x)) {\r\n        if (path_only || Util.within(b1.y, a1.y, a2.y)) {\r\n          return new Vector(a1.x, b1.y);\r\n        }\r\n      }\r\n    } else if (a2.y - a1.y === 0) {\r\n      if (b2.x - b1.x === 0 && Util.within(a1.y, b1.y, b2.y)) {\r\n        if (path_only || Util.within(b1.x, a1.x, a2.x)) {\r\n          return new Vector(b1.x, a1.y);\r\n        }\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Line.prototype.subpoints = function(num) {\r\n    var aa, ref, results, t;\r\n    results = [];\r\n    for (t = aa = 0, ref = num; 0 <= ref ? aa <= ref : aa >= ref; t = 0 <= ref ? ++aa : --aa) {\r\n      results.push(this.interpolate(t / num));\r\n    }\r\n    return results;\r\n  };\r\n\r\n  Line.prototype.clone = function(deep) {\r\n    return new Line(this).to(this.p1);\r\n  };\r\n\r\n  return Line;\r\n\r\n})(Pair);\r\n\r\nthis.Line = Line;\r\n\r\nRectangle = (function(superClass) {\r\n  extend(Rectangle, superClass);\r\n\r\n  function Rectangle() {\r\n    Rectangle.__super__.constructor.apply(this, arguments);\r\n    this.center = new Vector();\r\n  }\r\n\r\n  Rectangle.contain = function(pt, ptl, pbr) {\r\n    return pt.x >= ptl.x && pt.x <= pbr.x && pt.y >= ptl.y && pt.y <= pbr.y && pt.z >= ptl.z && pt.z <= pbr.z;\r\n  };\r\n\r\n  Rectangle.prototype.toString = function() {\r\n    var s;\r\n    s = this.size();\r\n    return \"Rectangle x1 \" + this.x + \", y1 \" + this.y + \", z1 \" + this.z + \", x2 \" + this.p1.x + \", y2 \" + this.p1.y + \", z2 \" + this.p1.z + \", width \" + s.x + \", height \" + s.y;\r\n  };\r\n\r\n  Rectangle.prototype.toPointSet = function() {\r\n    var c;\r\n    c = this.corners();\r\n    return new PointSet(this).to([c.topRight, c.bottomRight, c.bottomLeft, c.topLeft]);\r\n  };\r\n\r\n  Rectangle.prototype.to = function(args) {\r\n    this.p1 = new Vector(Point.get(arguments));\r\n    this.resetBounds();\r\n    this.center = this.midpoint();\r\n    return this;\r\n  };\r\n\r\n  Rectangle.prototype.setCenter = function(args) {\r\n    var halfsize;\r\n    if (arguments.length === 0) {\r\n      this.center = this.midpoint();\r\n      return;\r\n    }\r\n    halfsize = this.size().$divide(2);\r\n    this.center.set(Point.get(arguments));\r\n    this.set(this.center.$subtract(halfsize));\r\n    this.p1.set(this.center.$add(halfsize));\r\n    return this;\r\n  };\r\n\r\n  Rectangle.prototype.resizeTo = function() {\r\n    this.p1 = new Vector(Point.get(arguments));\r\n    this.relative();\r\n    this.center = this.midpoint();\r\n    return this;\r\n  };\r\n\r\n  Rectangle.prototype.resizeCenterTo = function() {\r\n    var size;\r\n    size = new Vector(Point.get(arguments)).divide(2);\r\n    this.set(this.center.$subtract(size));\r\n    this.p1.set(this.center.$add(size));\r\n    return this;\r\n  };\r\n\r\n  Rectangle.prototype.enclose = function(rect) {\r\n    this.set(this.$min(rect));\r\n    this.p1.set(this.p1.$max(rect.p1));\r\n    this.center = this.midpoint();\r\n    return this;\r\n  };\r\n\r\n  Rectangle.prototype.$enclose = function(rect) {\r\n    return this.clone().enclose(rect);\r\n  };\r\n\r\n  Rectangle.prototype.isEnclosed = function(rect) {\r\n    var d, d2;\r\n    d = this.$subtract(rect).multiply(this.p1.$subtract(rect.p1));\r\n    d2 = this.size().subtract(rect.size());\r\n    return d.x <= 0 && d.y <= 0 && d.z <= 0 && (d2.x * d2.y >= 0);\r\n  };\r\n\r\n  Rectangle.prototype.isLarger = function(rect) {\r\n    var s1, s2;\r\n    s1 = this.size();\r\n    s2 = rect.size();\r\n    return s1.x * s1.y > s2.x * s2.y;\r\n  };\r\n\r\n  Rectangle.prototype.intersectPoint = function() {\r\n    var pt;\r\n    pt = Point.get(arguments);\r\n    return pt.x >= this.x && pt.x <= this.p1.x && pt.y >= this.y && pt.y <= this.p1.y && pt.z >= this.z && pt.z <= this.p1.z;\r\n  };\r\n\r\n  Rectangle.prototype.intersectPath = function(line, get_pts) {\r\n    var aa, len1, p, pts, s, sides;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    sides = this.sides();\r\n    pts = [];\r\n    for (aa = 0, len1 = sides.length; aa < len1; aa++) {\r\n      s = sides[aa];\r\n      p = s.intersectPath(line);\r\n      if (p && this.intersectPoint(p)) {\r\n        if (get_pts) {\r\n          pts.push(p);\r\n        } else {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    if (get_pts) {\r\n      return pts;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Rectangle.prototype.intersectLine = function(line, get_pts) {\r\n    var aa, ip1, ip2, lbound, len1, p, pts, s, sides;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    ip1 = this.intersectPoint(line);\r\n    ip2 = this.intersectPoint(line.p1);\r\n    if (ip1 && ip2) {\r\n      if (get_pts) {\r\n        return [];\r\n      }\r\n    } else {\r\n      true;\r\n    }\r\n    if (!(ip1 || ip2)) {\r\n      lbound = line.bounds();\r\n      if (!this.intersectRectangle(lbound, false)) {\r\n        if (get_pts) {\r\n          return [];\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    sides = this.sides();\r\n    pts = [];\r\n    for (aa = 0, len1 = sides.length; aa < len1; aa++) {\r\n      s = sides[aa];\r\n      p = line.intersectLine(s);\r\n      if (p) {\r\n        if (get_pts) {\r\n          pts.push(p);\r\n        } else {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    if (get_pts) {\r\n      return pts;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Rectangle.prototype.intersectLines = function(lines, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    return Line.intersectLines(this, lines, get_pts);\r\n  };\r\n\r\n  Rectangle.prototype.intersectRectangle = function(rect, get_pts) {\r\n    var aa, ab, intersected, len1, len2, p, pts, sa, sb, sidesA, sidesB, xi, yi, zi;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    xi = (this.p1.x >= rect.x) && (this.x <= rect.p1.x);\r\n    yi = (this.p1.y >= rect.y) && (this.y <= rect.p1.y);\r\n    zi = (this.p1.z >= rect.z) && (this.z <= rect.p1.z);\r\n    intersected = xi && yi && zi;\r\n    if (!get_pts) {\r\n      return intersected;\r\n    }\r\n    if (this.isEnclosed(rect)) {\r\n      return (get_pts ? [] : true);\r\n    }\r\n    if (!intersected) {\r\n      return [];\r\n    }\r\n    sidesA = this.sides();\r\n    sidesB = rect.sides();\r\n    pts = [];\r\n    for (aa = 0, len1 = sidesA.length; aa < len1; aa++) {\r\n      sa = sidesA[aa];\r\n      for (ab = 0, len2 = sidesB.length; ab < len2; ab++) {\r\n        sb = sidesB[ab];\r\n        p = sa.intersectGridLine(sb);\r\n        if (p) {\r\n          pts.push(p);\r\n        }\r\n      }\r\n    }\r\n    return pts;\r\n  };\r\n\r\n  Rectangle.prototype.hasIntersect = function(item, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = false;\r\n    }\r\n    if (item instanceof Circle) {\r\n      return item.intersectLines(this.sides(), get_pts);\r\n    } else if (item instanceof Rectangle) {\r\n      return this.intersectRectangle(item, get_pts);\r\n    } else if (item instanceof PointSet || item instanceof Triangle) {\r\n      return this.intersectLines(item.sides(), get_pts);\r\n    } else if (item instanceof Pair) {\r\n      return this.intersectLine(item, get_pts);\r\n    } else if (item instanceof Point) {\r\n      return Rectangle.contain(item, this, this.p1);\r\n    } else {\r\n      if (get_pts) {\r\n        return [];\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  };\r\n\r\n  Rectangle.prototype.corners = function() {\r\n    return {\r\n      topLeft: new Vector(Math.min(this.x, this.p1.x), Math.min(this.y, this.p1.y), Math.max(this.z, this.p1.z)),\r\n      topRight: new Vector(Math.max(this.x, this.p1.x), Math.min(this.y, this.p1.y), Math.min(this.z, this.p1.z)),\r\n      bottomLeft: new Vector(Math.min(this.x, this.p1.x), Math.max(this.y, this.p1.y), Math.max(this.z, this.p1.z)),\r\n      bottomRight: new Vector(Math.max(this.x, this.p1.x), Math.max(this.y, this.p1.y), Math.min(this.z, this.p1.z))\r\n    };\r\n  };\r\n\r\n  Rectangle.prototype.sides = function() {\r\n    var c;\r\n    c = this.corners();\r\n    return [new Line(c.topLeft).to(c.topRight), new Line(c.topRight).to(c.bottomRight), new Line(c.bottomRight).to(c.bottomLeft), new Line(c.bottomLeft).to(c.topLeft)];\r\n  };\r\n\r\n  Rectangle.prototype.quadrants = function() {\r\n    var c;\r\n    c = this.corners();\r\n    return {\r\n      topLeft: new this.__proto__.constructor(c.topLeft).to(this.center),\r\n      topRight: new this.__proto__.constructor(c.topRight).to(this.center),\r\n      bottomLeft: new this.__proto__.constructor(c.bottomLeft).to(this.center),\r\n      bottomRight: new this.__proto__.constructor(c.bottomRight).to(this.center)\r\n    };\r\n  };\r\n\r\n  Rectangle.prototype.clone = function() {\r\n    var p;\r\n    p = new Rectangle(this).to(this.p1);\r\n    p.to(this.p1.clone());\r\n    return p;\r\n  };\r\n\r\n  return Rectangle;\r\n\r\n})(Pair);\r\n\r\nthis.Rectangle = Rectangle;\r\n\r\nGrid = (function(superClass) {\r\n  extend(Grid, superClass);\r\n\r\n  function Grid() {\r\n    Grid.__super__.constructor.apply(this, arguments);\r\n    this.cell = {\r\n      type: 'fix-fix',\r\n      size: new Vector()\r\n    };\r\n    this.rows = 0;\r\n    this.columns = 0;\r\n    this.layout = [];\r\n    this.cellCallback = null;\r\n  }\r\n\r\n  Grid.prototype.toString = function() {\r\n    var s;\r\n    s = this.size();\r\n    return (\"Grid width \" + s.x + \", height \" + s.y + \", columns \" + this.columns + \", rows \" + this.rows + \", \") + (\"cell (\" + this.cell.size.x + \", \" + this.cell.size.y + \"), type \" + this.cell.type);\r\n  };\r\n\r\n  Grid.prototype.init = function(x, y, xtype, ytype) {\r\n    var size;\r\n    if (xtype == null) {\r\n      xtype = 'fix';\r\n    }\r\n    if (ytype == null) {\r\n      ytype = 'fix';\r\n    }\r\n    size = this.size();\r\n    this.cell.type = xtype + '-' + ytype;\r\n    this.rows = y;\r\n    this.columns = x;\r\n    if (xtype === 'stretch') {\r\n      this.cell.size.x = size.x / x;\r\n      this.columns = x;\r\n    } else if (xtype === 'flex') {\r\n      this.columns = Math.round(size.x / x);\r\n      this.cell.size.x = size.x / this.columns;\r\n    } else {\r\n      this.cell.size.x = x;\r\n      this.columns = Math.floor(size.x / this.cell.size.x);\r\n    }\r\n    if (ytype === 'stretch') {\r\n      this.cell.size.y = size.y / y;\r\n      this.rows = y;\r\n    } else if (ytype === 'flex') {\r\n      this.rows = Math.round(size.y / y);\r\n      this.cell.size.y = size.y / this.rows;\r\n    } else {\r\n      this.cell.size.y = y;\r\n      this.rows = Math.floor(size.y / this.cell.size.y);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Grid.prototype.generate = function(callback) {\r\n    if (typeof callback === \"function\") {\r\n      this.cellCallback = callback;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Grid.prototype.create = function() {\r\n    var aa, ab, c, cell, isOccupied, pos, r, ref, ref1;\r\n    if (!this.cellCallback) {\r\n      return this;\r\n    }\r\n    for (c = aa = 0, ref = this.columns; 0 <= ref ? aa < ref : aa > ref; c = 0 <= ref ? ++aa : --aa) {\r\n      for (r = ab = 0, ref1 = this.rows; 0 <= ref1 ? ab < ref1 : ab > ref1; r = 0 <= ref1 ? ++ab : --ab) {\r\n        cell = this.cell.size.clone();\r\n        pos = this.$add(cell.$multiply(c, r));\r\n        isOccupied = this.layout.length > 0 && this.layout[0].length > 0 ? this.layout[r][c] === 1 : false;\r\n        this.cellCallback(cell, pos, r, c, this.cell.type, isOccupied);\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Grid.prototype.getCellSize = function() {\r\n    return this.cell.size.clone();\r\n  };\r\n\r\n  Grid.prototype.cellToRectangle = function(c, r, allowOutofBound) {\r\n    var rect;\r\n    if (allowOutofBound == null) {\r\n      allowOutofBound = false;\r\n    }\r\n    if (allowOutofBound || (c >= 0 && c < this.columns && r >= 0 && r < this.rows)) {\r\n      rect = new Rectangle(this.$add(this.cell.size.$multiply(c, r))).resizeTo(this.cell.size);\r\n      return rect;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Grid.prototype.positionToCell = function(args) {\r\n    var cellpos, pos;\r\n    pos = new Vector(this._getArgs(arguments));\r\n    cellpos = pos.$subtract(this).$divide(this.cell.size).floor();\r\n    cellpos.max(0, 0).min(this.columns - 1, this.rows - 1);\r\n    return cellpos;\r\n  };\r\n\r\n  Grid.prototype.resetLayout = function(callback) {\r\n    var aa, ab, c, r, ref, ref1;\r\n    this.layout = [];\r\n    for (r = aa = 0, ref = this.rows; 0 <= ref ? aa < ref : aa > ref; r = 0 <= ref ? ++aa : --aa) {\r\n      this.layout[r] = [];\r\n      for (c = ab = 0, ref1 = this.columns; 0 <= ref1 ? ab < ref1 : ab > ref1; c = 0 <= ref1 ? ++ab : --ab) {\r\n        this.layout[r][c] = 0;\r\n        if (callback) {\r\n          callback(this, r, c);\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Grid.prototype.occupy = function(x, y, w, h, occupy) {\r\n    var aa, ab, c, r, ref, ref1;\r\n    if (occupy == null) {\r\n      occupy = true;\r\n    }\r\n    if (this.rows <= 0 || this.columns <= 0) {\r\n      return this;\r\n    }\r\n    if (this.layout.length < 1) {\r\n      this.resetLayout();\r\n    }\r\n    for (c = aa = 0, ref = w; 0 <= ref ? aa < ref : aa > ref; c = 0 <= ref ? ++aa : --aa) {\r\n      for (r = ab = 0, ref1 = h; 0 <= ref1 ? ab < ref1 : ab > ref1; r = 0 <= ref1 ? ++ab : --ab) {\r\n        this.layout[Math.min(this.layout.length - 1, y + r)][x + c] = (occupy ? 1 : 0);\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Grid.prototype.canFit = function(x, y, w, h) {\r\n    var aa, ab, cell, currCol, currRow, ref, ref1, ref2, ref3;\r\n    for (currRow = aa = ref = y, ref1 = Math.min(this.rows, y + h); ref <= ref1 ? aa < ref1 : aa > ref1; currRow = ref <= ref1 ? ++aa : --aa) {\r\n      for (currCol = ab = ref2 = x, ref3 = Math.min(this.columns, x + w); ref2 <= ref3 ? ab < ref3 : ab > ref3; currCol = ref2 <= ref3 ? ++ab : --ab) {\r\n        cell = this.layout[currRow][currCol];\r\n        if ((cell != null) && cell > 0) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  Grid.prototype.fit = function(cols, rows) {\r\n    var aa, ab, b, cell, colCount, colSize, currCol, currRow, freeCol, ref, ref1;\r\n    colSize = Math.min(cols, this.columns);\r\n    for (currRow = aa = 0, ref = this.rows; 0 <= ref ? aa < ref : aa > ref; currRow = 0 <= ref ? ++aa : --aa) {\r\n      colCount = colSize;\r\n      freeCol = 0;\r\n      for (currCol = ab = 0, ref1 = this.columns; 0 <= ref1 ? ab < ref1 : ab > ref1; currCol = 0 <= ref1 ? ++ab : --ab) {\r\n        cell = this.layout[currRow][currCol];\r\n        if ((cell != null) && cell > 0) {\r\n          freeCol++;\r\n          colCount = colSize;\r\n        } else {\r\n          colCount--;\r\n          if (colCount <= 0) {\r\n            this.occupy(freeCol, currRow, colSize, rows);\r\n            b = new Rectangle(this.$add(this.cell.size.$multiply(freeCol, currRow)));\r\n            b.resizeTo(this.cell.size.$multiply(colSize, rows));\r\n            return {\r\n              row: currRow,\r\n              column: freeCol,\r\n              columnSize: colSize,\r\n              rowSize: rows,\r\n              bound: b\r\n            };\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  Grid.prototype.neighbors = function(c, r) {\r\n    var aa, len1, n, ns, temp;\r\n    temp = [[c - 1, r - 1], [c, r - 1], [c + 1, r - 1], [c + 1, r], [c + 1, r + 1], [c, r + 1], [c - 1, r + 1], [c - 1, r]];\r\n    ns = [];\r\n    for (aa = 0, len1 = temp.length; aa < len1; aa++) {\r\n      n = temp[aa];\r\n      if (n[0] >= 0 && n[0] < this.columns && n[1] >= 0 && n[1] < this.rows) {\r\n        ns.push(new Vector(n[0], n[1], this.layout[n[1]][n[0]]));\r\n      } else {\r\n        ns.push(false);\r\n      }\r\n    }\r\n    return ns;\r\n  };\r\n\r\n  return Grid;\r\n\r\n})(Rectangle);\r\n\r\nthis.Grid = Grid;\r\n\r\nPointSet = (function(superClass) {\r\n  extend(PointSet, superClass);\r\n\r\n  function PointSet() {\r\n    PointSet.__super__.constructor.apply(this, arguments);\r\n    this.points = [];\r\n  }\r\n\r\n  PointSet.prototype.toString = function() {\r\n    var aa, len1, p, ref, str;\r\n    str = \"PointSet [ \";\r\n    ref = this.points;\r\n    for (aa = 0, len1 = ref.length; aa < len1; aa++) {\r\n      p = ref[aa];\r\n      str += p.x + \",\" + p.y + \",\" + p.z + \", \";\r\n    }\r\n    return str + \" ]\";\r\n  };\r\n\r\n  PointSet.prototype.toArray = function() {\r\n    return this.points.slice();\r\n  };\r\n\r\n  PointSet.prototype.to = function(args) {\r\n    var aa, len1, p, ref;\r\n    if (arguments.length > 0) {\r\n      if (Array.isArray(arguments[0]) && arguments[0].length > 0 && typeof arguments[0][0] === 'object') {\r\n        ref = arguments[0];\r\n        for (aa = 0, len1 = ref.length; aa < len1; aa++) {\r\n          p = ref[aa];\r\n          this.points.push(new Vector(p));\r\n        }\r\n      } else {\r\n        this.points.push(new Vector(Point.get(arguments)));\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  PointSet.prototype.getAt = function(index) {\r\n    return this.points[Math.min(this.points.length - 1, Math.max(0, index))];\r\n  };\r\n\r\n  PointSet.prototype.$getAt = function(index) {\r\n    return new Vector(this.getAt(index));\r\n  };\r\n\r\n  PointSet.prototype.setAt = function(index, p) {\r\n    this.points[index] = p;\r\n    return this;\r\n  };\r\n\r\n  PointSet.prototype.count = function() {\r\n    return this.points.length;\r\n  };\r\n\r\n  PointSet.prototype.connectFromAnchor = function(args) {\r\n    var aa, len1, p, ref;\r\n    if (arguments.length > 0) {\r\n      if (Array.isArray(arguments[0]) && arguments[0].length > 0) {\r\n        ref = arguments[0];\r\n        for (aa = 0, len1 = ref.length; aa < len1; aa++) {\r\n          p = ref[aa];\r\n          this.points.push(this.$add(p));\r\n        }\r\n      } else {\r\n        this.points.push(this.$add(Point.get(arguments)));\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  PointSet.prototype.disconnect = function(index) {\r\n    if (index == null) {\r\n      index = -1;\r\n    }\r\n    if (index < 0) {\r\n      this.points = this.points.slice(0, this.points.length + index);\r\n    } else {\r\n      this.points = this.points.slice(index + 1);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  PointSet.prototype.sides = function(close_path) {\r\n    var aa, lastP, len1, p, ref, sides;\r\n    if (close_path == null) {\r\n      close_path = true;\r\n    }\r\n    lastP = null;\r\n    sides = [];\r\n    ref = this.points;\r\n    for (aa = 0, len1 = ref.length; aa < len1; aa++) {\r\n      p = ref[aa];\r\n      if (lastP) {\r\n        sides.push(new Line(lastP).to(p));\r\n      }\r\n      lastP = p;\r\n    }\r\n    if (this.points.length > 1 && close_path) {\r\n      sides.push(new Line(lastP).to(this.points[0]));\r\n    }\r\n    return sides;\r\n  };\r\n\r\n  PointSet.prototype.angles = function(axis) {\r\n    var aa, angles, i, ref, v1, v2;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    angles = [];\r\n    for (i = aa = 1, ref = this.points.length - 1; aa < ref; i = aa += 1) {\r\n      v1 = this.points[i - 1].$subtract(this.points[i]);\r\n      v2 = this.points[i + 1].$subtract(this.points[i]);\r\n      angles.push({\r\n        p0: this.points[i - 1],\r\n        p1: this.points[i],\r\n        p2: this.points[i + 1],\r\n        angle: v1.angleBetween(v2)\r\n      });\r\n    }\r\n    return angles;\r\n  };\r\n\r\n  PointSet.prototype.bounds = function() {\r\n    return Util.boundingBox(this.points);\r\n  };\r\n\r\n  PointSet.prototype.centroid = function() {\r\n    return Util.centroid(this.points);\r\n  };\r\n\r\n  PointSet.prototype.convexHull = function(sort) {\r\n    var dq, i, left, pt, pts;\r\n    if (sort == null) {\r\n      sort = true;\r\n    }\r\n    if (this.points.length < 3) {\r\n      return [];\r\n    }\r\n    if (sort) {\r\n      pts = this.points.slice();\r\n      pts.sort(function(a, b) {\r\n        return a.x - b.x;\r\n      });\r\n    } else {\r\n      pts = this.points;\r\n    }\r\n    left = function(a, b, pt) {\r\n      return (b.x - a.x) * (pt.y - a.y) - (pt.x - a.x) * (b.y - a.y) > 0;\r\n    };\r\n    dq = [];\r\n    if (left(pts[0], pts[1], pts[2])) {\r\n      dq.push(pts[0]);\r\n      dq.push(pts[1]);\r\n    } else {\r\n      dq.push(pts[1]);\r\n      dq.push(pts[0]);\r\n    }\r\n    dq.unshift(pts[2]);\r\n    dq.push(pts[2]);\r\n    i = 3;\r\n    while (i < pts.length) {\r\n      pt = pts[i];\r\n      if (left(pt, dq[0], dq[1]) && left(dq[dq.length - 2], dq[dq.length - 1], pt)) {\r\n        i++;\r\n        continue;\r\n      }\r\n      while (!left(dq[dq.length - 2], dq[dq.length - 1], pt)) {\r\n        dq.pop();\r\n      }\r\n      dq.push(pt);\r\n      while (!left(dq[0], dq[1], pt)) {\r\n        dq.shift();\r\n      }\r\n      dq.unshift(pt);\r\n      i++;\r\n    }\r\n    return dq;\r\n  };\r\n\r\n  PointSet.prototype.clone = function() {\r\n    return new PointSet(this).to(Util.clonePoints(this.points));\r\n  };\r\n\r\n  return PointSet;\r\n\r\n})(Vector);\r\n\r\nthis.PointSet = PointSet;\r\n\r\nCurve = (function(superClass) {\r\n  extend(Curve, superClass);\r\n\r\n  function Curve() {\r\n    Curve.__super__.constructor.apply(this, arguments);\r\n    this.is3D = false;\r\n  }\r\n\r\n  Curve.prototype._getSteps = function(steps) {\r\n    var aa, ref, s, t, ts;\r\n    ts = [];\r\n    for (s = aa = 0, ref = steps; aa <= ref; s = aa += 1) {\r\n      t = s / steps;\r\n      ts.push([t, t * t, t * t * t]);\r\n    }\r\n    return ts;\r\n  };\r\n\r\n  Curve.prototype.controlPoints = function(index, copyStart) {\r\n    var _index, p0, p1, p2, p3;\r\n    if (index == null) {\r\n      index = 0;\r\n    }\r\n    if (copyStart == null) {\r\n      copyStart = false;\r\n    }\r\n    _index = (function(_this) {\r\n      return function(i) {\r\n        var idx;\r\n        idx = i < _this.points.length - 1 ? i : _this.points.length - 1;\r\n        return idx;\r\n      };\r\n    })(this);\r\n    p0 = this.points[index];\r\n    if (p0.x == null) {\r\n      return false;\r\n    }\r\n    index = copyStart ? index : index + 1;\r\n    p1 = this.points[_index(index++)];\r\n    p2 = this.points[_index(index++)];\r\n    p3 = this.points[_index(index++)];\r\n    return {\r\n      p0: p0,\r\n      p1: p1,\r\n      p2: p2,\r\n      p3: p3\r\n    };\r\n  };\r\n\r\n  Curve.prototype.catmullRom = function(steps) {\r\n    var aa, ab, c, i, k, ps, ref, ref1, ts;\r\n    if (steps == null) {\r\n      steps = 10;\r\n    }\r\n    if (this.points.length < 2) {\r\n      return [];\r\n    }\r\n    ps = [];\r\n    ts = this._getSteps(steps);\r\n    c = this.controlPoints(0, true);\r\n    for (i = aa = 0, ref = steps; aa <= ref; i = aa += 1) {\r\n      ps.push(this.catmullRomPoint(ts[i], c));\r\n    }\r\n    k = 0;\r\n    while (k < this.points.length - 2) {\r\n      c = this.controlPoints(k);\r\n      if (c) {\r\n        for (i = ab = 0, ref1 = steps; ab <= ref1; i = ab += 1) {\r\n          ps.push(this.catmullRomPoint(ts[i], c));\r\n        }\r\n        k++;\r\n      }\r\n    }\r\n    return ps;\r\n  };\r\n\r\n  Curve.prototype.catmullRomPoint = function(step, ctrls) {\r\n    var h1, h2, h3, h4, t, t2, t3, x, y, z;\r\n    t = step[0];\r\n    t2 = step[1];\r\n    t3 = step[2];\r\n    h1 = -0.5 * t3 + t2 - 0.5 * t;\r\n    h2 = 1.5 * t3 - 2.5 * t2 + 1;\r\n    h3 = -1.5 * t3 + 2 * t2 + 0.5 * t;\r\n    h4 = 0.5 * t3 - 0.5 * t2;\r\n    x = h1 * ctrls.p0.x + h2 * ctrls.p1.x + h3 * ctrls.p2.x + h4 * ctrls.p3.x;\r\n    y = h1 * ctrls.p0.y + h2 * ctrls.p1.y + h3 * ctrls.p2.y + h4 * ctrls.p3.y;\r\n    z = !this.is3D ? 0 : h1 * ctrls.p0.z + h2 * ctrls.p1.z + h3 * ctrls.p2.z + h4 * ctrls.p3.z;\r\n    return new Point(x, y, z);\r\n  };\r\n\r\n  Curve.prototype.cardinal = function(steps, tension) {\r\n    var aa, ab, c, i, k, ps, ref, ref1, ts;\r\n    if (steps == null) {\r\n      steps = 10;\r\n    }\r\n    if (tension == null) {\r\n      tension = 0.5;\r\n    }\r\n    if (this.points.length < 2) {\r\n      return [];\r\n    }\r\n    ps = [];\r\n    ts = this._getSteps(steps);\r\n    c = this.controlPoints(0, true);\r\n    for (i = aa = 0, ref = steps; aa <= ref; i = aa += 1) {\r\n      ps.push(this.cardinalPoint(ts[i], c, tension));\r\n    }\r\n    k = 0;\r\n    while (k < this.points.length - 2) {\r\n      c = this.controlPoints(k);\r\n      if (c) {\r\n        for (i = ab = 0, ref1 = steps; ab <= ref1; i = ab += 1) {\r\n          ps.push(this.cardinalPoint(ts[i], c, tension));\r\n        }\r\n        k++;\r\n      }\r\n    }\r\n    return ps;\r\n  };\r\n\r\n  Curve.prototype.cardinalPoint = function(step, ctrls, tension) {\r\n    var h1, h2, h2a, h3, h3a, h4, t, t2, t3, x, y, z;\r\n    if (tension == null) {\r\n      tension = 0.5;\r\n    }\r\n    t = step[0];\r\n    t2 = step[1];\r\n    t3 = step[2];\r\n    h1 = tension * (-1 * t3 + 2 * t2 - t);\r\n    h2 = tension * (-1 * t3 + t2);\r\n    h2a = 2 * t3 - 3 * t2 + 1;\r\n    h3 = tension * (t3 - 2 * t2 + t);\r\n    h3a = -2 * t3 + 3 * t2;\r\n    h4 = tension * (t3 - t2);\r\n    x = ctrls.p0.x * h1 + ctrls.p1.x * h2 + h2a * ctrls.p1.x + ctrls.p2.x * h3 + h3a * ctrls.p2.x + ctrls.p3.x * h4;\r\n    y = ctrls.p0.y * h1 + ctrls.p1.y * h2 + h2a * ctrls.p1.y + ctrls.p2.y * h3 + h3a * ctrls.p2.y + ctrls.p3.y * h4;\r\n    z = !this.is3D ? 0 : ctrls.p0.z * h1 + ctrls.p1.z * h2 + h2a * ctrls.p1.z + ctrls.p2.z * h3 + h3a * ctrls.p2.z + ctrls.p3.z * h4;\r\n    return new Point(x, y, z);\r\n  };\r\n\r\n  Curve.prototype.bezier = function(steps) {\r\n    var aa, c, i, k, ps, ref, ts;\r\n    if (steps == null) {\r\n      steps = 10;\r\n    }\r\n    if (this.points.length < 4) {\r\n      return [];\r\n    }\r\n    ps = [];\r\n    ts = this._getSteps(steps);\r\n    k = 0;\r\n    while (k <= this.points.length - 3) {\r\n      c = this.controlPoints(k);\r\n      if (c) {\r\n        for (i = aa = 0, ref = steps; aa <= ref; i = aa += 1) {\r\n          ps.push(this.bezierPoint(ts[i], c));\r\n        }\r\n        k += 3;\r\n      }\r\n    }\r\n    return ps;\r\n  };\r\n\r\n  Curve.prototype.bezierPoint = function(step, ctrls) {\r\n    var h1, h2, h3, h4, t, t2, t3, x, y, z;\r\n    t = step[0];\r\n    t2 = step[1];\r\n    t3 = step[2];\r\n    h1 = -1 * t3 + 3 * t2 - 3 * t + 1;\r\n    h2 = 3 * t3 - 6 * t2 + 3 * t;\r\n    h3 = -3 * t3 + 3 * t2;\r\n    h4 = t3;\r\n    x = h1 * ctrls.p0.x + h2 * ctrls.p1.x + h3 * ctrls.p2.x + h4 * ctrls.p3.x;\r\n    y = h1 * ctrls.p0.y + h2 * ctrls.p1.y + h3 * ctrls.p2.y + h4 * ctrls.p3.y;\r\n    z = !this.is3D ? 0 : h1 * ctrls.p0.z + h2 * ctrls.p1.z + h3 * ctrls.p2.z + h4 * ctrls.p3.z;\r\n    return new Point(x, y, z);\r\n  };\r\n\r\n  Curve.prototype.bspline = function(steps, tension) {\r\n    var aa, ab, c, i, k, ps, ref, ref1, ts;\r\n    if (steps == null) {\r\n      steps = 10;\r\n    }\r\n    if (tension == null) {\r\n      tension = false;\r\n    }\r\n    if (this.points.length < 2) {\r\n      return [];\r\n    }\r\n    ps = [];\r\n    ts = this._getSteps(steps);\r\n    k = 0;\r\n    while (k < this.points.length - 2) {\r\n      c = this.controlPoints(k);\r\n      if (c) {\r\n        if (!tension) {\r\n          for (i = aa = 0, ref = steps; aa <= ref; i = aa += 1) {\r\n            ps.push(this.bsplinePoint(ts[i], c));\r\n          }\r\n        } else {\r\n          for (i = ab = 0, ref1 = steps; ab <= ref1; i = ab += 1) {\r\n            ps.push(this.bsplineTensionPoint(ts[i], c, tension));\r\n          }\r\n        }\r\n        k++;\r\n      }\r\n    }\r\n    return ps;\r\n  };\r\n\r\n  Curve.prototype.bsplinePoint = function(step, ctrls) {\r\n    var h1, h2, h3, h4, t, t2, t3, x, y, z;\r\n    t = step[0];\r\n    t2 = step[1];\r\n    t3 = step[2];\r\n    h1 = -0.16666666666 * t3 + 0.5 * t2 - 0.5 * t + 0.16666666666;\r\n    h2 = 0.5 * t3 - t2 + 0.66666666666;\r\n    h3 = -0.5 * t3 + 0.5 * t2 + 0.5 * t + 0.16666666666;\r\n    h4 = 0.16666666666 * t3;\r\n    x = h1 * ctrls.p0.x + h2 * ctrls.p1.x + h3 * ctrls.p2.x + h4 * ctrls.p3.x;\r\n    y = h1 * ctrls.p0.y + h2 * ctrls.p1.y + h3 * ctrls.p2.y + h4 * ctrls.p3.y;\r\n    z = !this.is3D ? 0 : h1 * ctrls.p0.z + h2 * ctrls.p1.z + h3 * ctrls.p2.z + h4 * ctrls.p3.z;\r\n    return new Point(x, y, z);\r\n  };\r\n\r\n  Curve.prototype.bsplineTensionPoint = function(step, ctrls, tension) {\r\n    var h1, h2, h2a, h3, h3a, h4, t, t2, t3, x, y, z;\r\n    if (tension == null) {\r\n      tension = 1;\r\n    }\r\n    t = step[0];\r\n    t2 = step[1];\r\n    t3 = step[2];\r\n    h1 = tension * (-0.16666666666 * t3 + 0.5 * t2 - 0.5 * t + 0.16666666666);\r\n    h2 = tension * (-1.5 * t3 + 2 * t2 - 0.33333333333);\r\n    h2a = 2 * t3 - 3 * t2 + 1;\r\n    h3 = tension * (1.5 * t3 - 2.5 * t2 + 0.5 * t + 0.16666666666);\r\n    h3a = -2 * t3 + 3 * t2;\r\n    h4 = tension * (0.16666666666 * t3);\r\n    x = h1 * ctrls.p0.x + h2 * ctrls.p1.x + h2a * ctrls.p1.x + h3 * ctrls.p2.x + h3a * ctrls.p2.x + h4 * ctrls.p3.x;\r\n    y = h1 * ctrls.p0.y + h2 * ctrls.p1.y + h2a * ctrls.p1.y + h3 * ctrls.p2.y + h3a * ctrls.p2.y + h4 * ctrls.p3.y;\r\n    z = !this.is3D ? 0 : h1 * ctrls.p0.z + h2 * ctrls.p1.z + h2a * ctrls.p1.y + h3 * ctrls.p2.z + h3a * ctrls.p2.z + h4 * ctrls.p3.z;\r\n    return new Point(x, y, z);\r\n  };\r\n\r\n  return Curve;\r\n\r\n})(PointSet);\r\n\r\nthis.Curve = Curve;\r\n\r\nTriangle = (function(superClass) {\r\n  extend(Triangle, superClass);\r\n\r\n  function Triangle() {\r\n    Triangle.__super__.constructor.apply(this, arguments);\r\n    this.p1 = new Vector(this.x - 1, this.y - 1, this.z);\r\n    this.p2 = new Vector(this.x + 1, this.y + 1, this.z);\r\n  }\r\n\r\n  Triangle.prototype.to = function(args) {\r\n    if (arguments.length > 0) {\r\n      if (typeof arguments[0] === 'object' && arguments.length === 2) {\r\n        this.p1.set(arguments[0]);\r\n        this.p2.set(arguments[1]);\r\n      } else {\r\n        if (arguments.length < 6) {\r\n          this.p1.set([arguments[0], arguments[1]]);\r\n          this.p2.set([arguments[2], arguments[3]]);\r\n        } else {\r\n          this.p1.set([arguments[0], arguments[1], arguments[2]]);\r\n          this.p2.set([arguments[3], arguments[4], arguments[5]]);\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Triangle.prototype.toArray = function() {\r\n    return [this, this.p1, this.p2];\r\n  };\r\n\r\n  Triangle.prototype.toString = function() {\r\n    return \"Triangle (\" + this.x + \", \" + this.y + \", \" + this.z + \"), (\" + this.p1.x + \", \" + this.p1.y + \", \" + this.p1.z + \"), (\" + this.p2.x + \", \" + this.p2.y + \", \" + this.p2.z + \")\";\r\n  };\r\n\r\n  Triangle.prototype.getAt = function(index) {\r\n    if (index === 1 || index === \"p1\") {\r\n      return this.p1;\r\n    }\r\n    if (index === 2 || index === \"p2\") {\r\n      return this.p2;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  Triangle.prototype.$getAt = function(index) {\r\n    return new Vector(this.getAt(index));\r\n  };\r\n\r\n  Triangle.prototype.toPointSet = function() {\r\n    var p0;\r\n    p0 = new Vector(this);\r\n    return new PointSet(p0).to([p0, this.p1, this.p2]);\r\n  };\r\n\r\n  Triangle.prototype.sides = function() {\r\n    return [new Line(this).to(this.p1), new Line(this.p1).to(this.p2), new Line(this.p2).to(this)];\r\n  };\r\n\r\n  Triangle.prototype.angles = function(axis) {\r\n    var angles;\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    angles = [this.p2.$subtract(this).angleBetween(this.p1.$subtract(this), axis), this.$subtract(this.p1).angleBetween(this.p2.$subtract(this.p1), axis)];\r\n    angles.push(Math.PI - angles[0] - angles[1]);\r\n    return angles;\r\n  };\r\n\r\n  Triangle.prototype.medial = function() {\r\n    var pts, side, sides;\r\n    sides = this.sides();\r\n    pts = (function() {\r\n      var aa, len1, results;\r\n      results = [];\r\n      for (aa = 0, len1 = sides.length; aa < len1; aa++) {\r\n        side = sides[aa];\r\n        results.push(side.midpoint());\r\n      }\r\n      return results;\r\n    })();\r\n    return new Triangle(pts[0]).to(pts[1], pts[2]);\r\n  };\r\n\r\n  Triangle.prototype.perimeter = function() {\r\n    var lens, sides;\r\n    sides = this.sides();\r\n    lens = [sides[0].length(), sides[1].length(), sides[2].length()];\r\n    return {\r\n      sides: sides,\r\n      value: lens[0] + lens[1] + lens[2],\r\n      lengths: lens\r\n    };\r\n  };\r\n\r\n  Triangle.prototype.area = function() {\r\n    var hp, p;\r\n    p = this.perimeter();\r\n    hp = p.value / 2;\r\n    return {\r\n      value: Math.sqrt(hp * (hp - p.lengths[0]) * (hp - p.lengths[1]) * (hp - p.lengths[2])),\r\n      perimeter: p\r\n    };\r\n  };\r\n\r\n  Triangle.prototype.oppositeSide = function(id) {\r\n    if (id === \"p1\") {\r\n      return new Line(this).to(this.p2);\r\n    } else if (id === \"p2\") {\r\n      return new Line(this).to(this.p1);\r\n    } else {\r\n      return new Line(this.p1).to(this.p2);\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.adjacentSides = function(id) {\r\n    if (id === \"p1\") {\r\n      return [new Line(this.p1).to(this), new Line(this.p1).to(this.p2)];\r\n    } else if (id === \"p2\") {\r\n      return [new Line(this.p2).to(this), new Line(this.p2).to(this.p1)];\r\n    } else {\r\n      return [new Line(this).to(this.p1), new Line(this).to(this.p2)];\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.bisector = function(id, asLine, size) {\r\n    var ad, bp, p;\r\n    if (asLine == null) {\r\n      asLine = false;\r\n    }\r\n    if (size == null) {\r\n      size = 100;\r\n    }\r\n    ad = this.adjacentSides(id);\r\n    p = new Vector(ad[0]);\r\n    ad[0].moveTo(0, 0);\r\n    ad[1].moveTo(0, 0);\r\n    bp = ad[0].p1.bisect(ad[1].p1);\r\n    if (asLine) {\r\n      return new Line(p).to(bp.multiply(size).add(p));\r\n    } else {\r\n      return bp;\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.altitude = function(id) {\r\n    if (id === \"p1\" || id === \"p2\") {\r\n      return new Line(this[id]).to(this.oppositeSide(id).getPerpendicularFromPoint(this[id]));\r\n    } else {\r\n      return new Line(this).to(this.oppositeSide().getPerpendicularFromPoint(this));\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.centroid = function() {\r\n    var c0, c1, c2;\r\n    c0 = this.$divide(3);\r\n    c1 = this.p1.$divide(3);\r\n    c2 = this.p2.$divide(3);\r\n    return new Vector(c0.x + c1.x + c2.x, c0.y + c1.y + c2.y, c0.z + c1.z + c2.z);\r\n  };\r\n\r\n  Triangle.prototype.orthocenter = function() {\r\n    var a, b;\r\n    a = this.altitude();\r\n    b = this.altitude(\"p1\");\r\n    return a.intersectPath(b, Const.xyz);\r\n  };\r\n\r\n  Triangle.prototype.incenter = function() {\r\n    var a, b;\r\n    a = this.bisector(\"p0\", true);\r\n    b = this.bisector(\"p1\", true);\r\n    return a.intersectPath(b, Const.xyz);\r\n  };\r\n\r\n  Triangle.prototype.incircle = function() {\r\n    var area, center, radius;\r\n    center = this.incenter();\r\n    area = this.area();\r\n    radius = 2 * area.value / area.perimeter.value;\r\n    return new Circle(center).setRadius(radius);\r\n  };\r\n\r\n  Triangle.prototype.circumcenter = function() {\r\n    var medial, pbs;\r\n    medial = this.medial();\r\n    pbs = [new Line(medial).to(this.$subtract(medial).perpendicular()[0].$add(medial)), new Line(medial.p1).to(this.p1.$subtract(medial.p1).perpendicular()[0].$add(medial.p1)), new Line(medial.p2).to(this.p2.$subtract(medial.p2).perpendicular()[0].$add(medial.p2))];\r\n    return {\r\n      center: pbs[0].intersectPath(pbs[1], Const.xyz),\r\n      bisectors: pbs\r\n    };\r\n  };\r\n\r\n  Triangle.prototype.circumcircle = function() {\r\n    var center, r;\r\n    center = this.circumcenter();\r\n    r = this.magnitude(center.center);\r\n    return new Circle(center.center).setRadius(r);\r\n  };\r\n\r\n  Triangle.prototype.intersectPoint = function(p) {\r\n    var hp, s, sides;\r\n    sides = this.sides();\r\n    hp = (function() {\r\n      var aa, len1, results;\r\n      results = [];\r\n      for (aa = 0, len1 = sides.length; aa < len1; aa++) {\r\n        s = sides[aa];\r\n        results.push(s.collinear(p) > 0);\r\n      }\r\n      return results;\r\n    })();\r\n    return hp[0] === hp[1] && hp[1] === hp[2];\r\n  };\r\n\r\n  Triangle.prototype.intersectPath = function(path, get_pts, axis) {\r\n    var aa, len1, p, pts, s, sides;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    sides = this.sides();\r\n    pts = [];\r\n    for (aa = 0, len1 = sides.length; aa < len1; aa++) {\r\n      s = sides[aa];\r\n      p = s.intersectPath(path);\r\n      if (p && s.withinBounds(p, axis)) {\r\n        if (!get_pts) {\r\n          return true;\r\n        }\r\n        pts.push(p);\r\n      }\r\n    }\r\n    if (get_pts) {\r\n      return pts;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.intersectLine = function(line, get_pts, axis) {\r\n    var aa, ins, len1, p, pts;\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    if (axis == null) {\r\n      axis = Const.xy;\r\n    }\r\n    ins = this.intersectPath(line, true, axis);\r\n    pts = [];\r\n    for (aa = 0, len1 = ins.length; aa < len1; aa++) {\r\n      p = ins[aa];\r\n      if (line.withinBounds(p)) {\r\n        if (!get_pts) {\r\n          return true;\r\n        }\r\n        pts.push(p);\r\n      }\r\n    }\r\n    if (get_pts) {\r\n      return pts;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.intersectLines = function(lines, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    return Line.intersectLines(this, lines, get_pts);\r\n  };\r\n\r\n  Triangle.prototype.intersectPath3D = function(path, get_pts) {\r\n    var det, dir, e1, e2, inv_det, pvec, qvec, t, tvec, u, v;\r\n    e1 = this.p1.$subtract(this);\r\n    e2 = this.p2.$subtract(this);\r\n    dir = path.direction().normalize();\r\n    pvec = dir.cross(e2);\r\n    det = e1.dot(pvec);\r\n    if (det > -Const.epsilon && det < Const.epsilon) {\r\n      return false;\r\n    }\r\n    inv_det = 1 / det;\r\n    tvec = path.$subtract(this);\r\n    u = tvec.dot(pvec) * inv_det;\r\n    if (u < 0 || u > 1) {\r\n      return false;\r\n    }\r\n    qvec = tvec.cross(e1);\r\n    v = dir.dot(qvec) * inv_det;\r\n    if (v < 0 || v > 1) {\r\n      return false;\r\n    }\r\n    t = e2.dot(qvec) * inv_det;\r\n    if (t > Const.epsilon) {\r\n      if (get_pts) {\r\n        return [u, v, t];\r\n      } else {\r\n        return true;\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  Triangle.prototype.intersectRectangle = function(rect, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    return rect.intersectLines(this.sides(), get_pts);\r\n  };\r\n\r\n  Triangle.prototype.intersectCircle = function(circle, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    return circle.intersectLines(this.sides(), get_pts);\r\n  };\r\n\r\n  Triangle.prototype.intersectTriangle = function(tri, get_pts) {\r\n    if (get_pts == null) {\r\n      get_pts = true;\r\n    }\r\n    return tri.intersectLines(this.sides(), get_pts);\r\n  };\r\n\r\n  Triangle.prototype.clone = function() {\r\n    return new Triangle(this).to(this.p1, this.p2);\r\n  };\r\n\r\n  return Triangle;\r\n\r\n})(Vector);\r\n\r\nthis.Triangle = Triangle;\r\n\r\nSVGForm = (function() {\r\n  SVGForm._domId = 0;\r\n\r\n  function SVGForm(space) {\r\n    this.cc = space.ctx || {};\r\n    this.cc.group = this.cc.group || null;\r\n    this.cc.groupID = \"ptx\";\r\n    this.cc.groupCount = 0;\r\n    this.cc.currentID = \"ptx0\";\r\n    this.cc.style = {\r\n      fill: \"#999\",\r\n      stroke: \"#666\",\r\n      \"stroke-width\": 1,\r\n      \"stroke-linejoin\": false,\r\n      \"stroke-linecap\": false\r\n    };\r\n    this.cc.font = \"11px sans-serif\";\r\n    this.cc.fontSize = 11;\r\n    this.cc.fontFace = \"sans-serif\";\r\n  }\r\n\r\n  SVGForm.prototype.fill = function(c) {\r\n    this.cc.style.fill = c ? c : false;\r\n    return this;\r\n  };\r\n\r\n  SVGForm.prototype.stroke = function(c, width, joint, cap) {\r\n    this.cc.style.stroke = c ? c : false;\r\n    if (width) {\r\n      this.cc.style[\"stroke-width\"] = width;\r\n    }\r\n    if (joint) {\r\n      this.cc.style[\"stroke-linejoin\"] = joint;\r\n    }\r\n    if (cap) {\r\n      this.cc.style[\"stroke-linecap\"] = joint;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  SVGForm.prototype.scope = function(group_id, group) {\r\n    if (group == null) {\r\n      group = false;\r\n    }\r\n    if (group) {\r\n      this.cc.group = group;\r\n    }\r\n    this.cc.groupID = group_id;\r\n    this.cc.groupCount = 0;\r\n    this.nextID();\r\n    return this.cc;\r\n  };\r\n\r\n  SVGForm.prototype.getScope = function(item) {\r\n    if (!item || item.animateID === null) {\r\n      throw \"getScope()'s item must be added to a Space, and has an animateID property. Otherwise, use scope() instead.\";\r\n    }\r\n    return this.scope(SVGForm._scopeID(item));\r\n  };\r\n\r\n  SVGForm.prototype.nextID = function() {\r\n    this.cc.groupCount++;\r\n    this.cc.currentID = this.cc.groupID + \"-\" + this.cc.groupCount;\r\n    return this.cc.currentID;\r\n  };\r\n\r\n  SVGForm.id = function(ctx) {\r\n    return ctx.currentID || \"p-\" + SVGForm._domId++;\r\n  };\r\n\r\n  SVGForm._scopeID = function(item) {\r\n    return \"item\" + item.animateID;\r\n  };\r\n\r\n  SVGForm.style = function(elem, styles) {\r\n    var k, st, v;\r\n    st = {};\r\n    for (k in styles) {\r\n      v = styles[k];\r\n      if (!v) {\r\n        if (k === \"fill\" || k === \"stroke\") {\r\n          st[k] = \"none\";\r\n        }\r\n      } else {\r\n        st[k] = v;\r\n      }\r\n    }\r\n    return DOMSpace.attr(elem, st);\r\n  };\r\n\r\n  SVGForm.point = function(ctx, pt, halfsize, fill, stroke, circle) {\r\n    var elem;\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = true;\r\n    }\r\n    if (circle == null) {\r\n      circle = false;\r\n    }\r\n    elem = SVGSpace.svgElement(ctx.group, (circle ? \"circle\" : \"rect\"), SVGForm.id(ctx));\r\n    if (!elem) {\r\n      return;\r\n    }\r\n    if (circle) {\r\n      DOMSpace.attr(elem, {\r\n        cx: pt.x,\r\n        cy: pt.y,\r\n        r: halfsize\r\n      });\r\n    } else {\r\n      DOMSpace.attr(elem, {\r\n        x: pt.x - halfsize,\r\n        y: pt.y - halfsize,\r\n        width: halfsize + halfsize,\r\n        height: halfsize + halfsize\r\n      });\r\n    }\r\n    SVGForm.style(elem, ctx.style);\r\n    return elem;\r\n  };\r\n\r\n  SVGForm.prototype.point = function(p, halfsize, isCircle) {\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (isCircle == null) {\r\n      isCircle = false;\r\n    }\r\n    this.nextID();\r\n    SVGForm.point(this.cc, p, halfsize, true, true, isCircle);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.points = function(ctx, pts, halfsize, fill, stroke, circle) {\r\n    var p;\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = true;\r\n    }\r\n    if (circle == null) {\r\n      circle = false;\r\n    }\r\n    return (function() {\r\n      var aa, len1, results;\r\n      results = [];\r\n      for (aa = 0, len1 = pts.length; aa < len1; aa++) {\r\n        p = pts[aa];\r\n        results.push(SVGForm.point(ctx, p, halfsize, fill, stroke, circle));\r\n      }\r\n      return results;\r\n    })();\r\n  };\r\n\r\n  SVGForm.prototype.points = function(ps, halfsize, isCircle) {\r\n    var aa, len1, p;\r\n    if (halfsize == null) {\r\n      halfsize = 2;\r\n    }\r\n    if (isCircle == null) {\r\n      isCircle = false;\r\n    }\r\n    for (aa = 0, len1 = ps.length; aa < len1; aa++) {\r\n      p = ps[aa];\r\n      this.point(p, halfsize, isCircle);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  SVGForm.line = function(ctx, pair) {\r\n    var elem;\r\n    if (!pair.p1) {\r\n      throw (pair.toString()) + \" is not a Pair\";\r\n    }\r\n    elem = SVGSpace.svgElement(ctx.group, \"line\", SVGForm.id(ctx));\r\n    DOMSpace.attr(elem, {\r\n      x1: pair.x,\r\n      y1: pair.y,\r\n      x2: pair.p1.x,\r\n      y2: pair.p1.y\r\n    });\r\n    SVGForm.style(elem, ctx.style);\r\n    return elem;\r\n  };\r\n\r\n  SVGForm.prototype.line = function(p) {\r\n    this.nextID();\r\n    SVGForm.line(this.cc, p);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.lines = function(ctx, pairs) {\r\n    var ln;\r\n    return (function() {\r\n      var aa, len1, results;\r\n      results = [];\r\n      for (aa = 0, len1 = pairs.length; aa < len1; aa++) {\r\n        ln = pairs[aa];\r\n        results.push(SVGForm.line(ctx, ln));\r\n      }\r\n      return results;\r\n    })();\r\n  };\r\n\r\n  SVGForm.prototype.lines = function(ps) {\r\n    var aa, len1, p;\r\n    for (aa = 0, len1 = ps.length; aa < len1; aa++) {\r\n      p = ps[aa];\r\n      this.line(p);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  SVGForm.rect = function(ctx, pair, fill, stroke) {\r\n    var elem, size;\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = true;\r\n    }\r\n    if (!pair.p1) {\r\n      throw \"\" + (pair.toString() === !a(Pair));\r\n    }\r\n    elem = SVGSpace.svgElement(ctx.group, \"rect\", SVGForm.id(ctx));\r\n    size = pair.size();\r\n    DOMSpace.attr(elem, {\r\n      x: pair.x,\r\n      y: pair.y,\r\n      width: size.x,\r\n      height: size.y\r\n    });\r\n    SVGForm.style(elem, ctx.style);\r\n    return elem;\r\n  };\r\n\r\n  SVGForm.prototype.rect = function(p, checkBounds) {\r\n    var r;\r\n    if (checkBounds == null) {\r\n      checkBounds = true;\r\n    }\r\n    this.nextID();\r\n    r = checkBounds ? p.bounds() : p;\r\n    SVGForm.rect(this.cc, r);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.circle = function(ctx, c, fill, stroke) {\r\n    var elem;\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    elem = SVGSpace.svgElement(ctx.group, \"circle\", SVGForm.id(ctx));\r\n    if (!elem) {\r\n      return;\r\n    }\r\n    DOMSpace.attr(elem, {\r\n      cx: c.x,\r\n      cy: c.y,\r\n      r: c.radius\r\n    });\r\n    SVGForm.style(elem, ctx.style);\r\n    return elem;\r\n  };\r\n\r\n  SVGForm.prototype.circle = function(c) {\r\n    this.nextID();\r\n    SVGForm.circle(this.cc, c);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.polygon = function(ctx, pts, closePath, fill, stroke) {\r\n    var elem, i, points;\r\n    if (closePath == null) {\r\n      closePath = true;\r\n    }\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = true;\r\n    }\r\n    elem = SVGSpace.svgElement(ctx.group, (closePath ? \"polygon\" : \"polyline\"), SVGForm.id(ctx));\r\n    if (!elem) {\r\n      return;\r\n    }\r\n    if (pts.length <= 1) {\r\n      return;\r\n    }\r\n    points = (function() {\r\n      var aa, ref, results;\r\n      results = [];\r\n      for (i = aa = 0, ref = pts.length; aa < ref; i = aa += 1) {\r\n        results.push(pts[i].x + \",\" + pts[i].y);\r\n      }\r\n      return results;\r\n    })();\r\n    DOMSpace.attr(elem, {\r\n      points: points.join(\" \")\r\n    });\r\n    SVGForm.style(elem, ctx.style);\r\n    return elem;\r\n  };\r\n\r\n  SVGForm.prototype.polygon = function(ps, closePath) {\r\n    this.nextID();\r\n    SVGForm.polygon(this.cc, ps, closePath);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.triangle = function(ctx, tri, fill, stroke) {\r\n    if (fill == null) {\r\n      fill = true;\r\n    }\r\n    if (stroke == null) {\r\n      stroke = false;\r\n    }\r\n    return SVGForm.polygon(ctx, tri.toArray());\r\n  };\r\n\r\n  SVGForm.prototype.triangle = function(tri) {\r\n    this.nextID();\r\n    SVGForm.triangle(this.cc, tri);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.curve = function(ctx, pts, closePath) {\r\n    if (closePath == null) {\r\n      closePath = false;\r\n    }\r\n    return SVGForm.polygon(ctx, pts, closePath);\r\n  };\r\n\r\n  SVGForm.prototype.curve = function(ps, closePath) {\r\n    if (closePath == null) {\r\n      closePath = false;\r\n    }\r\n    this.nextID();\r\n    SVGForm.curve(this.cc, ps, closePath);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.text = function(ctx, pt, txt, maxWidth, dx, dy) {\r\n    var elem;\r\n    if (maxWidth == null) {\r\n      maxWidth = 0;\r\n    }\r\n    if (dx == null) {\r\n      dx = 0;\r\n    }\r\n    if (dy == null) {\r\n      dy = 0;\r\n    }\r\n    elem = SVGSpace.svgElement(ctx.group, \"text\", SVGForm.id(ctx));\r\n    if (!elem) {\r\n      return;\r\n    }\r\n    DOMSpace.attr(elem, {\r\n      \"pointer-events\": \"none\",\r\n      x: pt.x,\r\n      y: pt.y,\r\n      dx: 0,\r\n      dy: 0\r\n    });\r\n    elem.textContent = txt;\r\n    SVGForm.style(elem, {\r\n      fill: ctx.style.fill,\r\n      stroke: ctx.style.stroke,\r\n      \"font-family\": ctx.fontFace || false,\r\n      \"font-size\": ctx.fontSize || false\r\n    });\r\n    return elem;\r\n  };\r\n\r\n  SVGForm.prototype.text = function(p, txt, maxWidth, xoff, yoff) {\r\n    if (maxWidth == null) {\r\n      maxWidth = 1000;\r\n    }\r\n    this.nextID();\r\n    SVGForm.text(this.cc, p, txt, maxWidth, xoff, yoff);\r\n    return this;\r\n  };\r\n\r\n  SVGForm.prototype.font = function(size, face) {\r\n    if (face == null) {\r\n      face = false;\r\n    }\r\n    this.cc.fontFace = face;\r\n    this.cc.fontSize = size;\r\n    this.cc.font = size + \"px \" + face;\r\n    return this;\r\n  };\r\n\r\n  SVGForm.prototype.draw = function(shape) {\r\n    return this.sketch(shape);\r\n  };\r\n\r\n  SVGForm.prototype.sketch = function(shape) {\r\n    shape.floor();\r\n    if (shape instanceof Circle) {\r\n      SVGForm.circle(this.cc, shape, this.filled, this.stroked);\r\n    } else if (shape instanceof Rectangle) {\r\n      SVGForm.rect(this.cc, shape, this.filled, this.stroked);\r\n    } else if (shape instanceof Triangle) {\r\n      SVGForm.triangle(this.cc, shape, this.filled, this.stroked);\r\n    } else if (shape instanceof Line || shape instanceof Pair) {\r\n      SVGForm.line(this.cc, shape);\r\n    } else if (shape instanceof PointSet) {\r\n      SVGForm.polygon(this.cc, shape.points);\r\n    } else if (shape instanceof Vector || shape instanceof Point) {\r\n      SVGForm.point(this.cc, shape);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  return SVGForm;\r\n\r\n})();\r\n\r\nthis.SVGForm = SVGForm;\r\n\r\nSVGSpace = (function(superClass) {\r\n  extend(SVGSpace, superClass);\r\n\r\n  function SVGSpace(id, bgcolor, context) {\r\n    if (id == null) {\r\n      id = 'pt_space';\r\n    }\r\n    if (bgcolor == null) {\r\n      bgcolor = false;\r\n    }\r\n    if (context == null) {\r\n      context = 'svg';\r\n    }\r\n    SVGSpace.__super__.constructor.apply(this, arguments);\r\n    this.bg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\r\n    this.bg.setAttribute(\"id\", id + \"_bg\");\r\n    this.bg.setAttribute(\"fill\", bgcolor);\r\n    this.space.appendChild(this.bg);\r\n  }\r\n\r\n  SVGSpace.prototype._createSpaceElement = function() {\r\n    this.space = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    this.space.setAttribute(\"id\", this.id);\r\n    return this.appended = false;\r\n  };\r\n\r\n  SVGSpace.svgElement = function(parent, name, id) {\r\n    var elem;\r\n    if (!parent || !parent.appendChild) {\r\n      throw \"parent parameter needs to be a DOM node\";\r\n    }\r\n    elem = document.querySelector(\"#\" + id);\r\n    if (!elem) {\r\n      elem = document.createElementNS(\"http://www.w3.org/2000/svg\", name);\r\n      elem.setAttribute(\"id\", id);\r\n      elem.setAttribute(\"class\", id.substring(0, id.indexOf(\"-\")));\r\n      parent.appendChild(elem);\r\n    }\r\n    return elem;\r\n  };\r\n\r\n  SVGSpace.prototype.resize = function(w, h, evt) {\r\n    var k, p, ref;\r\n    this.size.set(w, h);\r\n    this.center = new Vector(w / 2, h / 2);\r\n    this.space.setAttribute(\"width\", w);\r\n    this.space.setAttribute(\"height\", h);\r\n    this.bg.setAttribute(\"width\", w);\r\n    this.bg.setAttribute(\"height\", h);\r\n    ref = this.items;\r\n    for (k in ref) {\r\n      p = ref[k];\r\n      if (p.onSpaceResize != null) {\r\n        p.onSpaceResize(w, h, evt);\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  SVGSpace.prototype.remove = function(item) {\r\n    var aa, len1, t, temp;\r\n    temp = this.space.querySelectorAll(\".\" + SVGForm._scopeID(item));\r\n    for (aa = 0, len1 = temp.length; aa < len1; aa++) {\r\n      t = temp[aa];\r\n      t.parentNode.removeChild(t);\r\n    }\r\n    delete this.items[item.animateID];\r\n    return this;\r\n  };\r\n\r\n  SVGSpace.prototype.removeAll = function() {\r\n    while (this.space.firstChild) {\r\n      this.space.removeChild(this.space.firstChild);\r\n      return this;\r\n    }\r\n  };\r\n\r\n  return SVGSpace;\r\n\r\n})(DOMSpace);\r\n\r\nthis.SVGSpace = SVGSpace;\r\n\r\nEasing = (function() {\r\n  function Easing() {}\r\n\r\n  Easing.linear = function(t, b, c, d) {\r\n    return c * (t /= d) + b;\r\n  };\r\n\r\n  Easing._linear = function(t) {\r\n    return Easing.linear(t, 0, 1, 1);\r\n  };\r\n\r\n  Easing.quadIn = function(t, b, c, d) {\r\n    return c * (t /= d) * t + b;\r\n  };\r\n\r\n  Easing._quadIn = function(t) {\r\n    return Easing.quadIn(t, 0, 1, 1);\r\n  };\r\n\r\n  Easing.quadOut = function(t, b, c, d) {\r\n    return -c * (t /= d) * (t - 2) + b;\r\n  };\r\n\r\n  Easing._quadOut = function(t) {\r\n    return Easing.quadOut(t, 0, 1, 1);\r\n  };\r\n\r\n  Easing.cubicIn = function(t, b, c, d) {\r\n    t = t / d;\r\n    return c * t * t * t + b;\r\n  };\r\n\r\n  Easing._cubicIn = function(t) {\r\n    return Easing.cubicIn(t, 0, 1, 1);\r\n  };\r\n\r\n  Easing.cubicOut = function(t, b, c, d) {\r\n    t = t / d;\r\n    return c * ((t - 1) * t * t + 1) + b;\r\n  };\r\n\r\n  Easing._cubicOut = function(t) {\r\n    return Easing.cubicOut(t, 0, 1, 1);\r\n  };\r\n\r\n  Easing.elastic = function(t, b, c, d, el) {\r\n    var a, p, s;\r\n    if (el == null) {\r\n      el = 0.3;\r\n    }\r\n    s = 1.70158;\r\n    p = d * el;\r\n    a = c;\r\n    if (t === 0) {\r\n      return b;\r\n    }\r\n    t = t / d;\r\n    if (t === 1) {\r\n      return b + c;\r\n    }\r\n    if (a < Math.abs(c)) {\r\n      a = c;\r\n      s = p / 4;\r\n    } else if (a !== 0) {\r\n      s = p / Const.two_pi * Math.asin(c / a);\r\n    } else {\r\n      s = 0;\r\n    }\r\n    return a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * Const.two_pi / p) + c + b;\r\n  };\r\n\r\n  Easing._elastic = function(t) {\r\n    return Easing.elastic(t, 0, 1, 1);\r\n  };\r\n\r\n  Easing.bounce = function(t, b, c, d) {\r\n    if ((t /= d) < (1 / 2.75)) {\r\n      return c * (7.5625 * t * t) + b;\r\n    } else if (t < (2 / 2.75)) {\r\n      return c * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75) + b;\r\n    } else if (t < (2.5 / 2.75)) {\r\n      return c * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375) + b;\r\n    } else {\r\n      return c * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375) + b;\r\n    }\r\n  };\r\n\r\n  Easing._bounce = function(t) {\r\n    return Easing.bounce(t, 0, 1, 1);\r\n  };\r\n\r\n  return Easing;\r\n\r\n})();\r\n\r\nthis.Easing = Easing;\r\n\r\nGridCascade = (function(superClass) {\r\n  extend(GridCascade, superClass);\r\n\r\n  function GridCascade() {\r\n    GridCascade.__super__.constructor.apply(this, arguments);\r\n    this.startRow = 0;\r\n  }\r\n\r\n  GridCascade.prototype.resetLayout = function() {\r\n    this.layout = [];\r\n    return this.startRow = 0;\r\n  };\r\n\r\n  GridCascade.prototype.occupy = function(x, y, w, h) {\r\n    var aa, ab, c, r, ref, ref1, ref2, ref3;\r\n    for (c = aa = ref = x, ref1 = w + x; ref <= ref1 ? aa < ref1 : aa > ref1; c = ref <= ref1 ? ++aa : --aa) {\r\n      for (r = ab = ref2 = y, ref3 = h + y; ref2 <= ref3 ? ab < ref3 : ab > ref3; r = ref2 <= ref3 ? ++ab : --ab) {\r\n        if (this.layout[r] == null) {\r\n          this.layout[r] = [];\r\n        }\r\n        this.layout[r][c] = 1;\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n\r\n  GridCascade.prototype.findStartRow = function() {\r\n    var aa, ab, c, index, r, ref, ref1, ref2;\r\n    index = this.startRow;\r\n    for (r = aa = ref = this.startRow, ref1 = this.rows; ref <= ref1 ? aa < ref1 : aa > ref1; r = ref <= ref1 ? ++aa : --aa) {\r\n      index = r;\r\n      for (c = ab = 0, ref2 = this.columns; 0 <= ref2 ? ab < ref2 : ab > ref2; c = 0 <= ref2 ? ++ab : --ab) {\r\n        if (this.layout[r] != null) {\r\n          if ((this.layout[r][c] == null) || this.layout[r][c] <= 0) {\r\n            return index;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return index;\r\n  };\r\n\r\n  GridCascade.prototype.fit = function(cols, rows) {\r\n    var aa, ab, ac, allRowsFree, b, cell, colCount, colSize, currCol, currRow, freeCol, rc, ref, ref1, ref2, ref3, ref4;\r\n    colSize = Math.min(cols, this.columns);\r\n    for (currRow = aa = ref = this.startRow, ref1 = this.rows; ref <= ref1 ? aa < ref1 : aa > ref1; currRow = ref <= ref1 ? ++aa : --aa) {\r\n      colCount = colSize;\r\n      freeCol = 0;\r\n      if (currRow + rows >= this.rows) {\r\n        this.rows += rows;\r\n      }\r\n      if (this.layout[currRow] == null) {\r\n        this.layout[currRow] = [];\r\n      }\r\n      for (currCol = ab = 0, ref2 = this.columns; 0 <= ref2 ? ab < ref2 : ab > ref2; currCol = 0 <= ref2 ? ++ab : --ab) {\r\n        cell = this.layout[currRow][currCol];\r\n        if ((cell != null) && cell > 0) {\r\n          freeCol = currCol + 1;\r\n          colCount = colSize;\r\n        } else {\r\n          colCount--;\r\n          if (colCount === 0) {\r\n            allRowsFree = true;\r\n            if (rows > 1) {\r\n              for (rc = ac = ref3 = currRow, ref4 = currRow + rows; ref3 <= ref4 ? ac < ref4 : ac > ref4; rc = ref3 <= ref4 ? ++ac : --ac) {\r\n                if (rc <= this.rows && (this.layout[rc] != null) && this.layout[rc][freeCol] > 0) {\r\n                  allRowsFree = false;\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n            if (allRowsFree) {\r\n              this.occupy(freeCol, currRow, colSize, rows);\r\n              if (currRow > this.startRow) {\r\n                this.startRow = this.findStartRow();\r\n              }\r\n              b = new Rectangle(this.$add(this.cell.size.$multiply(freeCol, currRow)));\r\n              b.resizeTo(this.cell.size.$multiply(colSize, rows));\r\n              return {\r\n                row: currRow,\r\n                column: freeCol,\r\n                columnSize: colSize,\r\n                rowSize: rows,\r\n                bound: b\r\n              };\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    console.error(\"cannot fit \" + currRow + \" \" + freeCol + \" \" + cols + \" \" + rows);\r\n    return false;\r\n  };\r\n\r\n  return GridCascade;\r\n\r\n})(Grid);\r\n\r\nthis.GridCascade = GridCascade;\r\n\r\nParticleEmitter = (function(superClass) {\r\n  extend(ParticleEmitter, superClass);\r\n\r\n  function ParticleEmitter() {\r\n    ParticleEmitter.__super__.constructor.apply(this, arguments);\r\n    this.system = null;\r\n    this.lastTime = 0;\r\n    this.period = 0;\r\n    this.animateID = -1;\r\n  }\r\n\r\n  ParticleEmitter.prototype.init = function(system) {\r\n    return this.system = system;\r\n  };\r\n\r\n  ParticleEmitter.prototype.frequency = function(f) {\r\n    this.period = 1000 / f;\r\n    return this;\r\n  };\r\n\r\n  ParticleEmitter.prototype.emit = function() {};\r\n\r\n  ParticleEmitter.prototype.animate = function(time, frame, ctx) {\r\n    if (time - this.lastTime > this.period) {\r\n      this.emit();\r\n      return this.lastTime = time;\r\n    }\r\n  };\r\n\r\n  return ParticleEmitter;\r\n\r\n})(Vector);\r\n\r\nthis.ParticleEmitter = ParticleEmitter;\r\n\r\nParticleField = (function(superClass) {\r\n  extend(ParticleField, superClass);\r\n\r\n  function ParticleField() {\r\n    ParticleField.__super__.constructor.apply(this, arguments);\r\n    this.system = void 0;\r\n  }\r\n\r\n  ParticleField.prototype.check = function(particles, removal) {\r\n    var aa, len1, p, temp;\r\n    if (removal == null) {\r\n      removal = false;\r\n    }\r\n    temp = [];\r\n    for (aa = 0, len1 = particles.length; aa < len1; aa++) {\r\n      p = particles[aa];\r\n      if (this.hasIntersect(p)) {\r\n        this.work(p);\r\n      } else {\r\n        temp.push(p);\r\n      }\r\n    }\r\n    return (removal ? temp : particles);\r\n  };\r\n\r\n  ParticleField.prototype.work = function(p) {};\r\n\r\n  return ParticleField;\r\n\r\n})(Rectangle);\r\n\r\nthis.ParticleField = ParticleField;\r\n\r\nQuadTree = (function(superClass) {\r\n  extend(QuadTree, superClass);\r\n\r\n  function QuadTree() {\r\n    QuadTree.__super__.constructor.apply(this, arguments);\r\n    this.quads = false;\r\n    this.items = [];\r\n    this.depth = 0;\r\n    this.max_depth = 6;\r\n    this.max_items = 2;\r\n  }\r\n\r\n  QuadTree.prototype.getQuads = function(p, list) {\r\n    var k, q, ref;\r\n    if (list == null) {\r\n      list = [];\r\n    }\r\n    if (this.intersectPoint(p)) {\r\n      list.push(this);\r\n      if (this.quads) {\r\n        ref = this.quads;\r\n        for (k in ref) {\r\n          q = ref[k];\r\n          if (q.intersectPoint(p)) {\r\n            q.getQuads(p, list);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return list;\r\n  };\r\n\r\n  QuadTree.prototype.getItems = function(p) {\r\n    var k, q, ref;\r\n    if (this.intersectPoint(p)) {\r\n      if (!this.quads) {\r\n        return this.items;\r\n      }\r\n      if (this.quads) {\r\n        ref = this.quads;\r\n        for (k in ref) {\r\n          q = ref[k];\r\n          if (q.intersectPoint(p)) {\r\n            return q.getItems(p);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return [];\r\n  };\r\n\r\n  QuadTree.prototype.addToQuad = function(item) {\r\n    var _depth, k, q, ref;\r\n    if (!item) {\r\n      return -1;\r\n    }\r\n    if (this.quads) {\r\n      ref = this.quads;\r\n      for (k in ref) {\r\n        q = ref[k];\r\n        _depth = q.addToQuad(item);\r\n        if (_depth > 0) {\r\n          return _depth;\r\n        }\r\n      }\r\n      return -1;\r\n    }\r\n    if (!this.quads && this.intersectPoint(item)) {\r\n      if (this.items.length >= this.max_items) {\r\n        if (this.depth < this.max_depth) {\r\n          this.splitQuad();\r\n          return this.addToQuad(item);\r\n        } else {\r\n          return -1;\r\n        }\r\n      } else {\r\n        this.items.push(item);\r\n        return this.depth;\r\n      }\r\n    }\r\n    return -1;\r\n  };\r\n\r\n  QuadTree.prototype.splitQuad = function() {\r\n    var _depth, aa, ab, i, item, k, len1, len2, q, ref, ref1, ref2, results, t;\r\n    this.quads = this.quadrants();\r\n    ref = this.quads;\r\n    for (k in ref) {\r\n      q = ref[k];\r\n      q.depth = this.depth + 1;\r\n    }\r\n    ref1 = this.items;\r\n    for (i = aa = 0, len1 = ref1.length; aa < len1; i = ++aa) {\r\n      item = ref1[i];\r\n      _depth = this.addToQuad(item);\r\n      if (_depth > this.depth) {\r\n        this.items[i] = null;\r\n      }\r\n    }\r\n    ref2 = this.items;\r\n    results = [];\r\n    for (ab = 0, len2 = ref2.length; ab < len2; ab++) {\r\n      t = ref2[ab];\r\n      if (!t) {\r\n        results.push(this.items.splice(t, 1));\r\n      } else {\r\n        results.push(void 0);\r\n      }\r\n    }\r\n    return results;\r\n  };\r\n\r\n  QuadTree.prototype.resetQuad = function() {\r\n    var k, q, ref;\r\n    this.items = [];\r\n    if (this.quads) {\r\n      ref = this.quads;\r\n      for (k in ref) {\r\n        q = ref[k];\r\n        q.resetQuad();\r\n      }\r\n      return this.quads = false;\r\n    }\r\n  };\r\n\r\n  return QuadTree;\r\n\r\n})(Rectangle);\r\n\r\nthis.QuadTree = QuadTree;\r\n\r\nSamplePoints = (function(superClass) {\r\n  extend(SamplePoints, superClass);\r\n\r\n  function SamplePoints() {\r\n    SamplePoints.__super__.constructor.apply(this, arguments);\r\n    this.bestcandidate = null;\r\n    this.poisson = null;\r\n    this.bound = null;\r\n    this.boundsize = null;\r\n  }\r\n\r\n  SamplePoints.prototype.setBounds = function(b, anchor) {\r\n    if (anchor == null) {\r\n      anchor = false;\r\n    }\r\n    if (anchor) {\r\n      this.set(b);\r\n    }\r\n    this.bound = new Rectangle(this).size(b.size());\r\n    return this;\r\n  };\r\n\r\n  SamplePoints.prototype.bestCandidateSampler = function() {\r\n    this.points = [];\r\n    if (!this.bound) {\r\n      this.bound = new Rectangle().size(500, 500);\r\n    }\r\n    this.boundsize = this.bound.size();\r\n    this.bestcandidate = {\r\n      halfsize: this.boundsize.$divide(2),\r\n      quartersize: this.boundsize.$divide(4),\r\n      maxDist: this.boundsize.x * this.boundsize.x + this.boundsize.y * this.boundsize.y\r\n    };\r\n    return this;\r\n  };\r\n\r\n  SamplePoints.prototype.poissonSampler = function(radius) {\r\n    var cellsize;\r\n    this.points = [];\r\n    if (!this.bound) {\r\n      this.bound = new Rectangle().size(500, 500);\r\n    }\r\n    this.boundsize = this.bound.size();\r\n    cellsize = radius * Math.SQRT1_2;\r\n    this.poisson = {\r\n      grid: [],\r\n      gridWidth: Math.ceil(this.boundsize.x / cellsize),\r\n      gridHeight: Math.ceil(this.boundsize.y / cellsize),\r\n      cellSize: cellsize,\r\n      radius: radius,\r\n      radius2: radius * radius,\r\n      R: 3 * radius * radius,\r\n      queue: [],\r\n      queueSize: 0,\r\n      sampleSize: 0,\r\n      sincos: Util.sinCosTable()\r\n    };\r\n    return this;\r\n  };\r\n\r\n  SamplePoints.prototype.sample = function(numSamples, type) {\r\n    var a, aa, ab, best, bestDist, i, j, nearest, p, r, ref, ref1, s, x, y;\r\n    if (numSamples == null) {\r\n      numSamples = 10;\r\n    }\r\n    if (type == null) {\r\n      type = false;\r\n    }\r\n    if (this.poisson && type === 'poisson') {\r\n      if (this.poisson.sampleSize > 0 && this.poisson.queueSize === 0) {\r\n        return false;\r\n      }\r\n      if (!this.poisson.sampleSize) {\r\n        return this._poissonSample(this.bound.x + this.boundsize.x / 2, this.bound.y + this.boundsize.y / 2);\r\n      }\r\n      while (this.poisson.queueSize) {\r\n        i = Math.floor(Math.random() * this.poisson.queueSize);\r\n        s = this.poisson.queue[i];\r\n        for (j = aa = 0, ref = numSamples; aa < ref; j = aa += 1) {\r\n          a = Math.floor(360 * Math.random());\r\n          r = Math.sqrt(Math.random() * this.poisson.R + this.poisson.radius2);\r\n          x = s.x + r * this.poisson.sincos.cos[a];\r\n          y = s.y + r * this.poisson.sincos.sin[a];\r\n          if (x >= this.bound.x && x < this.boundsize.x && y >= this.bound.y && y < this.boundsize.y && this._poissonCheck(x, y)) {\r\n            return this._poissonSample(x, y);\r\n          }\r\n        }\r\n        this.poisson.queue[i] = this.poisson.queue[--this.poisson.queueSize];\r\n        this.poisson.queue.length = this.poisson.queueSize;\r\n      }\r\n      return true;\r\n    } else if (this.bestcandidate) {\r\n      best = null;\r\n      bestDist = -1;\r\n      for (i = ab = 0, ref1 = numSamples; ab < ref1; i = ab += 1) {\r\n        p = new Vector(this.bound.x + this.boundsize.x * Math.random(), this.bound.y + this.boundsize.y * Math.random());\r\n        if (this.points.length === 0) {\r\n          best = p;\r\n          break;\r\n        } else {\r\n          nearest = this._bestCandidateCheck(p);\r\n          if (nearest > bestDist) {\r\n            best = p;\r\n            bestDist = nearest;\r\n          }\r\n        }\r\n      }\r\n      if (best) {\r\n        this.points.push(best);\r\n      }\r\n      return best;\r\n    }\r\n  };\r\n\r\n  SamplePoints.prototype._bestCandidateCheck = function(p) {\r\n    var _dist, aa, dist, dx, dy, halfbound, it, len1, matches, w;\r\n    _dist = this.bestcandidate.maxDist;\r\n    halfbound = new Rectangle(p.x - this.bestcandidate.quartersize.x, p.y - this.bestcandidate.quartersize.y).size(this.bestcandidate.halfsize.x, this.bestcandidate.halfsize.y);\r\n    matches = (function() {\r\n      var aa, len1, ref, results;\r\n      ref = this.points;\r\n      results = [];\r\n      for (aa = 0, len1 = ref.length; aa < len1; aa++) {\r\n        it = ref[aa];\r\n        if (halfbound.intersectPoint(it)) {\r\n          results.push(it);\r\n        }\r\n      }\r\n      return results;\r\n    }).call(this);\r\n    for (aa = 0, len1 = matches.length; aa < len1; aa++) {\r\n      w = matches[aa];\r\n      dx = w.x - p.x;\r\n      dy = w.y - p.y;\r\n      dist = dx * dx + dy * dy;\r\n      if (dist < _dist) {\r\n        _dist = dist;\r\n      }\r\n    }\r\n    return _dist;\r\n  };\r\n\r\n  SamplePoints.prototype._poissonSample = function(x, y) {\r\n    var s;\r\n    s = new Point(x, y);\r\n    this.poisson.queue.push(s);\r\n    this.poisson.grid[this.poisson.gridWidth * (y / this.poisson.cellSize | 0) + (x / this.poisson.cellSize | 0)] = s;\r\n    this.poisson.sampleSize++;\r\n    this.poisson.queueSize++;\r\n    return s;\r\n  };\r\n\r\n  SamplePoints.prototype._poissonCheck = function(x, y) {\r\n    var aa, ab, dx, dy, i, i0, i1, j, j0, j1, o, ref, ref1, ref2, ref3, s;\r\n    i = Math.floor(x / this.poisson.cellSize);\r\n    j = Math.floor(y / this.poisson.cellSize);\r\n    i0 = Math.max(i - 2, 0);\r\n    j0 = Math.max(j - 2, 0);\r\n    i1 = Math.min(i + 3, this.poisson.gridWidth);\r\n    j1 = Math.min(j + 3, this.poisson.gridHeight);\r\n    for (j = aa = ref = j0, ref1 = j1; aa < ref1; j = aa += 1) {\r\n      o = j * this.poisson.gridWidth;\r\n      for (i = ab = ref2 = i0, ref3 = i1; ab < ref3; i = ab += 1) {\r\n        s = this.poisson.grid[o + i];\r\n        if (s) {\r\n          dx = s.x - x;\r\n          dy = s.y - y;\r\n          if (dx * dx + dy * dy < this.poisson.radius2) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  SamplePoints.bestCandidate = function(bound, items, samples) {\r\n    var _nearest, aa, best, bestDist, halfsize, i, maxDist, nearest, p, quartersize, ref, size;\r\n    if (samples == null) {\r\n      samples = 10;\r\n    }\r\n    size = bound.size();\r\n    halfsize = size.$divide(2);\r\n    quartersize = size.$divide(4);\r\n    maxDist = size.x * size.x + size.y * size.y;\r\n    _nearest = function(p) {\r\n      var _dist, aa, dist, dx, dy, halfbound, it, len1, matches, w;\r\n      _dist = maxDist;\r\n      halfbound = new Rectangle(p.x - quartersize.x, p.y - quartersize.y).size(halfsize.x, halfsize.y);\r\n      matches = (function() {\r\n        var aa, len1, results;\r\n        results = [];\r\n        for (aa = 0, len1 = items.length; aa < len1; aa++) {\r\n          it = items[aa];\r\n          if (halfbound.intersetPoint(it)) {\r\n            results.push(it);\r\n          }\r\n        }\r\n        return results;\r\n      })();\r\n      for (aa = 0, len1 = matches.length; aa < len1; aa++) {\r\n        w = matches[aa];\r\n        dx = w.x - p.x;\r\n        dy = w.y - p.y;\r\n        dist = dx * dx + dy * dy;\r\n        if (dist < _dist) {\r\n          _dist = dist;\r\n        }\r\n      }\r\n      return _dist;\r\n    };\r\n    best = null;\r\n    bestDist = -1;\r\n    for (i = aa = 0, ref = samples; 0 <= ref ? aa < ref : aa > ref; i = 0 <= ref ? ++aa : --aa) {\r\n      p = new Vector(bound.x + size.x * Math.random(), bound.y + size.y * Math.random());\r\n      if (items.length === 0) {\r\n        return p;\r\n      } else {\r\n        nearest = _nearest(p);\r\n        if (nearest > bestDist) {\r\n          best = p;\r\n          bestDist = nearest;\r\n        }\r\n      }\r\n    }\r\n    return best;\r\n  };\r\n\r\n  return SamplePoints;\r\n\r\n})(PointSet);\r\n\r\nthis.SamplePoints = SamplePoints;\r\n\r\nStripeBound = (function(superClass) {\r\n  extend(StripeBound, superClass);\r\n\r\n  function StripeBound() {\r\n    StripeBound.__super__.constructor.apply(this, arguments);\r\n    this.frequency = new Point();\r\n    this.stripes = new Point();\r\n    this.method = 'frequency';\r\n    this.mask = null;\r\n  }\r\n\r\n  StripeBound.prototype.setFrequency = function(x, y) {\r\n    this.frequency = new Vector(x, y);\r\n    return this.method = 'frequency';\r\n  };\r\n\r\n  StripeBound.prototype.setStripes = function(x, y) {\r\n    this.stripes = new Point(x, y);\r\n    return this.method = 'stripes';\r\n  };\r\n\r\n  StripeBound.prototype.getStripes = function() {\r\n    var aa, ab, d, diff, dx, dy, freq, p, ref, ref1, result, size;\r\n    size = this.size();\r\n    result = {\r\n      columns: [],\r\n      rows: []\r\n    };\r\n    freq = this.method === 'frequency' ? this.frequency.clone() : size.$divide(this.stripes).floor();\r\n    diff = size.$divide(freq);\r\n    for (d = aa = 0, ref = freq.y - 1; 0 <= ref ? aa <= ref : aa >= ref; d = 0 <= ref ? ++aa : --aa) {\r\n      dy = diff.y * d;\r\n      p = new Pair(0, dy).to(size.x, dy + diff.y).add(this);\r\n      p.p1.add(this);\r\n      result.rows.push(p);\r\n    }\r\n    for (d = ab = 0, ref1 = freq.x - 1; 0 <= ref1 ? ab <= ref1 : ab >= ref1; d = 0 <= ref1 ? ++ab : --ab) {\r\n      dx = diff.x * d;\r\n      p = new Pair(dx, 0).to(dx + diff.x + 0.5, size.y).add(this);\r\n      p.p1.add(this);\r\n      result.columns.push(p);\r\n    }\r\n    return result;\r\n  };\r\n\r\n  StripeBound.prototype.getStripeLines = function() {\r\n    var aa, ab, d, diff, dx, dy, freq, p, ref, ref1, result, size;\r\n    size = this.size();\r\n    result = {\r\n      columns: [],\r\n      rows: []\r\n    };\r\n    freq = this.method === 'frequency' ? this.frequency.clone() : size.$divide(this.stripes).floor();\r\n    diff = size.$divide(freq);\r\n    for (d = aa = 0, ref = freq.y; 0 <= ref ? aa <= ref : aa >= ref; d = 0 <= ref ? ++aa : --aa) {\r\n      dy = diff.y * d;\r\n      p = new Pair(0, dy).to(size.x, dy).add(this);\r\n      p.p1.add(this);\r\n      result.rows.push(p);\r\n    }\r\n    for (d = ab = 0, ref1 = freq.x; 0 <= ref1 ? ab <= ref1 : ab >= ref1; d = 0 <= ref1 ? ++ab : --ab) {\r\n      dx = diff.x * d;\r\n      p = new Pair(dx, 0).to(dx, size.y).add(this);\r\n      p.p1.add(this);\r\n      result.columns.push(p);\r\n    }\r\n    return result;\r\n  };\r\n\r\n  StripeBound.prototype.setMask = function(w, h, anchor) {\r\n    var diff, sz;\r\n    if (anchor == null) {\r\n      anchor = false;\r\n    }\r\n    this.mask = new Rectangle(this.x, this.y);\r\n    sz = this.size();\r\n    if (!anchor) {\r\n      diff = sz.$subtract(w, h).divide(2);\r\n      anchor = new Point(this.x + diff.x, this.y + diff.y);\r\n    } else {\r\n      anchor = this.$add(anchor);\r\n    }\r\n    return this.mask.set(anchor.x, anchor.y).size(w, h);\r\n  };\r\n\r\n  StripeBound.prototype.anchorMask = function() {\r\n    var d;\r\n    d = this.$subtract(this.mask);\r\n    this.moveBy(d);\r\n    return this.mask.moveBy(d);\r\n  };\r\n\r\n  return StripeBound;\r\n\r\n})(Rectangle);\r\n\r\nthis.StripeBound = StripeBound;\r\n\r\nUI = (function(superClass) {\r\n  extend(UI, superClass);\r\n\r\n  UI.dragTarget = null;\r\n\r\n  function UI() {\r\n    UI.__super__.constructor.apply(this, arguments);\r\n    this.dragging = false;\r\n  }\r\n\r\n  UI.prototype.animate = function(time, frame, ctx) {\r\n    ctx.fillStyle = '#f00';\r\n    return Form.rect(ctx, this);\r\n  };\r\n\r\n  UI.prototype.onMouseAction = function(type, x, y, evt) {\r\n    if (this.intersectPoint(x, y)) {\r\n      if (type === 'drag' && !UI.dragTarget) {\r\n        this.dragging = true;\r\n        UI.dragTarget = this;\r\n      }\r\n    }\r\n    if (this.dragging && type === 'move') {\r\n      this.moveTo(x, y).moveBy(this.size().multiply(-0.5));\r\n    }\r\n    if (type === 'drop') {\r\n      this.dragging = false;\r\n      return UI.dragTarget = null;\r\n    }\r\n  };\r\n\r\n  return UI;\r\n\r\n})(Rectangle);\r\n\r\nthis.UI = UI;\r\n\r\nNoise = (function(superClass) {\r\n  extend(Noise, superClass);\r\n\r\n  Noise.prototype.grad3 = [[1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0], [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1], [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]];\r\n\r\n  Noise.prototype.simplex = [[0, 1, 2, 3], [0, 1, 3, 2], [0, 0, 0, 0], [0, 2, 3, 1], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [1, 2, 3, 0], [0, 2, 1, 3], [0, 0, 0, 0], [0, 3, 1, 2], [0, 3, 2, 1], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [1, 3, 2, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [1, 2, 0, 3], [0, 0, 0, 0], [1, 3, 0, 2], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [2, 3, 0, 1], [2, 3, 1, 0], [1, 0, 2, 3], [1, 0, 3, 2], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [2, 0, 3, 1], [0, 0, 0, 0], [2, 1, 3, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [2, 0, 1, 3], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [3, 0, 1, 2], [3, 0, 2, 1], [0, 0, 0, 0], [3, 1, 2, 0], [2, 1, 0, 3], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [3, 1, 0, 2], [0, 0, 0, 0], [3, 2, 0, 1], [3, 2, 1, 0]];\r\n\r\n  function Noise() {\r\n    var i;\r\n    Noise.__super__.constructor.apply(this, arguments);\r\n    this.p = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 9, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];\r\n    this.perm = (function() {\r\n      var aa, results;\r\n      results = [];\r\n      for (i = aa = 0; aa < 512; i = ++aa) {\r\n        results.push(this.p[i & 255]);\r\n      }\r\n      return results;\r\n    }).call(this);\r\n  }\r\n\r\n  Noise.prototype.seed = function(seed) {\r\n    var aa, i, results, v;\r\n    if (seed > 0 && seed < 1) {\r\n      seed *= 65536;\r\n    }\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n      seed |= seed << 8;\r\n    }\r\n    results = [];\r\n    for (i = aa = 0; aa <= 255; i = ++aa) {\r\n      v = i & 1 ? this.p[i] ^ (seed & 255) : this.p[i] ^ ((seed >> 8) & 255);\r\n      results.push(this.perm[i] = this.perm[i + 256] = v);\r\n    }\r\n    return results;\r\n  };\r\n\r\n  Noise.prototype._dot = function(g, x, y) {\r\n    return g[0] * x + g[1] * y;\r\n  };\r\n\r\n  Noise.prototype.perlin2d = function(xin, yin) {\r\n    var _fade, i, j, n00, n01, n10, n11, tx, x, y;\r\n    if (xin == null) {\r\n      xin = this.x;\r\n    }\r\n    if (yin == null) {\r\n      yin = this.y;\r\n    }\r\n    _fade = function(f) {\r\n      return f * f * f * (f * (f * 6 - 15) + 10);\r\n    };\r\n    i = Math.floor(xin) % 255;\r\n    j = Math.floor(yin) % 255;\r\n    x = xin - i;\r\n    y = yin - j;\r\n    n00 = this._dot(this.grad3[(i + this.perm[j]) % 12], x, y);\r\n    n01 = this._dot(this.grad3[(i + this.perm[j + 1]) % 12], x, y - 1);\r\n    n10 = this._dot(this.grad3[(i + 1 + this.perm[j]) % 12], x - 1, y);\r\n    n11 = this._dot(this.grad3[(i + 1 + this.perm[j + 1]) % 12], x - 1, y - 1);\r\n    tx = _fade(x);\r\n    return Util.lerp(Util.lerp(n00, n10, tx), Util.lerp(n01, n11, tx), _fade(y));\r\n  };\r\n\r\n  Noise.prototype.simplex2d = function(xin, yin) {\r\n    var F2, G2, X0, Y0, gi0, gi1, gi2, i, i1, ii, j, j1, jj, n0, n1, n2, s, t, t0, t1, t2, x0, x1, x2, y0, y1, y2;\r\n    if (xin == null) {\r\n      xin = this.x;\r\n    }\r\n    if (yin == null) {\r\n      yin = this.y;\r\n    }\r\n    F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\r\n    s = (xin + yin) * F2;\r\n    i = Math.floor(xin + s);\r\n    j = Math.floor(yin + s);\r\n    G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\r\n    t = (i + j) * G2;\r\n    X0 = i - t;\r\n    Y0 = j - t;\r\n    x0 = xin - X0;\r\n    y0 = yin - Y0;\r\n    if (x0 > y0) {\r\n      i1 = 1;\r\n      j1 = 0;\r\n    } else {\r\n      i1 = 0;\r\n      j1 = 1;\r\n    }\r\n    x1 = x0 - i1 + G2;\r\n    y1 = y0 - j1 + G2;\r\n    x2 = x0 - 1.0 + 2.0 * G2;\r\n    y2 = y0 - 1.0 + 2.0 * G2;\r\n    ii = i & 255;\r\n    jj = j & 255;\r\n    gi0 = this.perm[ii + this.perm[jj]] % 12;\r\n    gi1 = this.perm[ii + i1 + this.perm[jj + j1]] % 12;\r\n    gi2 = this.perm[ii + 1 + this.perm[jj + 1]] % 12;\r\n    t0 = 0.5 - x0 * x0 - y0 * y0;\r\n    if (t0 < 0) {\r\n      n0 = 0.0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * this._dot(this.grad3[gi0], x0, y0);\r\n    }\r\n    t1 = 0.5 - x1 * x1 - y1 * y1;\r\n    if (t1 < 0) {\r\n      n1 = 0.0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * this._dot(this.grad3[gi1], x1, y1);\r\n    }\r\n    t2 = 0.5 - x2 * x2 - y2 * y2;\r\n    if (t2 < 0) {\r\n      n2 = 0.0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * this._dot(this.grad3[gi2], x2, y2);\r\n    }\r\n    return 70.0 * (n0 + n1 + n2);\r\n  };\r\n\r\n  return Noise;\r\n\r\n})(Vector);\r\n\r\n//# sourceMappingURL=pt.js.map\r\n}).call(Pt); module.exports = Pt;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/ptjs/dist/module/pt.js\n ** module id = 66\n ** module chunks = 0\n **/","import ColorfulTriangle from './ColorfulTriangle.js'\nimport Force from './Force.js'\nimport ColorfulPoint from './ColorfulPoint.js'\nimport {Vector} from 'ptjs'\n\nclass PointsMatrix {\n    constructor(width,\n                height,\n                step,\n                baseColor,\n                colorInterpolationMode,\n                forceField,\n                offsetX){\n        this._matrix = this.generateMatrix( width,\n                                            height,\n                                            step,\n                                            colorInterpolationMode,\n                                            forceField,\n                                            offsetX);\n        this._colorInterpolationMode = colorInterpolationMode;\n        this._baseColor = baseColor;\n    }\n\n    generateMatrix(width, height, step, colorInterpolationMode, forceField, offsetX){\n        var forces = forceField.getForces();\n        this._forces = forces;\n        var matrix = [];\n        for(let x=0; x<=Math.ceil((width+(4*step))/step); x++){\n            var column = [];\n            for(let y=0; y<=Math.ceil(height/step); y++){\n                var xCoord = x*step + (offsetX%step*2 - step*2);\n                var yCoord = y*step + (x%2)*step/2;\n                var {newX, newY, colorSum} = this._applyForcesToPoint(\n                    xCoord,\n                    yCoord,\n                    forces,\n                    colorInterpolationMode);\n                column.push(new ColorfulPoint(newX, newY, colorSum));\n            }\n            matrix.push(column);\n        }\n        return matrix;\n    }\n\n    _applyForcesToPoint(x, y, forces, colorInterpolationMode){\n        var vectorsXSum = 0;\n        var vectorsYSum = 0;\n        var colorSum = [0, 0, 0, 0];\n        for(var i in forces){\n            var {forceX, forceY, color} = forces[i].getForceAtPoint(x, y);\n            if(forces[i].influencePosition){\n                vectorsXSum += forces[i].axis == \"y\" ? 0 : forceX;\n                vectorsYSum += forces[i].axis == \"x\" ? 0 : forceY;                \n            }\n            \n            if(forces[i].influenceColor){\n                var colorInterpolationFunction;\n                switch(colorInterpolationMode){\n                    case \"subtraction\":\n                        colorInterpolationFunction = (currentCoord, i) => currentCoord - color[i];\n                        break;                    \n                    default:\n                        colorInterpolationFunction = (currentCoord, i) => currentCoord + color[i];\n                        break;\n                }\n                colorSum = colorSum.map(colorInterpolationFunction);\n            }\n        }\n\n        var newX = x + vectorsXSum;\n        var newY = y + vectorsYSum;\n        return {newX, newY, colorSum};\n    }\n\n    getMatrix(){\n        return this._matrix;\n    }\n\n    getFlattenedMatrix(){\n        var result = [];\n        for(let i in this._matrix){\n            result = result.concat(this._matrix[i]);\n        }\n        return result;\n    }\n\n    getTriangle(anchor, pointA, pointB){\n        var anchorPoint = this._matrix[anchor[0]] ? this._matrix[anchor[0]][anchor[1]] : undefined;\n        var nextColPoint = this._matrix[pointA[0]] ? this._matrix[pointA[0]][pointA[1]] : undefined;\n        var nextRowPoint = this._matrix[pointB[0]] ? this._matrix[pointB[0]][pointB[1]] : undefined;\n        \n        if(!anchorPoint || !nextColPoint || !nextRowPoint) return;\n        else return new ColorfulTriangle(anchorPoint,\n                                         nextColPoint,\n                                         nextRowPoint,\n                                         this._colorInterpolationMode,\n                                         this._baseColor);\n    }\n\n    getTiles(pattern, padding){\n        var tiles = [];\n        for(let col=padding[3]; col < this._matrix.length-1-padding[1]; col ++){\n            let even = !(col%2);\n            for(let row=padding[0]; row < this._matrix[col].length-1-padding[2]; row ++){\n                if(!even){\n                    for(var t in pattern){\n                        var points = pattern[t];\n                        if(points.length == 3){\n                            var result = this.getTriangle(\n                                [col+points[0][0], row+points[0][1]],\n                                [col+points[1][0], row+points[1][1]],\n                                [col+points[2][0], row+points[2][1]]);\n                            if(result)\n                                tiles.push(result);\n                        }\n                    }\n                }\n            }\n        }\n        return tiles;\n    }\n\n}\n\nexport default PointsMatrix;\n\n\n/** WEBPACK FOOTER **\n ** ./src/PointsMatrix.js\n **/","import {Triangle, Vector} from 'ptjs'\n\nclass ColorfulTriangle{\n    constructor(anchorPoint, nextColPoint, nextRowPoint, colorInterpolationMode, baseColor){\n        this.concept = new Triangle(anchorPoint.concept)\n                            .to(nextColPoint.concept, nextRowPoint.concept);\n        this.color = this.getColor([anchorPoint, nextColPoint, nextRowPoint], colorInterpolationMode, baseColor);\n    }\n\n    getColor(points, colorInterpolationMode, baseColor){\n        return points.reduce((result, point) => {\n            var color = point.color ? point.color.map(c => c/points.length) : baseColor;\n            return result.map((c, i) => c + color[i]);\n        }, baseColor);\n    }\n}\n\nexport default ColorfulTriangle;\n\n\n/** WEBPACK FOOTER **\n ** ./src/ColorfulTriangle.js\n **/","import {Vector} from 'ptjs'\n\nclass Force{\n    constructor(x,\n                y,\n                direction,\n                intensity,\n                color,\n                width,\n                height,\n                decay,\n                invert,\n                influenceColor,\n                influencePosition,\n                axis){\n        this._x = x;\n        this._y = y;\n        this._vector = new Vector(this._x, this._y);\n        this._direction = direction;\n        this._intensity = intensity;\n        this._color = color;\n        this._decay = decay;\n        this._invert = invert;\n\n        this._width = width;\n        this._height = height;\n\n        this.axis = axis;\n        this.influenceColor = influenceColor;\n        this.influencePosition = influencePosition;\n\n    }\n\n    getForceRadius(){\n        var smallestDimension = Math.min(this._width, this._height);\n        return (smallestDimension/200) * this._intensity;\n    }\n\n    getForceAtPoint(x, y){\n        var pointVector = new Vector(x,y);\n        var forceToPointVector = pointVector.$subtract(this._vector);\n        var distance = forceToPointVector.magnitude();\n\n        var forceRadius = this.getForceRadius();\n\n        var forceDecay;\n        if(distance > forceRadius){\n            if(this._invert) forceDecay=1;\n            else forceDecay=0;\n        }else{\n            var x = (forceRadius - Math.min(forceRadius, Math.abs(distance)))/(forceRadius||1);\n            if(this._invert) x = 1 - x;\n            switch(this._decay){\n                case \"cosine\":\n                    forceDecay = Math.pow(Math.cos(Math.PI * (1 - x) / 2), 10);\n                    break;\n                case \"clipping_power\":\n                    forceDecay = Math.pow(Math.max(0, Math.abs(x) * 2 - 1), 3)\n                    break;\n                case \"sine\":\n                    forceDecay = Math.pow(Math.abs(Math.sin(Math.PI * x / 2)), 0.5);\n                    break;\n                default:\n                    forceDecay = x;\n                    break;\n            }            \n        }\n\n        var normalizedVector = forceToPointVector.$normalize();\n\n        var vectorX = new Vector(1, 0);\n        var vectorY = new Vector(0, 1);\n        var forceX = forceRadius*forceDecay*vectorX.projection(normalizedVector).x;\n        var forceY = forceRadius*forceDecay*vectorY.projection(normalizedVector).y;\n\n        var color = this._color.map(colorCoord => colorCoord * forceDecay);\n        return {forceX, forceY, color};\n    }\n}\n\nexport default Force;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Force.js\n **/","import {Point, Vector} from \"ptjs\"\n\nclass ColorfulPoint {\n    constructor(x, y, color){\n        this._x = x;\n        this._y = y;\n        this.color = color;\n        this.concept = new Point(x, y);\n    }\n}\n\nexport default ColorfulPoint;\n\n\n/** WEBPACK FOOTER **\n ** ./src/ColorfulPoint.js\n **/","const brokenGlass = [\n    [[0, 0], [1, 0], [1, 1]],\n\n    [[0, 0], [-1, 0], [-1, 1]],\n\n    [[2, 1], [-1, 0], [1, 2]],\n\n    [[1, 1], [-1, 2], [1, 0]],\n\n];\nexports.brokenGlass = brokenGlass;\n\nconst cloth = [\n    [[0, 0], [1, 0], [1, 1]],\n\n    //Triangle on the left\n    [[0, 0], [-1, 0], [-1, 1]],\n\n    //Triangle on top\n    [[0, 0], [-1, 0], [1, 0]],\n\n    //Triangle on bottom\n    [[0, 0],[-1, 1], [1, 1]]\n];\nexports.cloth = cloth;\n\n\n/** WEBPACK FOOTER **\n ** ./src/patterns.js\n **/","import Force from './Force.js';\n\nclass ForceField{\n    constructor(forces, width, height){\n        this._forces = forces.map(force => new Force(\n            width/100*force.x,\n            height/100*force.y,\n            force.direction,\n            force.intensity,\n            force.color,\n            width,\n            height,\n            force.decay,\n            force.invert,\n            force.influenceColor,\n            force.influencePosition,\n            force.axis));\n    }\n\n    getForces(){\n        return this._forces;\n    }\n}\n\nexport default ForceField;\n\n\n/** WEBPACK FOOTER **\n ** ./src/ForceField.js\n **/"],"sourceRoot":""}